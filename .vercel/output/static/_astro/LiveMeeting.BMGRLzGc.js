import{g as Gr}from"./localStorageUtils.BuRq4_r3.js";import{_ as yn}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{c as wr,o as Nt,a as ie,r as Z,$ as Bt,T as qt,t as Qr,O as $s,F as fa,g as ma,Y as zs,h as nt,Q as ga,P as _a}from"./runtime-core.esm-bundler.lqNYk3e-.js";/* empty css                       */const be=Object.create(null);be.open="0";be.close="1";be.ping="2";be.pong="3";be.message="4";be.upgrade="5";be.noop="6";const vr=Object.create(null);Object.keys(be).forEach(n=>{vr[be[n]]=n});const ls={type:"error",data:"parser error"},bn=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Sn=typeof ArrayBuffer=="function",Rn=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,_s=({type:n,data:e},s,t)=>bn&&e instanceof Blob?s?t(e):Vs(e,t):Sn&&(e instanceof ArrayBuffer||Rn(e))?s?t(e):Vs(new Blob([e]),t):t(be[n]+(e||"")),Vs=(n,e)=>{const s=new FileReader;return s.onload=function(){const t=s.result.split(",")[1];e("b"+(t||""))},s.readAsDataURL(n)};function Hs(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let Wr;function wa(n,e){if(bn&&n.data instanceof Blob)return n.data.arrayBuffer().then(Hs).then(e);if(Sn&&(n.data instanceof ArrayBuffer||Rn(n.data)))return e(Hs(n.data));_s(n,!1,s=>{Wr||(Wr=new TextEncoder),e(Wr.encode(s))})}const Ks="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",jt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<Ks.length;n++)jt[Ks.charCodeAt(n)]=n;const va=n=>{let e=n.length*.75,s=n.length,t,_=0,m,w,y,C;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const R=new ArrayBuffer(e),v=new Uint8Array(R);for(t=0;t<s;t+=4)m=jt[n.charCodeAt(t)],w=jt[n.charCodeAt(t+1)],y=jt[n.charCodeAt(t+2)],C=jt[n.charCodeAt(t+3)],v[_++]=m<<2|w>>4,v[_++]=(w&15)<<4|y>>2,v[_++]=(y&3)<<6|C&63;return R},ya=typeof ArrayBuffer=="function",ws=(n,e)=>{if(typeof n!="string")return{type:"message",data:Cn(n,e)};const s=n.charAt(0);return s==="b"?{type:"message",data:ba(n.substring(1),e)}:vr[s]?n.length>1?{type:vr[s],data:n.substring(1)}:{type:vr[s]}:ls},ba=(n,e)=>{if(ya){const s=va(n);return Cn(s,e)}else return{base64:!0,data:n}},Cn=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},Tn="",Sa=(n,e)=>{const s=n.length,t=new Array(s);let _=0;n.forEach((m,w)=>{_s(m,!1,y=>{t[w]=y,++_===s&&e(t.join(Tn))})})},Ra=(n,e)=>{const s=n.split(Tn),t=[];for(let _=0;_<s.length;_++){const m=ws(s[_],e);if(t.push(m),m.type==="error")break}return t};function Ca(){return new TransformStream({transform(n,e){wa(n,s=>{const t=s.length;let _;if(t<126)_=new Uint8Array(1),new DataView(_.buffer).setUint8(0,t);else if(t<65536){_=new Uint8Array(3);const m=new DataView(_.buffer);m.setUint8(0,126),m.setUint16(1,t)}else{_=new Uint8Array(9);const m=new DataView(_.buffer);m.setUint8(0,127),m.setBigUint64(1,BigInt(t))}n.data&&typeof n.data!="string"&&(_[0]|=128),e.enqueue(_),e.enqueue(s)})}})}let Yr;function Xt(n){return n.reduce((e,s)=>e+s.length,0)}function Jt(n,e){if(n[0].length===e)return n.shift();const s=new Uint8Array(e);let t=0;for(let _=0;_<e;_++)s[_]=n[0][t++],t===n[0].length&&(n.shift(),t=0);return n.length&&t<n[0].length&&(n[0]=n[0].slice(t)),s}function Ta(n,e){Yr||(Yr=new TextDecoder);const s=[];let t=0,_=-1,m=!1;return new TransformStream({transform(w,y){for(s.push(w);;){if(t===0){if(Xt(s)<1)break;const C=Jt(s,1);m=(C[0]&128)===128,_=C[0]&127,_<126?t=3:_===126?t=1:t=2}else if(t===1){if(Xt(s)<2)break;const C=Jt(s,2);_=new DataView(C.buffer,C.byteOffset,C.length).getUint16(0),t=3}else if(t===2){if(Xt(s)<8)break;const C=Jt(s,8),R=new DataView(C.buffer,C.byteOffset,C.length),v=R.getUint32(0);if(v>Math.pow(2,21)-1){y.enqueue(ls);break}_=v*Math.pow(2,32)+R.getUint32(4),t=3}else{if(Xt(s)<_)break;const C=Jt(s,_);y.enqueue(ws(m?C:Yr.decode(C),e)),t=0}if(_===0||_>n){y.enqueue(ls);break}}}})}const Dn=4;function W(n){if(n)return Da(n)}function Da(n){for(var e in W.prototype)n[e]=W.prototype[e];return n}W.prototype.on=W.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};W.prototype.once=function(n,e){function s(){this.off(n,s),e.apply(this,arguments)}return s.fn=e,this.on(n,s),this};W.prototype.off=W.prototype.removeListener=W.prototype.removeAllListeners=W.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var s=this._callbacks["$"+n];if(!s)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var t,_=0;_<s.length;_++)if(t=s[_],t===e||t.fn===e){s.splice(_,1);break}return s.length===0&&delete this._callbacks["$"+n],this};W.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),s=this._callbacks["$"+n],t=1;t<arguments.length;t++)e[t-1]=arguments[t];if(s){s=s.slice(0);for(var t=0,_=s.length;t<_;++t)s[t].apply(this,e)}return this};W.prototype.emitReserved=W.prototype.emit;W.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};W.prototype.hasListeners=function(n){return!!this.listeners(n).length};const Tr=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,s)=>s(e,0),pe=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Pa="arraybuffer";function Pn(n,...e){return e.reduce((s,t)=>(n.hasOwnProperty(t)&&(s[t]=n[t]),s),{})}const ka=pe.setTimeout,Ea=pe.clearTimeout;function Dr(n,e){e.useNativeTimers?(n.setTimeoutFn=ka.bind(pe),n.clearTimeoutFn=Ea.bind(pe)):(n.setTimeoutFn=pe.setTimeout.bind(pe),n.clearTimeoutFn=pe.clearTimeout.bind(pe))}const xa=1.33;function La(n){return typeof n=="string"?Ia(n):Math.ceil((n.byteLength||n.size)*xa)}function Ia(n){let e=0,s=0;for(let t=0,_=n.length;t<_;t++)e=n.charCodeAt(t),e<128?s+=1:e<2048?s+=2:e<55296||e>=57344?s+=3:(t++,s+=4);return s}function kn(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Ma(n){let e="";for(let s in n)n.hasOwnProperty(s)&&(e.length&&(e+="&"),e+=encodeURIComponent(s)+"="+encodeURIComponent(n[s]));return e}function Oa(n){let e={},s=n.split("&");for(let t=0,_=s.length;t<_;t++){let m=s[t].split("=");e[decodeURIComponent(m[0])]=decodeURIComponent(m[1])}return e}class Aa extends Error{constructor(e,s,t){super(e),this.description=s,this.context=t,this.type="TransportError"}}let vs=class extends W{constructor(e){super(),this.writable=!1,Dr(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,s,t){return super.emitReserved("error",new Aa(e,s,t)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const s=ws(e,this.socket.binaryType);this.onPacket(s)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,s={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(s)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const s=Ma(e);return s.length?"?"+s:""}};class Na extends vs{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const s=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let t=0;this._polling&&(t++,this.once("pollComplete",function(){--t||s()})),this.writable||(t++,this.once("drain",function(){--t||s()}))}else s()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const s=t=>{if(this.readyState==="opening"&&t.type==="open"&&this.onOpen(),t.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)};Ra(e,this.socket.binaryType).forEach(s),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Sa(e,s=>{this.doWrite(s,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",s=this.query||{};return this.opts.timestampRequests!==!1&&(s[this.opts.timestampParam]=kn()),!this.supportsBinary&&!s.sid&&(s.b64=1),this.createUri(e,s)}}let En=!1;try{En=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const ja=En;function Fa(){}class Ba extends Na{constructor(e){if(super(e),typeof location<"u"){const s=location.protocol==="https:";let t=location.port;t||(t=s?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||t!==e.port}}doWrite(e,s){const t=this.request({method:"POST",data:e});t.on("success",s),t.on("error",(_,m)=>{this.onError("xhr post error",_,m)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(s,t)=>{this.onError("xhr poll error",s,t)}),this.pollXhr=e}}class ye extends W{constructor(e,s,t){super(),this.createRequest=e,Dr(this,t),this._opts=t,this._method=t.method||"GET",this._uri=s,this._data=t.data!==void 0?t.data:null,this._create()}_create(){var e;const s=Pn(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");s.xdomain=!!this._opts.xd;const t=this._xhr=this.createRequest(s);try{t.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let _ in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(_)&&t.setRequestHeader(_,this._opts.extraHeaders[_])}}catch{}if(this._method==="POST")try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{t.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(t),"withCredentials"in t&&(t.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(t.timeout=this._opts.requestTimeout),t.onreadystatechange=()=>{var _;t.readyState===3&&((_=this._opts.cookieJar)===null||_===void 0||_.parseCookies(t.getResponseHeader("set-cookie"))),t.readyState===4&&(t.status===200||t.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof t.status=="number"?t.status:0)},0))},t.send(this._data)}catch(_){this.setTimeoutFn(()=>{this._onError(_)},0);return}typeof document<"u"&&(this._index=ye.requestsCount++,ye.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Fa,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete ye.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}ye.requestsCount=0;ye.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Gs);else if(typeof addEventListener=="function"){const n="onpagehide"in pe?"pagehide":"unload";addEventListener(n,Gs,!1)}}function Gs(){for(let n in ye.requests)ye.requests.hasOwnProperty(n)&&ye.requests[n].abort()}const qa=function(){const n=xn({xdomain:!1});return n&&n.responseType!==null}();class Ua extends Ba{constructor(e){super(e);const s=e&&e.forceBase64;this.supportsBinary=qa&&!s}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new ye(xn,this.uri(),e)}}function xn(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||ja))return new XMLHttpRequest}catch{}if(!e)try{return new pe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Ln=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class $a extends vs{get name(){return"websocket"}doOpen(){const e=this.uri(),s=this.opts.protocols,t=Ln?{}:Pn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(t.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,s,t)}catch(_){return this.emitReserved("error",_)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let s=0;s<e.length;s++){const t=e[s],_=s===e.length-1;_s(t,this.supportsBinary,m=>{try{this.doWrite(t,m)}catch{}_&&Tr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",s=this.query||{};return this.opts.timestampRequests&&(s[this.opts.timestampParam]=kn()),this.supportsBinary||(s.b64=1),this.createUri(e,s)}}const Xr=pe.WebSocket||pe.MozWebSocket;class za extends $a{createSocket(e,s,t){return Ln?new Xr(e,s,t):s?new Xr(e,s):new Xr(e)}doWrite(e,s){this.ws.send(s)}}class Va extends vs{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const s=Ta(Number.MAX_SAFE_INTEGER,this.socket.binaryType),t=e.readable.pipeThrough(s).getReader(),_=Ca();_.readable.pipeTo(e.writable),this._writer=_.writable.getWriter();const m=()=>{t.read().then(({done:y,value:C})=>{y||(this.onPacket(C),m())}).catch(y=>{})};m();const w={type:"open"};this.query.sid&&(w.data=`{"sid":"${this.query.sid}"}`),this._writer.write(w).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let s=0;s<e.length;s++){const t=e[s],_=s===e.length-1;this._writer.write(t).then(()=>{_&&Tr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Ha={websocket:za,webtransport:Va,polling:Ua},Ka=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ga=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function us(n){if(n.length>8e3)throw"URI too long";const e=n,s=n.indexOf("["),t=n.indexOf("]");s!=-1&&t!=-1&&(n=n.substring(0,s)+n.substring(s,t).replace(/:/g,";")+n.substring(t,n.length));let _=Ka.exec(n||""),m={},w=14;for(;w--;)m[Ga[w]]=_[w]||"";return s!=-1&&t!=-1&&(m.source=e,m.host=m.host.substring(1,m.host.length-1).replace(/;/g,":"),m.authority=m.authority.replace("[","").replace("]","").replace(/;/g,":"),m.ipv6uri=!0),m.pathNames=Qa(m,m.path),m.queryKey=Wa(m,m.query),m}function Qa(n,e){const s=/\/{2,9}/g,t=e.replace(s,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&t.splice(0,1),e.slice(-1)=="/"&&t.splice(t.length-1,1),t}function Wa(n,e){const s={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(t,_,m){_&&(s[_]=m)}),s}const hs=typeof addEventListener=="function"&&typeof removeEventListener=="function",yr=[];hs&&addEventListener("offline",()=>{yr.forEach(n=>n())},!1);class Ee extends W{constructor(e,s){if(super(),this.binaryType=Pa,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(s=e,e=null),e){const t=us(e);s.hostname=t.host,s.secure=t.protocol==="https"||t.protocol==="wss",s.port=t.port,t.query&&(s.query=t.query)}else s.host&&(s.hostname=us(s.host).host);Dr(this,s),this.secure=s.secure!=null?s.secure:typeof location<"u"&&location.protocol==="https:",s.hostname&&!s.port&&(s.port=this.secure?"443":"80"),this.hostname=s.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=s.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},s.transports.forEach(t=>{const _=t.prototype.name;this.transports.push(_),this._transportsByName[_]=t}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},s),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Oa(this.opts.query)),hs&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},yr.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const s=Object.assign({},this.opts.query);s.EIO=Dn,s.transport=e,this.id&&(s.sid=this.id);const t=Object.assign({},this.opts,{query:s,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](t)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Ee.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const s=this.createTransport(e);s.open(),this.setTransport(s)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",s=>this._onClose("transport close",s))}onOpen(){this.readyState="open",Ee.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const s=new Error("server error");s.code=e.data,this._onError(s);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let s=1;for(let t=0;t<this.writeBuffer.length;t++){const _=this.writeBuffer[t].data;if(_&&(s+=La(_)),t>0&&s>this._maxPayload)return this.writeBuffer.slice(0,t);s+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Tr(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,s,t){return this._sendPacket("message",e,s,t),this}send(e,s,t){return this._sendPacket("message",e,s,t),this}_sendPacket(e,s,t,_){if(typeof s=="function"&&(_=s,s=void 0),typeof t=="function"&&(_=t,t=null),this.readyState==="closing"||this.readyState==="closed")return;t=t||{},t.compress=t.compress!==!1;const m={type:e,data:s,options:t};this.emitReserved("packetCreate",m),this.writeBuffer.push(m),_&&this.once("flush",_),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},s=()=>{this.off("upgrade",s),this.off("upgradeError",s),e()},t=()=>{this.once("upgrade",s),this.once("upgradeError",s)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?t():e()}):this.upgrading?t():e()),this}_onError(e){if(Ee.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,s){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),hs&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const t=yr.indexOf(this._offlineEventListener);t!==-1&&yr.splice(t,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,s),this.writeBuffer=[],this._prevBufferLen=0}}}Ee.protocol=Dn;class Ya extends Ee{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let s=this.createTransport(e),t=!1;Ee.priorWebsocketSuccess=!1;const _=()=>{t||(s.send([{type:"ping",data:"probe"}]),s.once("packet",l=>{if(!t)if(l.type==="pong"&&l.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",s),!s)return;Ee.priorWebsocketSuccess=s.name==="websocket",this.transport.pause(()=>{t||this.readyState!=="closed"&&(v(),this.setTransport(s),s.send([{type:"upgrade"}]),this.emitReserved("upgrade",s),s=null,this.upgrading=!1,this.flush())})}else{const b=new Error("probe error");b.transport=s.name,this.emitReserved("upgradeError",b)}}))};function m(){t||(t=!0,v(),s.close(),s=null)}const w=l=>{const b=new Error("probe error: "+l);b.transport=s.name,m(),this.emitReserved("upgradeError",b)};function y(){w("transport closed")}function C(){w("socket closed")}function R(l){s&&l.name!==s.name&&m()}const v=()=>{s.removeListener("open",_),s.removeListener("error",w),s.removeListener("close",y),this.off("close",C),this.off("upgrading",R)};s.once("open",_),s.once("error",w),s.once("close",y),this.once("close",C),this.once("upgrading",R),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{t||s.open()},200):s.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const s=[];for(let t=0;t<e.length;t++)~this.transports.indexOf(e[t])&&s.push(e[t]);return s}}let Xa=class extends Ya{constructor(e,s={}){const t=typeof e=="object"?e:s;(!t.transports||t.transports&&typeof t.transports[0]=="string")&&(t.transports=(t.transports||["polling","websocket","webtransport"]).map(_=>Ha[_]).filter(_=>!!_)),super(e,t)}};function Ja(n,e="",s){let t=n;s=s||typeof location<"u"&&location,n==null&&(n=s.protocol+"//"+s.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=s.protocol+n:n=s.host+n),/^(https?|wss?):\/\//.test(n)||(typeof s<"u"?n=s.protocol+"//"+n:n="https://"+n),t=us(n)),t.port||(/^(http|ws)$/.test(t.protocol)?t.port="80":/^(http|ws)s$/.test(t.protocol)&&(t.port="443")),t.path=t.path||"/";const m=t.host.indexOf(":")!==-1?"["+t.host+"]":t.host;return t.id=t.protocol+"://"+m+":"+t.port+e,t.href=t.protocol+"://"+m+(s&&s.port===t.port?"":":"+t.port),t}const Za=typeof ArrayBuffer=="function",eo=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,In=Object.prototype.toString,to=typeof Blob=="function"||typeof Blob<"u"&&In.call(Blob)==="[object BlobConstructor]",ro=typeof File=="function"||typeof File<"u"&&In.call(File)==="[object FileConstructor]";function ys(n){return Za&&(n instanceof ArrayBuffer||eo(n))||to&&n instanceof Blob||ro&&n instanceof File}function br(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let s=0,t=n.length;s<t;s++)if(br(n[s]))return!0;return!1}if(ys(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return br(n.toJSON(),!0);for(const s in n)if(Object.prototype.hasOwnProperty.call(n,s)&&br(n[s]))return!0;return!1}function so(n){const e=[],s=n.data,t=n;return t.data=fs(s,e),t.attachments=e.length,{packet:t,buffers:e}}function fs(n,e){if(!n)return n;if(ys(n)){const s={_placeholder:!0,num:e.length};return e.push(n),s}else if(Array.isArray(n)){const s=new Array(n.length);for(let t=0;t<n.length;t++)s[t]=fs(n[t],e);return s}else if(typeof n=="object"&&!(n instanceof Date)){const s={};for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(s[t]=fs(n[t],e));return s}return n}function io(n,e){return n.data=ms(n.data,e),delete n.attachments,n}function ms(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let s=0;s<n.length;s++)n[s]=ms(n[s],e);else if(typeof n=="object")for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(n[s]=ms(n[s],e));return n}const no=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ao=5;var $;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})($||($={}));class oo{constructor(e){this.replacer=e}encode(e){return(e.type===$.EVENT||e.type===$.ACK)&&br(e)?this.encodeAsBinary({type:e.type===$.EVENT?$.BINARY_EVENT:$.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let s=""+e.type;return(e.type===$.BINARY_EVENT||e.type===$.BINARY_ACK)&&(s+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(s+=e.nsp+","),e.id!=null&&(s+=e.id),e.data!=null&&(s+=JSON.stringify(e.data,this.replacer)),s}encodeAsBinary(e){const s=so(e),t=this.encodeAsString(s.packet),_=s.buffers;return _.unshift(t),_}}function Qs(n){return Object.prototype.toString.call(n)==="[object Object]"}class bs extends W{constructor(e){super(),this.reviver=e}add(e){let s;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");s=this.decodeString(e);const t=s.type===$.BINARY_EVENT;t||s.type===$.BINARY_ACK?(s.type=t?$.EVENT:$.ACK,this.reconstructor=new co(s),s.attachments===0&&super.emitReserved("decoded",s)):super.emitReserved("decoded",s)}else if(ys(e)||e.base64)if(this.reconstructor)s=this.reconstructor.takeBinaryData(e),s&&(this.reconstructor=null,super.emitReserved("decoded",s));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let s=0;const t={type:Number(e.charAt(0))};if($[t.type]===void 0)throw new Error("unknown packet type "+t.type);if(t.type===$.BINARY_EVENT||t.type===$.BINARY_ACK){const m=s+1;for(;e.charAt(++s)!=="-"&&s!=e.length;);const w=e.substring(m,s);if(w!=Number(w)||e.charAt(s)!=="-")throw new Error("Illegal attachments");t.attachments=Number(w)}if(e.charAt(s+1)==="/"){const m=s+1;for(;++s&&!(e.charAt(s)===","||s===e.length););t.nsp=e.substring(m,s)}else t.nsp="/";const _=e.charAt(s+1);if(_!==""&&Number(_)==_){const m=s+1;for(;++s;){const w=e.charAt(s);if(w==null||Number(w)!=w){--s;break}if(s===e.length)break}t.id=Number(e.substring(m,s+1))}if(e.charAt(++s)){const m=this.tryParse(e.substr(s));if(bs.isPayloadValid(t.type,m))t.data=m;else throw new Error("invalid payload")}return t}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,s){switch(e){case $.CONNECT:return Qs(s);case $.DISCONNECT:return s===void 0;case $.CONNECT_ERROR:return typeof s=="string"||Qs(s);case $.EVENT:case $.BINARY_EVENT:return Array.isArray(s)&&(typeof s[0]=="number"||typeof s[0]=="string"&&no.indexOf(s[0])===-1);case $.ACK:case $.BINARY_ACK:return Array.isArray(s)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class co{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const s=io(this.reconPack,this.buffers);return this.finishedReconstruction(),s}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const po=Object.freeze(Object.defineProperty({__proto__:null,Decoder:bs,Encoder:oo,get PacketType(){return $},protocol:ao},Symbol.toStringTag,{value:"Module"}));function fe(n,e,s){return n.on(e,s),function(){n.off(e,s)}}const lo=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Mn extends W{constructor(e,s,t){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=s,t&&t.auth&&(this.auth=t.auth),this._opts=Object.assign({},t),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[fe(e,"open",this.onopen.bind(this)),fe(e,"packet",this.onpacket.bind(this)),fe(e,"error",this.onerror.bind(this)),fe(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...s){var t,_,m;if(lo.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(s.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(s),this;const w={type:$.EVENT,data:s};if(w.options={},w.options.compress=this.flags.compress!==!1,typeof s[s.length-1]=="function"){const v=this.ids++,l=s.pop();this._registerAckCallback(v,l),w.id=v}const y=(_=(t=this.io.engine)===null||t===void 0?void 0:t.transport)===null||_===void 0?void 0:_.writable,C=this.connected&&!(!((m=this.io.engine)===null||m===void 0)&&m._hasPingExpired());return this.flags.volatile&&!y||(C?(this.notifyOutgoingListeners(w),this.packet(w)):this.sendBuffer.push(w)),this.flags={},this}_registerAckCallback(e,s){var t;const _=(t=this.flags.timeout)!==null&&t!==void 0?t:this._opts.ackTimeout;if(_===void 0){this.acks[e]=s;return}const m=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let y=0;y<this.sendBuffer.length;y++)this.sendBuffer[y].id===e&&this.sendBuffer.splice(y,1);s.call(this,new Error("operation has timed out"))},_),w=(...y)=>{this.io.clearTimeoutFn(m),s.apply(this,y)};w.withError=!0,this.acks[e]=w}emitWithAck(e,...s){return new Promise((t,_)=>{const m=(w,y)=>w?_(w):t(y);m.withError=!0,s.push(m),this.emit(e,...s)})}_addToQueue(e){let s;typeof e[e.length-1]=="function"&&(s=e.pop());const t={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((_,...m)=>t!==this._queue[0]?void 0:(_!==null?t.tryCount>this._opts.retries&&(this._queue.shift(),s&&s(_)):(this._queue.shift(),s&&s(null,...m)),t.pending=!1,this._drainQueue())),this._queue.push(t),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const s=this._queue[0];s.pending&&!e||(s.pending=!0,s.tryCount++,this.flags=s.flags,this.emit.apply(this,s.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:$.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,s){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,s),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(t=>String(t.id)===e)){const t=this.acks[e];delete this.acks[e],t.withError&&t.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case $.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case $.EVENT:case $.BINARY_EVENT:this.onevent(e);break;case $.ACK:case $.BINARY_ACK:this.onack(e);break;case $.DISCONNECT:this.ondisconnect();break;case $.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t);break}}onevent(e){const s=e.data||[];e.id!=null&&s.push(this.ack(e.id)),this.connected?this.emitEvent(s):this.receiveBuffer.push(Object.freeze(s))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const s=this._anyListeners.slice();for(const t of s)t.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const s=this;let t=!1;return function(..._){t||(t=!0,s.packet({type:$.ACK,id:e,data:_}))}}onack(e){const s=this.acks[e.id];typeof s=="function"&&(delete this.acks[e.id],s.withError&&e.data.unshift(null),s.apply(this,e.data))}onconnect(e,s){this.id=e,this.recovered=s&&this._pid===s,this._pid=s,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:$.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const s=this._anyListeners;for(let t=0;t<s.length;t++)if(e===s[t])return s.splice(t,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const s=this._anyOutgoingListeners;for(let t=0;t<s.length;t++)if(e===s[t])return s.splice(t,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const s=this._anyOutgoingListeners.slice();for(const t of s)t.apply(this,e.data)}}}function Ye(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}Ye.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),s=Math.floor(e*this.jitter*n);n=(Math.floor(e*10)&1)==0?n-s:n+s}return Math.min(n,this.max)|0};Ye.prototype.reset=function(){this.attempts=0};Ye.prototype.setMin=function(n){this.ms=n};Ye.prototype.setMax=function(n){this.max=n};Ye.prototype.setJitter=function(n){this.jitter=n};class gs extends W{constructor(e,s){var t;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(s=e,e=void 0),s=s||{},s.path=s.path||"/socket.io",this.opts=s,Dr(this,s),this.reconnection(s.reconnection!==!1),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor((t=s.randomizationFactor)!==null&&t!==void 0?t:.5),this.backoff=new Ye({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(s.timeout==null?2e4:s.timeout),this._readyState="closed",this.uri=e;const _=s.parser||po;this.encoder=new _.Encoder,this.decoder=new _.Decoder,this._autoConnect=s.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var s;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(s=this.backoff)===null||s===void 0||s.setMin(e),this)}randomizationFactor(e){var s;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(s=this.backoff)===null||s===void 0||s.setJitter(e),this)}reconnectionDelayMax(e){var s;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(s=this.backoff)===null||s===void 0||s.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Xa(this.uri,this.opts);const s=this.engine,t=this;this._readyState="opening",this.skipReconnect=!1;const _=fe(s,"open",function(){t.onopen(),e&&e()}),m=y=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",y),e?e(y):this.maybeReconnectOnOpen()},w=fe(s,"error",m);if(this._timeout!==!1){const y=this._timeout,C=this.setTimeoutFn(()=>{_(),m(new Error("timeout")),s.close()},y);this.opts.autoUnref&&C.unref(),this.subs.push(()=>{this.clearTimeoutFn(C)})}return this.subs.push(_),this.subs.push(w),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(fe(e,"ping",this.onping.bind(this)),fe(e,"data",this.ondata.bind(this)),fe(e,"error",this.onerror.bind(this)),fe(e,"close",this.onclose.bind(this)),fe(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(s){this.onclose("parse error",s)}}ondecoded(e){Tr(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,s){let t=this.nsps[e];return t?this._autoConnect&&!t.active&&t.connect():(t=new Mn(this,e,s),this.nsps[e]=t),t}_destroy(e){const s=Object.keys(this.nsps);for(const t of s)if(this.nsps[t].active)return;this._close()}_packet(e){const s=this.encoder.encode(e);for(let t=0;t<s.length;t++)this.engine.write(s[t],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,s){var t;this.cleanup(),(t=this.engine)===null||t===void 0||t.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,s),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const s=this.backoff.duration();this._reconnecting=!0;const t=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(_=>{_?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",_)):e.onreconnect()}))},s);this.opts.autoUnref&&t.unref(),this.subs.push(()=>{this.clearTimeoutFn(t)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const at={};function Ut(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const s=Ja(n,e.path||"/socket.io"),t=s.source,_=s.id,m=s.path,w=at[_]&&m in at[_].nsps,y=e.forceNew||e["force new connection"]||e.multiplex===!1||w;let C;return y?C=new gs(t,e):(at[_]||(at[_]=new gs(t,e)),C=at[_]),s.query&&!e.query&&(e.query=s.queryKey),C.socket(s.path,e)}Object.assign(Ut,{Manager:gs,Socket:Mn,io:Ut,connect:Ut});var Jr={},Zt={exports:{}},Zr,Ws;function uo(){if(Ws)return Zr;Ws=1;var n=1e3,e=n*60,s=e*60,t=s*24,_=t*7,m=t*365.25;Zr=function(v,l){l=l||{};var b=typeof v;if(b==="string"&&v.length>0)return w(v);if(b==="number"&&isFinite(v))return l.long?C(v):y(v);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(v))};function w(v){if(v=String(v),!(v.length>100)){var l=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(v);if(l){var b=parseFloat(l[1]),S=(l[2]||"ms").toLowerCase();switch(S){case"years":case"year":case"yrs":case"yr":case"y":return b*m;case"weeks":case"week":case"w":return b*_;case"days":case"day":case"d":return b*t;case"hours":case"hour":case"hrs":case"hr":case"h":return b*s;case"minutes":case"minute":case"mins":case"min":case"m":return b*e;case"seconds":case"second":case"secs":case"sec":case"s":return b*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return b;default:return}}}}function y(v){var l=Math.abs(v);return l>=t?Math.round(v/t)+"d":l>=s?Math.round(v/s)+"h":l>=e?Math.round(v/e)+"m":l>=n?Math.round(v/n)+"s":v+"ms"}function C(v){var l=Math.abs(v);return l>=t?R(v,l,t,"day"):l>=s?R(v,l,s,"hour"):l>=e?R(v,l,e,"minute"):l>=n?R(v,l,n,"second"):v+" ms"}function R(v,l,b,S){var p=l>=b*1.5;return Math.round(v/b)+" "+S+(p?"s":"")}return Zr}var es,Ys;function ho(){if(Ys)return es;Ys=1;function n(e){t.debug=t,t.default=t,t.coerce=R,t.disable=y,t.enable=m,t.enabled=C,t.humanize=uo(),t.destroy=v,Object.keys(e).forEach(l=>{t[l]=e[l]}),t.names=[],t.skips=[],t.formatters={};function s(l){let b=0;for(let S=0;S<l.length;S++)b=(b<<5)-b+l.charCodeAt(S),b|=0;return t.colors[Math.abs(b)%t.colors.length]}t.selectColor=s;function t(l){let b,S=null,p,o;function r(...i){if(!r.enabled)return;const c=r,a=Number(new Date),d=a-(b||a);c.diff=d,c.prev=b,c.curr=a,b=a,i[0]=t.coerce(i[0]),typeof i[0]!="string"&&i.unshift("%O");let u=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,(g,T)=>{if(g==="%%")return"%";u++;const h=t.formatters[T];if(typeof h=="function"){const P=i[u];g=h.call(c,P),i.splice(u,1),u--}return g}),t.formatArgs.call(c,i),(c.log||t.log).apply(c,i)}return r.namespace=l,r.useColors=t.useColors(),r.color=t.selectColor(l),r.extend=_,r.destroy=t.destroy,Object.defineProperty(r,"enabled",{enumerable:!0,configurable:!1,get:()=>S!==null?S:(p!==t.namespaces&&(p=t.namespaces,o=t.enabled(l)),o),set:i=>{S=i}}),typeof t.init=="function"&&t.init(r),r}function _(l,b){const S=t(this.namespace+(typeof b>"u"?":":b)+l);return S.log=this.log,S}function m(l){t.save(l),t.namespaces=l,t.names=[],t.skips=[];const b=(typeof l=="string"?l:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const S of b)S[0]==="-"?t.skips.push(S.slice(1)):t.names.push(S)}function w(l,b){let S=0,p=0,o=-1,r=0;for(;S<l.length;)if(p<b.length&&(b[p]===l[S]||b[p]==="*"))b[p]==="*"?(o=p,r=S,p++):(S++,p++);else if(o!==-1)p=o+1,r++,S=r;else return!1;for(;p<b.length&&b[p]==="*";)p++;return p===b.length}function y(){const l=[...t.names,...t.skips.map(b=>"-"+b)].join(",");return t.enable(""),l}function C(l){for(const b of t.skips)if(w(l,b))return!1;for(const b of t.names)if(w(l,b))return!0;return!1}function R(l){return l instanceof Error?l.stack||l.message:l}function v(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}return es=n,es}var Xs;function Pr(){return Xs||(Xs=1,function(n,e){var s={};e.formatArgs=_,e.save=m,e.load=w,e.useColors=t,e.storage=y(),e.destroy=(()=>{let R=!1;return()=>{R||(R=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let R;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(R=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(R[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function _(R){if(R[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+R[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const v="color: "+this.color;R.splice(1,0,v,"color: inherit");let l=0,b=0;R[0].replace(/%[a-zA-Z%]/g,S=>{S!=="%%"&&(l++,S==="%c"&&(b=l))}),R.splice(b,0,v)}e.log=console.debug||console.log||(()=>{});function m(R){try{R?e.storage.setItem("debug",R):e.storage.removeItem("debug")}catch{}}function w(){let R;try{R=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!R&&typeof process<"u"&&"env"in process&&(R=s.DEBUG),R}function y(){try{return localStorage}catch{}}n.exports=ho()(e);const{formatters:C}=n.exports;C.j=function(R){try{return JSON.stringify(R)}catch(v){return"[UnexpectedJSONParseError]: "+v.message}}}(Zt,Zt.exports)),Zt.exports}var Oe={},Ae={},Ft={exports:{}},fo=Ft.exports,Js;function mo(){return Js||(Js=1,function(n,e){(function(s,t){var _="2.0.4",m=500,w="user-agent",y="",C="?",R="function",v="undefined",l="object",b="string",S="browser",p="cpu",o="device",r="engine",i="os",c="result",a="name",d="type",u="vendor",f="version",g="architecture",T="major",h="model",P="console",k="mobile",M="tablet",D="smarttv",I="wearable",E="xr",x="embedded",L="inapp",F="brands",q="formFactors",V="fullVersionList",Y="platform",ce="platformVersion",le="bitness",ee="sec-ch-ua",_e=ee+"-full-version-list",sa=ee+"-arch",ia=ee+"-"+le,na=ee+"-form-factors",aa=ee+"-"+k,oa=ee+"-"+h,Cs=ee+"-"+Y,ca=Cs+"-version",Ts=[F,V,k,h,Y,ce,g,q,le],$t="Amazon",Ue="Apple",Ds="ASUS",Ps="BlackBerry",Me="Google",ks="Huawei",Ir="Lenovo",Es="Honor",zt="LG",Mr="Microsoft",Or="Motorola",Ar="Nvidia",xs="OnePlus",Nr="OPPO",Xe="Samsung",Ls="Sharp",Je="Sony",jr="Xiaomi",Fr="Zebra",Is="Chrome",Ms="Chromium",De="Chromecast",Vt="Edge",Ze="Firefox",et="Opera",Br="Facebook",Os="Sogou",$e="Mobile ",tt=" Browser",qr="Windows",As=typeof s!==v,ne=As&&s.navigator?s.navigator:t,Pe=ne&&ne.userAgentData?ne.userAgentData:t,da=function(O,N){var j={},H=N;if(!Kt(N)){H={};for(var B in N)for(var K in N[B])H[K]=N[B][K].concat(H[K]?H[K]:[])}for(var A in O)j[A]=H[A]&&H[A].length%2===0?H[A].concat(O[A]):O[A];return j},Ht=function(O){for(var N={},j=0;j<O.length;j++)N[O[j].toUpperCase()]=O[j];return N},Ur=function(O,N){if(typeof O===l&&O.length>0){for(var j in O)if(Se(N)==Se(O[j]))return!0;return!1}return ze(O)?Se(N)==Se(O):!1},Kt=function(O,N){for(var j in O)return/^(browser|cpu|device|engine|os)$/.test(j)||(N?Kt(O[j]):!1)},ze=function(O){return typeof O===b},$r=function(O){if(!O)return t;for(var N=[],j=Ve(/\\?\"/g,O).split(","),H=0;H<j.length;H++)if(j[H].indexOf(";")>-1){var B=Gt(j[H]).split(";v=");N[H]={brand:B[0],version:B[1]}}else N[H]=Gt(j[H]);return N},Se=function(O){return ze(O)?O.toLowerCase():O},zr=function(O){return ze(O)?Ve(/[^\d\.]/g,O).split(".")[0]:t},Re=function(O){for(var N in O){var j=O[N];typeof j==l&&j.length==2?this[j[0]]=j[1]:this[j]=t}return this},Ve=function(O,N){return ze(N)?N.replace(O,y):N},rt=function(O){return Ve(/\\?\"/g,O)},Gt=function(O,N){if(ze(O))return O=Ve(/^\s\s*/,O),typeof N===v?O:O.substring(0,m)},Vr=function(O,N){if(!(!O||!N))for(var j=0,H,B,K,A,z,U;j<N.length&&!z;){var G=N[j],Ce=N[j+1];for(H=B=0;H<G.length&&!z&&G[H];)if(z=G[H++].exec(O),z)for(K=0;K<Ce.length;K++)U=z[++B],A=Ce[K],typeof A===l&&A.length>0?A.length===2?typeof A[1]==R?this[A[0]]=A[1].call(this,U):this[A[0]]=A[1]:A.length>=3&&(typeof A[1]===R&&!(A[1].exec&&A[1].test)?A.length>3?this[A[0]]=U?A[1].apply(this,A.slice(2)):t:this[A[0]]=U?A[1].call(this,U,A[2]):t:A.length==3?this[A[0]]=U?U.replace(A[1],A[2]):t:A.length==4?this[A[0]]=U?A[3].call(this,U.replace(A[1],A[2])):t:A.length>4&&(this[A[0]]=U?A[3].apply(this,[U.replace(A[1],A[2])].concat(A.slice(4))):t)):this[A]=U||t;j+=2}},we=function(O,N){for(var j in N)if(typeof N[j]===l&&N[j].length>0){for(var H=0;H<N[j].length;H++)if(Ur(N[j][H],O))return j===C?t:j}else if(Ur(N[j],O))return j===C?t:j;return N.hasOwnProperty("*")?N["*"]:O},Ns={ME:"4.90","NT 3.51":"3.51","NT 4.0":"4.0",2e3:["5.0","5.01"],XP:["5.1","5.2"],Vista:"6.0",7:"6.1",8:"6.2","8.1":"6.3",10:["6.4","10.0"],NT:""},js={embedded:"Automotive",mobile:"Mobile",tablet:["Tablet","EInk"],smarttv:"TV",wearable:"Watch",xr:["VR","XR"],"?":["Desktop","Unknown"],"*":t},pa={Chrome:"Google Chrome",Edge:"Microsoft Edge","Edge WebView2":"Microsoft Edge WebView2","Chrome WebView":"Android WebView","Chrome Headless":"HeadlessChrome","Huawei Browser":"HuaweiBrowser","MIUI Browser":"Miui Browser","Opera Mobi":"OperaMobile",Yandex:"YaBrowser"},Fs={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[a,$e+"Chrome"]],[/webview.+edge\/([\w\.]+)/i],[f,[a,Vt+" WebView"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[a,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[a,f],[/opios[\/ ]+([\w\.]+)/i],[f,[a,et+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[f,[a,et+" GX"]],[/\bopr\/([\w\.]+)/i],[f,[a,et]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[f,[a,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[f,[a,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon|otter|dooble|(?:lg |qute)browser)\/([-\w\.]+)/i,/(heytap|ovi|115|surf)browser\/([\d\.]+)/i,/(ecosia|weibo)(?:__| \w+@)([\d\.]+)/i],[a,f],[/quark(?:pc)?\/([-\w\.]+)/i],[f,[a,"Quark"]],[/\bddg\/([\w\.]+)/i],[f,[a,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[a,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[f,[a,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[a,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[a,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[f,[a,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[f,[a,"Smart "+Ir+tt]],[/(avast|avg)\/([\w\.]+)/i],[[a,/(.+)/,"$1 Secure"+tt],f],[/\bfocus\/([\w\.]+)/i],[f,[a,Ze+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[a,et+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[a,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[a,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[a,et+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[a,"MIUI"+tt]],[/fxios\/([\w\.-]+)/i],[f,[a,$e+Ze]],[/\bqihoobrowser\/?([\w\.]*)/i],[f,[a,"360"]],[/\b(qq)\/([\w\.]+)/i],[[a,/(.+)/,"$1Browser"],f],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[a,/(.+)/,"$1"+tt],f],[/samsungbrowser\/([\w\.]+)/i],[f,[a,Xe+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[f,[a,Os+" Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[a,Os+" Mobile"],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[a,f],[/(lbbrowser|rekonq)/i],[a],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[f,a],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[a,Br],f,[d,L]],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(instagram|snapchat|klarna)[\/ ]([-\w\.]+)/i],[a,f,[d,L]],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[a,"GSA"],[d,L]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[f,[a,"TikTok"],[d,L]],[/\[(linkedin)app\]/i],[a,[d,L]],[/(chromium)[\/ ]([-\w\.]+)/i],[a,f],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[a,Is+" Headless"]],[/wv\).+chrome\/([\w\.]+).+edgw\//i],[f,[a,Vt+" WebView2"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[a,Is+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[a,"Android"+tt]],[/chrome\/([\w\.]+) mobile/i],[f,[a,$e+"Chrome"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[a,f],[/version\/([\w\.\,]+) .*mobile(?:\/\w+ | ?)safari/i],[f,[a,$e+"Safari"]],[/iphone .*mobile(?:\/\w+ | ?)safari/i],[[a,$e+"Safari"]],[/version\/([\w\.\,]+) .*(safari)/i],[f,a],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[a,[f,"1"]],[/(webkit|khtml)\/([\w\.]+)/i],[a,f],[/(?:mobile|tablet);.*(firefox)\/([\w\.-]+)/i],[[a,$e+Ze],f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[a,"Netscape"],f],[/(wolvic|librewolf)\/([\w\.]+)/i],[a,f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[a,Ze+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[a,[f,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[a,[f,/[^\d\.]+./,y]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[g,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[g,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[g,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[g,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[g,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[g,/ower/,y,Se]],[/ sun4\w[;\)]/i],[[g,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[g,Se]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[h,[u,Xe],[d,M]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr]|browser)[-\w]+)/i,/sec-(sgh\w+)/i],[h,[u,Xe],[d,k]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[h,[u,Ue],[d,k]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[h,[u,Ue],[d,M]],[/(macintosh);/i],[h,[u,Ue]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[h,[u,Ls],[d,k]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[h,[u,Es],[d,M]],[/honor([-\w ]+)[;\)]/i],[h,[u,Es],[d,k]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[h,[u,ks],[d,M]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[h,[u,ks],[d,k]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[h,/_/g," "],[u,jr],[d,M]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[h,/_/g," "],[u,jr],[d,k]],[/droid.+; (cph2[3-6]\d[13579]|((gm|hd)19|(ac|be|in|kb)20|(d[en]|eb|le|mt)21|ne22)[0-2]\d|p[g-k]\w[1m]10)\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[h,[u,xs],[d,k]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[h,[u,Nr],[d,k]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[h,[u,we,{OnePlus:["203","304","403","404","413","415"],"*":Nr}],[d,M]],[/(vivo (5r?|6|8l?|go|one|s|x[il]?[2-4]?)[\w\+ ]*)(?: bui|\))/i],[h,[u,"BLU"],[d,k]],[/; vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[h,[u,"Vivo"],[d,k]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[h,[u,"Realme"],[d,k]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[h,[u,Ir],[d,M]],[/lenovo[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i],[h,[u,Ir],[d,k]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ]([\w\s]+)(\)| bui)/i,/((?:moto(?! 360)[-\w\(\) ]+|xt\d{3,4}[cgkosw\+]?[-\d]*|nexus 6)(?= bui|\)))/i],[h,[u,Or],[d,k]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[h,[u,Or],[d,M]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[h,[u,zt],[d,M]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+(?!.*(?:browser|netcast|android tv|watch|webos))(\w+)/i,/\blg-?([\d\w]+) bui/i],[h,[u,zt],[d,k]],[/(nokia) (t[12][01])/i],[u,h,[d,M]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[h,/_/g," "],[d,k],[u,"Nokia"]],[/(pixel (c|tablet))\b/i],[h,[u,Me],[d,M]],[/droid.+;(?: google)? (g(01[13]a|020[aem]|025[jn]|1b60|1f8f|2ybb|4s1m|576d|5nz6|8hhn|8vou|a02099|c15s|d1yq|e2ae|ec77|gh2x|kv4x|p4bc|pj41|r83y|tt9q|ur25|wvk6)|pixel[\d ]*a?( pro)?( xl)?( fold)?( \(5g\))?)( bui|\))/i],[h,[u,Me],[d,k]],[/(google) (pixelbook( go)?)/i],[u,h],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-\w\w\d\d)(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[h,[u,Je],[d,k]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[h,"Xperia Tablet"],[u,Je],[d,M]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[h,[u,$t],[d,M]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[h,/(.+)/g,"Fire Phone $1"],[u,$t],[d,k]],[/(playbook);[-\w\),; ]+(rim)/i],[h,u,[d,M]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[h,[u,Ps],[d,k]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[h,[u,Ds],[d,M]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[h,[u,Ds],[d,k]],[/(nexus 9)/i],[h,[u,"HTC"],[d,M]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[u,[h,/_/g," "],[d,k]],[/tcl (xess p17aa)/i,/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])(_\w(\w|\w\w))?(\)| bui)/i],[h,[u,"TCL"],[d,M]],[/droid [\w\.]+; (418(?:7d|8v)|5087z|5102l|61(?:02[dh]|25[adfh]|27[ai]|56[dh]|59k|65[ah])|a509dl|t(?:43(?:0w|1[adepqu])|50(?:6d|7[adju])|6(?:09dl|10k|12b|71[efho]|76[hjk])|7(?:66[ahju]|67[hw]|7[045][bh]|71[hk]|73o|76[ho]|79w|81[hks]?|82h|90[bhsy]|99b)|810[hs]))(_\w(\w|\w\w))?(\)| bui)/i],[h,[u,"TCL"],[d,k]],[/(itel) ((\w+))/i],[[u,Se],h,[d,we,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[h,[u,"Acer"],[d,M]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[h,[u,"Meizu"],[d,k]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[h,[u,"Ulefone"],[d,k]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[h,[u,"Energizer"],[d,k]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[h,[u,"Cat"],[d,k]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[h,[u,"Smartfren"],[d,k]],[/droid.+; (a(in)?(0(15|59|6[35])|142)p?)/i],[h,[u,"Nothing"],[d,k]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[h,[u,"Archos"],[d,M]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[h,[u,"Archos"],[d,k]],[/; (n159v)/i],[h,[u,"HMD"],[d,k]],[/(imo) (tab \w+)/i,/(infinix|tecno) (x1101b?|p904|dp(7c|8d|10a)( pro)?|p70[1-3]a?|p904|t1101)/i],[u,h,[d,M]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (blu|hmd|imo|infinix|lava|oneplus|tcl)[_ ]([\w\+ ]+?)(?: bui|\)|; r)/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(oppo) ?([\w ]+) bui/i],[u,h,[d,k]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i],[u,h,[d,M]],[/(surface duo)/i],[h,[u,Mr],[d,M]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[h,[u,"Fairphone"],[d,k]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[h,[u,Ar],[d,M]],[/(sprint) (\w+)/i],[u,h,[d,k]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[u,Mr],[d,k]],[/droid.+; ([c6]+|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[h,[u,Fr],[d,M]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[h,[u,Fr],[d,k]],[/smart-tv.+(samsung)/i],[u,[d,D]],[/hbbtv.+maple;(\d+)/i],[[h,/^/,"SmartTV"],[u,Xe],[d,D]],[/(vizio)(?: |.+model\/)(\w+-\w+)/i,/tcast.+(lg)e?. ([-\w]+)/i],[u,h,[d,D]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[u,zt],[d,D]],[/(apple) ?tv/i],[u,[h,Ue+" TV"],[d,D]],[/crkey.*devicetype\/chromecast/i],[[h,De+" Third Generation"],[u,Me],[d,D]],[/crkey.*devicetype\/([^/]*)/i],[[h,/^/,"Chromecast "],[u,Me],[d,D]],[/fuchsia.*crkey/i],[[h,De+" Nest Hub"],[u,Me],[d,D]],[/crkey/i],[[h,De],[u,Me],[d,D]],[/(portaltv)/i],[h,[u,Br],[d,D]],[/droid.+aft(\w+)( bui|\))/i],[h,[u,$t],[d,D]],[/(shield \w+ tv)/i],[h,[u,Ar],[d,D]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[h,[u,Ls],[d,D]],[/(bravia[\w ]+)( bui|\))/i],[h,[u,Je],[d,D]],[/(mi(tv|box)-?\w+) bui/i],[h,[u,jr],[d,D]],[/Hbbtv.*(technisat) (.*);/i],[u,h,[d,D]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[u,/.+\/(\w+)/,"$1",we,{LG:"lge"}],[h,Gt],[d,D]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[h,[d,D]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:|large screen[\w ]+safari)\b/i],[[d,D]],[/(playstation \w+)/i],[h,[u,Je],[d,P]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[h,[u,Mr],[d,P]],[/(ouya)/i,/(nintendo) (\w+)/i,/(retroid) (pocket ([^\)]+))/i],[u,h,[d,P]],[/droid.+; (shield)( bui|\))/i],[h,[u,Ar],[d,P]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[h,[u,Xe],[d,I]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[u,h,[d,I]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[h,[u,Nr],[d,I]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[h,[u,Ue],[d,I]],[/(opwwe\d{3})/i],[h,[u,xs],[d,I]],[/(moto 360)/i],[h,[u,Or],[d,I]],[/(smartwatch 3)/i],[h,[u,Je],[d,I]],[/(g watch r)/i],[h,[u,zt],[d,I]],[/droid.+; (wt63?0{2,3})\)/i],[h,[u,Fr],[d,I]],[/droid.+; (glass) \d/i],[h,[u,Me],[d,E]],[/(pico) (4|neo3(?: link|pro)?)/i],[u,h,[d,E]],[/(quest( \d| pro)?s?).+vr/i],[h,[u,Br],[d,E]],[/mobile vr; rv.+firefox/i],[[d,E]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[u,[d,x]],[/(aeobc)\b/i],[h,[u,$t],[d,x]],[/(homepod).+mac os/i],[h,[u,Ue],[d,x]],[/windows iot/i],[[d,x]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+?(mobile|vr|\d) safari/i],[h,[d,we,{mobile:"Mobile",xr:"VR","*":M}]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,M]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,k]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[h,[u,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[a,Vt+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[a,f],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[a,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[a,f],[/ladybird\//i],[[a,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,a]],os:[[/(windows nt) (6\.[23]); arm/i],[[a,/N/,"R"],[f,we,Ns]],[/(windows (?:phone|mobile|iot))(?: os)?[\/ ]?([\d\.]*( se)?)/i,/(windows)[\/ ](1[01]|2000|3\.1|7|8(\.1)?|9[58]|me|server 20\d\d( r2)?|vista|xp)/i],[a,f],[/windows nt ?([\d\.\)]*)(?!.+xbox)/i,/\bwin(?=3| ?9|n)(?:nt| 9x )?([\d\.;]*)/i],[[f,/(;|\))/g,"",we,Ns],[a,qr]],[/(windows ce)\/?([\d\.]*)/i],[a,f],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[a,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+(haiku|morphos))/i],[[a,"macOS"],[f,/_/g,"."]],[/android ([\d\.]+).*crkey/i],[f,[a,De+" Android"]],[/fuchsia.*crkey\/([\d\.]+)/i],[f,[a,De+" Fuchsia"]],[/crkey\/([\d\.]+).*devicetype\/smartspeaker/i],[f,[a,De+" SmartSpeaker"]],[/linux.*crkey\/([\d\.]+)/i],[f,[a,De+" Linux"]],[/crkey\/([\d\.]+)/i],[f,[a,De]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[f,a],[/(ubuntu) ([\w\.]+) like android/i],[[a,/(.+)/,"$1 Touch"],f],[/(harmonyos)[\/ ]?([\d\.]*)/i,/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen)\w*[-\/\.; ]?([\d\.]*)/i],[a,f],[/\(bb(10);/i],[f,[a,Ps]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[f,[a,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[a,Ze+" OS"]],[/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i,/webos(?:[ \/]?|\.tv-20(?=2[2-9]))(\d[\d\.]*)/i],[f,[a,"webOS"]],[/web0s;.+?(?:chr[o0]me|safari)\/(\d+)/i],[[f,we,{25:"120",24:"108",23:"94",22:"87",6:"79",5:"68",4:"53",3:"38",2:"538",1:"537","*":"TV"}],[a,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[a,"watchOS"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[a,"Chrome OS"],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) (\w+)/i,/(xbox); +xbox ([^\);]+)/i,/(pico) .+os([\w\.]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/linux.+(mint)[\/\(\) ]?([\w\.]*)/i,/(mageia|vectorlinux|fuchsia|arcaos|arch(?= ?linux))[;l ]([\d\.]*)/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire|knoppix)(?: gnu[\/ ]linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/\b(aix)[; ]([1-9\.]{0,4})/i,/(hurd|linux|morphos)(?: (?:arm|x86|ppc)\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) ?(r\d)?/i],[a,f],[/(sunos) ?([\d\.]*)/i],[[a,"Solaris"],f],[/\b(beos|os\/2|amigaos|openvms|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[a,f]]},Qt=function(){var O={init:{},isIgnore:{},isIgnoreRgx:{},toString:{}};return Re.call(O.init,[[S,[a,f,T,d]],[p,[g]],[o,[d,h,u]],[r,[a,f]],[i,[a,f]]]),Re.call(O.isIgnore,[[S,[f,T]],[r,[f]],[i,[f]]]),Re.call(O.isIgnoreRgx,[[S,/ ?browser$/i],[i,/ ?os$/i]]),Re.call(O.toString,[[S,[a,f]],[p,[g]],[o,[u,h]],[r,[a,f]],[i,[a,f]]]),O}(),la=function(O,N){var j=Qt.init[N],H=Qt.isIgnore[N]||0,B=Qt.isIgnoreRgx[N]||0,K=Qt.toString[N]||0;function A(){Re.call(this,j)}return A.prototype.getItem=function(){return O},A.prototype.withClientHints=function(){return Pe?Pe.getHighEntropyValues(Ts).then(function(z){return O.setCH(new Bs(z,!1)).parseCH().get()}):O.parseCH().get()},A.prototype.withFeatureCheck=function(){return O.detectFeature().get()},N!=c&&(A.prototype.is=function(z){var U=!1;for(var G in this)if(this.hasOwnProperty(G)&&!Ur(H,G)&&Se(B?Ve(B,this[G]):this[G])==Se(B?Ve(B,z):z)){if(U=!0,z!=v)break}else if(z==v&&U){U=!U;break}return U},A.prototype.toString=function(){var z=y;for(var U in K)typeof this[K[U]]!==v&&(z+=(z?" ":y)+this[K[U]]);return z||v}),Pe||(A.prototype.then=function(z){var U=this,G=function(){for(var ke in U)U.hasOwnProperty(ke)&&(this[ke]=U[ke])};G.prototype={is:A.prototype.is,toString:A.prototype.toString};var Ce=new G;return z(Ce),Ce}),new A};function Bs(O,N){if(O=O||{},Re.call(this,Ts),N)Re.call(this,[[F,$r(O[ee])],[V,$r(O[_e])],[k,/\?1/.test(O[aa])],[h,rt(O[oa])],[Y,rt(O[Cs])],[ce,rt(O[ca])],[g,rt(O[sa])],[q,$r(O[na])],[le,rt(O[ia])]]);else for(var j in O)this.hasOwnProperty(j)&&typeof O[j]!==v&&(this[j]=O[j])}function qs(O,N,j,H){return this.get=function(B){return B?this.data.hasOwnProperty(B)?this.data[B]:t:this.data},this.set=function(B,K){return this.data[B]=K,this},this.setCH=function(B){return this.uaCH=B,this},this.detectFeature=function(){if(ne&&ne.userAgent==this.ua)switch(this.itemType){case S:ne.brave&&typeof ne.brave.isBrave==R&&this.set(a,"Brave");break;case o:!this.get(d)&&Pe&&Pe[k]&&this.set(d,k),this.get(h)=="Macintosh"&&ne&&typeof ne.standalone!==v&&ne.maxTouchPoints&&ne.maxTouchPoints>2&&this.set(h,"iPad").set(d,M);break;case i:!this.get(a)&&Pe&&Pe[Y]&&this.set(a,Pe[Y]);break;case c:var B=this.data,K=function(A){return B[A].getItem().detectFeature().get()};this.set(S,K(S)).set(p,K(p)).set(o,K(o)).set(r,K(r)).set(i,K(i))}return this},this.parseUA=function(){return this.itemType!=c&&Vr.call(this.data,this.ua,this.rgxMap),this.itemType==S&&this.set(T,zr(this.get(f))),this},this.parseCH=function(){var B=this.uaCH,K=this.rgxMap;switch(this.itemType){case S:case r:var A=B[V]||B[F],z;if(A)for(var U in A){var G=A[U].brand||A[U],Ce=A[U].version;this.itemType==S&&!/not.a.brand/i.test(G)&&(!z||/Chrom/.test(z)&&G!=Ms||z==Vt&&/WebView2/.test(G))&&(G=we(G,pa),z=this.get(a),z&&!/Chrom/.test(z)&&/Chrom/.test(G)||this.set(a,G).set(f,Ce).set(T,zr(Ce)),z=G),this.itemType==r&&G==Ms&&this.set(f,Ce)}break;case p:var ke=B[g];ke&&(ke&&B[le]=="64"&&(ke+="64"),Vr.call(this.data,ke+";",K));break;case o:if(B[k]&&this.set(d,k),B[h]&&(this.set(h,B[h]),!this.get(d)||!this.get(u))){var st={};Vr.call(st,"droid 9; "+B[h]+")",K),!this.get(d)&&st.type&&this.set(d,st.type),!this.get(u)&&st.vendor&&this.set(u,st.vendor)}if(B[q]){var Yt;if(typeof B[q]!="string")for(var Us=0;!Yt&&Us<B[q].length;)Yt=we(B[q][Us++],js);else Yt=we(B[q],js);this.set(d,Yt)}break;case i:var Hr=B[Y];if(Hr){var Kr=B[ce];Hr==qr&&(Kr=parseInt(zr(Kr),10)>=13?"11":"10"),this.set(a,Hr).set(f,Kr)}this.get(a)==qr&&B[h]=="Xbox"&&this.set(a,"Xbox").set(f,t);break;case c:var ua=this.data,it=function(ha){return ua[ha].getItem().setCH(B).parseCH().get()};this.set(S,it(S)).set(p,it(p)).set(o,it(o)).set(r,it(r)).set(i,it(i))}return this},Re.call(this,[["itemType",O],["ua",N],["uaCH",H],["rgxMap",j],["data",la(this,O)]]),this}function ue(O,N,j){if(typeof O===l?(Kt(O,!0)?(typeof N===l&&(j=N),N=O):(j=O,N=t),O=t):typeof O===b&&!Kt(N,!0)&&(j=N,N=t),j&&typeof j.append===R){var H={};j.forEach(function(U,G){H[G]=U}),j=H}if(!(this instanceof ue))return new ue(O,N,j).getResult();var B=typeof O===b?O:j&&j[w]?j[w]:ne&&ne.userAgent?ne.userAgent:y,K=new Bs(j,!0),A=N?da(Fs,N):Fs,z=function(U){return U==c?function(){return new qs(U,B,A,K).set("ua",B).set(S,this.getBrowser()).set(p,this.getCPU()).set(o,this.getDevice()).set(r,this.getEngine()).set(i,this.getOS()).get()}:function(){return new qs(U,B,A[U],K).parseUA().get()}};return Re.call(this,[["getBrowser",z(S)],["getCPU",z(p)],["getDevice",z(o)],["getEngine",z(r)],["getOS",z(i)],["getResult",z(c)],["getUA",function(){return B}],["setUA",function(U){return ze(U)&&(B=U.length>m?Gt(U,m):U),this}]]).setUA(B),this}ue.VERSION=_,ue.BROWSER=Ht([a,f,T,d]),ue.CPU=Ht([g]),ue.DEVICE=Ht([h,u,d,P,k,D,M,I,x]),ue.ENGINE=ue.OS=Ht([a,f]),n.exports&&(e=n.exports=ue),e.UAParser=ue;var He=As&&(s.jQuery||s.Zepto);if(He&&!He.ua){var Wt=new ue;He.ua=Wt.getResult(),He.ua.get=function(){return Wt.getUA()},He.ua.set=function(O){Wt.setUA(O);var N=Wt.getResult();for(var j in N)He.ua[j]=N[j]}}})(typeof window=="object"?window:fo)}(Ft,Ft.exports)),Ft.exports}var ot={},Zs;function Q(){if(Zs)return ot;Zs=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.Logger=void 0;const n=Pr(),e="mediasoup-client";class s{_debug;_warn;_error;constructor(_){_?(this._debug=(0,n.default)(`${e}:${_}`),this._warn=(0,n.default)(`${e}:WARN:${_}`),this._error=(0,n.default)(`${e}:ERROR:${_}`)):(this._debug=(0,n.default)(e),this._warn=(0,n.default)(`${e}:WARN`),this._error=(0,n.default)(`${e}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}return ot.Logger=s,ot}var ct={},er={exports:{}},ei;function go(){if(ei)return er.exports;ei=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(u,f,g){return Function.prototype.apply.call(u,f,g)},s;n&&typeof n.ownKeys=="function"?s=n.ownKeys:Object.getOwnPropertySymbols?s=function(u){return Object.getOwnPropertyNames(u).concat(Object.getOwnPropertySymbols(u))}:s=function(u){return Object.getOwnPropertyNames(u)};function t(d){console&&console.warn&&console.warn(d)}var _=Number.isNaN||function(u){return u!==u};function m(){m.init.call(this)}er.exports=m,er.exports.once=i,m.EventEmitter=m,m.prototype._events=void 0,m.prototype._eventsCount=0,m.prototype._maxListeners=void 0;var w=10;function y(d){if(typeof d!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof d)}Object.defineProperty(m,"defaultMaxListeners",{enumerable:!0,get:function(){return w},set:function(d){if(typeof d!="number"||d<0||_(d))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+d+".");w=d}}),m.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},m.prototype.setMaxListeners=function(u){if(typeof u!="number"||u<0||_(u))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+u+".");return this._maxListeners=u,this};function C(d){return d._maxListeners===void 0?m.defaultMaxListeners:d._maxListeners}m.prototype.getMaxListeners=function(){return C(this)},m.prototype.emit=function(u){for(var f=[],g=1;g<arguments.length;g++)f.push(arguments[g]);var T=u==="error",h=this._events;if(h!==void 0)T=T&&h.error===void 0;else if(!T)return!1;if(T){var P;if(f.length>0&&(P=f[0]),P instanceof Error)throw P;var k=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw k.context=P,k}var M=h[u];if(M===void 0)return!1;if(typeof M=="function")e(M,this,f);else for(var D=M.length,I=p(M,D),g=0;g<D;++g)e(I[g],this,f);return!0};function R(d,u,f,g){var T,h,P;if(y(f),h=d._events,h===void 0?(h=d._events=Object.create(null),d._eventsCount=0):(h.newListener!==void 0&&(d.emit("newListener",u,f.listener?f.listener:f),h=d._events),P=h[u]),P===void 0)P=h[u]=f,++d._eventsCount;else if(typeof P=="function"?P=h[u]=g?[f,P]:[P,f]:g?P.unshift(f):P.push(f),T=C(d),T>0&&P.length>T&&!P.warned){P.warned=!0;var k=new Error("Possible EventEmitter memory leak detected. "+P.length+" "+String(u)+" listeners added. Use emitter.setMaxListeners() to increase limit");k.name="MaxListenersExceededWarning",k.emitter=d,k.type=u,k.count=P.length,t(k)}return d}m.prototype.addListener=function(u,f){return R(this,u,f,!1)},m.prototype.on=m.prototype.addListener,m.prototype.prependListener=function(u,f){return R(this,u,f,!0)};function v(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(d,u,f){var g={fired:!1,wrapFn:void 0,target:d,type:u,listener:f},T=v.bind(g);return T.listener=f,g.wrapFn=T,T}m.prototype.once=function(u,f){return y(f),this.on(u,l(this,u,f)),this},m.prototype.prependOnceListener=function(u,f){return y(f),this.prependListener(u,l(this,u,f)),this},m.prototype.removeListener=function(u,f){var g,T,h,P,k;if(y(f),T=this._events,T===void 0)return this;if(g=T[u],g===void 0)return this;if(g===f||g.listener===f)--this._eventsCount===0?this._events=Object.create(null):(delete T[u],T.removeListener&&this.emit("removeListener",u,g.listener||f));else if(typeof g!="function"){for(h=-1,P=g.length-1;P>=0;P--)if(g[P]===f||g[P].listener===f){k=g[P].listener,h=P;break}if(h<0)return this;h===0?g.shift():o(g,h),g.length===1&&(T[u]=g[0]),T.removeListener!==void 0&&this.emit("removeListener",u,k||f)}return this},m.prototype.off=m.prototype.removeListener,m.prototype.removeAllListeners=function(u){var f,g,T;if(g=this._events,g===void 0)return this;if(g.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):g[u]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete g[u]),this;if(arguments.length===0){var h=Object.keys(g),P;for(T=0;T<h.length;++T)P=h[T],P!=="removeListener"&&this.removeAllListeners(P);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(f=g[u],typeof f=="function")this.removeListener(u,f);else if(f!==void 0)for(T=f.length-1;T>=0;T--)this.removeListener(u,f[T]);return this};function b(d,u,f){var g=d._events;if(g===void 0)return[];var T=g[u];return T===void 0?[]:typeof T=="function"?f?[T.listener||T]:[T]:f?r(T):p(T,T.length)}m.prototype.listeners=function(u){return b(this,u,!0)},m.prototype.rawListeners=function(u){return b(this,u,!1)},m.listenerCount=function(d,u){return typeof d.listenerCount=="function"?d.listenerCount(u):S.call(d,u)},m.prototype.listenerCount=S;function S(d){var u=this._events;if(u!==void 0){var f=u[d];if(typeof f=="function")return 1;if(f!==void 0)return f.length}return 0}m.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]};function p(d,u){for(var f=new Array(u),g=0;g<u;++g)f[g]=d[g];return f}function o(d,u){for(;u+1<d.length;u++)d[u]=d[u+1];d.pop()}function r(d){for(var u=new Array(d.length),f=0;f<u.length;++f)u[f]=d[f].listener||d[f];return u}function i(d,u){return new Promise(function(f,g){function T(P){d.removeListener(u,h),g(P)}function h(){typeof d.removeListener=="function"&&d.removeListener("error",T),f([].slice.call(arguments))}a(d,u,h,{once:!0}),u!=="error"&&c(d,T,{once:!0})})}function c(d,u,f){typeof d.on=="function"&&a(d,"error",u,f)}function a(d,u,f,g){if(typeof d.on=="function")g.once?d.once(u,f):d.on(u,f);else if(typeof d.addEventListener=="function")d.addEventListener(u,function T(h){g.once&&d.removeEventListener(u,T),f(h)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof d)}return er.exports}var ti;function xe(){if(ti)return ct;ti=1,Object.defineProperty(ct,"__esModule",{value:!0}),ct.EnhancedEventEmitter=void 0;const n=go(),e=Q(),s=new e.Logger("EnhancedEventEmitter");class t extends n.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(m,...w){return super.emit(m,...w)}safeEmit(m,...w){try{return super.emit(m,...w)}catch(y){s.error("safeEmit() | event listener threw an error [eventName:%s]:%o",m,y);try{super.emit("listenererror",m,y)}catch{}return!!super.listenerCount(m)}}on(m,w){return super.on(m,w),this}off(m,w){return super.off(m,w),this}addListener(m,w){return super.on(m,w),this}prependListener(m,w){return super.prependListener(m,w),this}once(m,w){return super.once(m,w),this}prependOnceListener(m,w){return super.prependOnceListener(m,w),this}removeListener(m,w){return super.off(m,w),this}removeAllListeners(m){return super.removeAllListeners(m),this}listenerCount(m){return super.listenerCount(m)}listeners(m){return super.listeners(m)}rawListeners(m){return super.rawListeners(m)}}return ct.EnhancedEventEmitter=t,ct}var Ne={},ri;function te(){if(ri)return Ne;ri=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.InvalidStateError=Ne.UnsupportedError=void 0;class n extends Error{constructor(t){super(t),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,n):this.stack=new Error(t).stack}}Ne.UnsupportedError=n;class e extends Error{constructor(t){super(t),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,e):this.stack=new Error(t).stack}}return Ne.InvalidStateError=e,Ne}var Ke={},si;function X(){if(si)return Ke;si=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.clone=n,Ke.generateRandomNumber=e,Ke.deepFreeze=s;function n(t){if(t!==void 0)return Number.isNaN(t)?NaN:typeof structuredClone=="function"?structuredClone(t):JSON.parse(JSON.stringify(t))}function e(){return Math.round(Math.random()*1e7)}function s(t){const _=Reflect.ownKeys(t);for(const m of _){const w=t[m];(w&&typeof w=="object"||typeof w=="function")&&s(w)}return Object.freeze(t)}return Ke}var se={},J={},je={},ii;function _o(){if(ii)return je;ii=1;var n=je&&je.__importDefault||function(_){return _&&_.__esModule?_:{default:_}};Object.defineProperty(je,"__esModule",{value:!0}),je.Logger=void 0;const e=n(Pr()),s="h264-profile-level-id";class t{constructor(m){m?(this._debug=(0,e.default)(`${s}:${m}`),this._warn=(0,e.default)(`${s}:WARN:${m}`),this._error=(0,e.default)(`${s}:ERROR:${m}`)):(this._debug=(0,e.default)(s),this._warn=(0,e.default)(`${s}:WARN`),this._error=(0,e.default)(`${s}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}return je.Logger=t,je}var ni;function wo(){if(ni)return J;ni=1,Object.defineProperty(J,"__esModule",{value:!0}),J.ProfileLevelId=J.Level=J.Profile=void 0,J.parseProfileLevelId=v,J.profileLevelIdToString=l,J.profileToString=b,J.levelToString=S,J.parseSdpProfileLevelId=p,J.isSameProfile=o,J.isSameProfileAndLevel=r,J.generateProfileLevelIdStringForAnswer=i,J.supportedLevel=c;const n=_o(),e=new n.Logger;var s;(function(g){g[g.ConstrainedBaseline=1]="ConstrainedBaseline",g[g.Baseline=2]="Baseline",g[g.Main=3]="Main",g[g.ConstrainedHigh=4]="ConstrainedHigh",g[g.High=5]="High",g[g.PredictiveHigh444=6]="PredictiveHigh444"})(s||(J.Profile=s={}));var t;(function(g){g[g.L1_b=0]="L1_b",g[g.L1=10]="L1",g[g.L1_1=11]="L1_1",g[g.L1_2=12]="L1_2",g[g.L1_3=13]="L1_3",g[g.L2=20]="L2",g[g.L2_1=21]="L2_1",g[g.L2_2=22]="L2_2",g[g.L3=30]="L3",g[g.L3_1=31]="L3_1",g[g.L3_2=32]="L3_2",g[g.L4=40]="L4",g[g.L4_1=41]="L4_1",g[g.L4_2=42]="L4_2",g[g.L5=50]="L5",g[g.L5_1=51]="L5_1",g[g.L5_2=52]="L5_2"})(t||(J.Level=t={}));class _{constructor(T,h){this.profile=T,this.level=h}}J.ProfileLevelId=_;const m=new _(s.ConstrainedBaseline,t.L3_1);class w{constructor(T){this.mask=~a("x",T),this.masked_value=a("1",T)}isMatch(T){return this.masked_value===(T&this.mask)}}class y{constructor(T,h,P){this.profile_idc=T,this.profile_iop=h,this.profile=P}}const C=[new y(66,new w("x1xx0000"),s.ConstrainedBaseline),new y(77,new w("1xxx0000"),s.ConstrainedBaseline),new y(88,new w("11xx0000"),s.ConstrainedBaseline),new y(66,new w("x0xx0000"),s.Baseline),new y(88,new w("10xx0000"),s.Baseline),new y(77,new w("0x0x0000"),s.Main),new y(100,new w("00000000"),s.High),new y(100,new w("00001100"),s.ConstrainedHigh),new y(244,new w("00000000"),s.PredictiveHigh444)],R=[{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:t.L1},{max_macroblocks_per_second:1485,max_macroblock_frame_size:99,level:t.L1_b},{max_macroblocks_per_second:3e3,max_macroblock_frame_size:396,level:t.L1_1},{max_macroblocks_per_second:6e3,max_macroblock_frame_size:396,level:t.L1_2},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:t.L1_3},{max_macroblocks_per_second:11880,max_macroblock_frame_size:396,level:t.L2},{max_macroblocks_per_second:19800,max_macroblock_frame_size:792,level:t.L2_1},{max_macroblocks_per_second:20250,max_macroblock_frame_size:1620,level:t.L2_2},{max_macroblocks_per_second:40500,max_macroblock_frame_size:1620,level:t.L3},{max_macroblocks_per_second:108e3,max_macroblock_frame_size:3600,level:t.L3_1},{max_macroblocks_per_second:216e3,max_macroblock_frame_size:5120,level:t.L3_2},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:t.L4},{max_macroblocks_per_second:245760,max_macroblock_frame_size:8192,level:t.L4_1},{max_macroblocks_per_second:522240,max_macroblock_frame_size:8704,level:t.L4_2},{max_macroblocks_per_second:589824,max_macroblock_frame_size:22080,level:t.L5},{max_macroblocks_per_second:983040,max_macroblock_frame_size:36864,level:t.L5_1},{max_macroblocks_per_second:2073600,max_macroblock_frame_size:36864,level:t.L5_2}];function v(g){if(typeof g!="string"||g.length!==6)return;const h=parseInt(g,16);if(h===0)return;const P=h&255,k=h>>8&255,M=h>>16&255;let D;switch(P){case t.L1_1:{D=(k&16)!==0?t.L1_b:t.L1_1;break}case t.L1:case t.L1_2:case t.L1_3:case t.L2:case t.L2_1:case t.L2_2:case t.L3:case t.L3_1:case t.L3_2:case t.L4:case t.L4_1:case t.L4_2:case t.L5:case t.L5_1:case t.L5_2:{D=P;break}default:{e.warn(`parseProfileLevelId() | unrecognized level_idc [str:${g}, level_idc:${P}]`);return}}for(const I of C)if(M===I.profile_idc&&I.profile_iop.isMatch(k))return e.debug(`parseProfileLevelId() | result [str:${g}, profile:${I.profile}, level:${D}]`),new _(I.profile,D);e.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${g}, profile_idc:${M}, profile_iop:${k}]`)}function l(g){if(g.level==t.L1_b)switch(g.profile){case s.ConstrainedBaseline:return"42f00b";case s.Baseline:return"42100b";case s.Main:return"4d100b";default:{e.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${g.profile}`);return}}let T;switch(g.profile){case s.ConstrainedBaseline:{T="42e0";break}case s.Baseline:{T="4200";break}case s.Main:{T="4d00";break}case s.ConstrainedHigh:{T="640c";break}case s.High:{T="6400";break}case s.PredictiveHigh444:{T="f400";break}default:{e.warn(`profileLevelIdToString() | unrecognized profile ${g.profile}`);return}}let h=g.level.toString(16);return h.length===1&&(h=`0${h}`),`${T}${h}`}function b(g){switch(g){case s.ConstrainedBaseline:return"ConstrainedBaseline";case s.Baseline:return"Baseline";case s.Main:return"Main";case s.ConstrainedHigh:return"ConstrainedHigh";case s.High:return"High";case s.PredictiveHigh444:return"PredictiveHigh444";default:{e.warn(`profileToString() | unrecognized profile ${g}`);return}}}function S(g){switch(g){case t.L1_b:return"1b";case t.L1:return"1";case t.L1_1:return"1.1";case t.L1_2:return"1.2";case t.L1_3:return"1.3";case t.L2:return"2";case t.L2_1:return"2.1";case t.L2_2:return"2.2";case t.L3:return"3";case t.L3_1:return"3.1";case t.L3_2:return"3.2";case t.L4:return"4";case t.L4_1:return"4.1";case t.L4_2:return"4.2";case t.L5:return"5";case t.L5_1:return"5.1";case t.L5_2:return"5.2";default:{e.warn(`levelToString() | unrecognized level ${g}`);return}}}function p(g={}){const T=g["profile-level-id"];return T?v(T):m}function o(g={},T={}){const h=p(g),P=p(T);return!!(h&&P&&h.profile===P.profile)}function r(g={},T={}){const h=p(g),P=p(T);return!!(h&&P&&h.profile===P.profile&&h.level==P.level)}function i(g={},T={}){if(!g["profile-level-id"]&&!T["profile-level-id"]){e.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");return}const h=p(g),P=p(T);if(!h)throw new TypeError("invalid local_profile_level_id");if(!P)throw new TypeError("invalid remote_profile_level_id");if(h.profile!==P.profile)throw new TypeError("H264 Profile mismatch");const k=f(g)&&f(T),M=h.level,D=P.level,I=u(M,D),E=k?M:I;return e.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${h.profile}, level:${E}]`),l(new _(h.profile,E))}function c(g,T){for(let P=R.length-1;P>=0;--P){const k=R[P];if(k.max_macroblock_frame_size*256<=g&&k.max_macroblocks_per_second<=T*k.max_macroblock_frame_size)return e.debug(`supportedLevel() | result [max_frame_pixel_count:${g}, max_fps:${T}, level:${k.level}]`),k.level}e.warn(`supportedLevel() | no level supported [max_frame_pixel_count:${g}, max_fps:${T}]`)}function a(g,T){return+(T[0]===g)<<7|+(T[1]===g)<<6|+(T[2]===g)<<5|+(T[3]===g)<<4|+(T[4]===g)<<3|+(T[5]===g)<<2|+(T[6]===g)<<1|+(T[7]===g)<<0}function d(g,T){return g===t.L1_b?T!==t.L1&&T!==t.L1_b:T===t.L1_b?g!==t.L1:g<T}function u(g,T){return d(g,T)?g:T}function f(g={}){const T=g["level-asymmetry-allowed"];return T===!0||T===1||T==="1"}return J}var ai;function re(){if(ai)return se;ai=1,Object.defineProperty(se,"__esModule",{value:!0}),se.validateRtpCapabilities=m,se.validateRtpParameters=w,se.validateSctpStreamParameters=y,se.validateSctpCapabilities=C,se.getExtendedRtpCapabilities=R,se.getRecvRtpCapabilities=v,se.getSendingRtpParameters=l,se.getSendingRemoteRtpParameters=b,se.reduceCodecs=S,se.generateProbatorRtpParameters=p,se.canSend=o,se.canReceive=r;const n=wo(),e=X(),s="probator",t=1234,_=127;function m(D){if(typeof D!="object")throw new TypeError("caps is not an object");if(D.codecs&&!Array.isArray(D.codecs))throw new TypeError("caps.codecs is not an array");D.codecs||(D.codecs=[]);for(const I of D.codecs)i(I);if(D.headerExtensions&&!Array.isArray(D.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");D.headerExtensions||(D.headerExtensions=[]);for(const I of D.headerExtensions)a(I)}function w(D){if(typeof D!="object")throw new TypeError("params is not an object");if(D.mid&&typeof D.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(D.codecs))throw new TypeError("missing params.codecs");for(const I of D.codecs)d(I);if(D.headerExtensions&&!Array.isArray(D.headerExtensions))throw new TypeError("params.headerExtensions is not an array");D.headerExtensions||(D.headerExtensions=[]);for(const I of D.headerExtensions)u(I);if(D.encodings&&!Array.isArray(D.encodings))throw new TypeError("params.encodings is not an array");D.encodings||(D.encodings=[]);for(const I of D.encodings)f(I);if(D.rtcp&&typeof D.rtcp!="object")throw new TypeError("params.rtcp is not an object");D.rtcp||(D.rtcp={}),g(D.rtcp)}function y(D){if(typeof D!="object")throw new TypeError("params is not an object");if(typeof D.streamId!="number")throw new TypeError("missing params.streamId");let I=!1;if(typeof D.ordered=="boolean"?I=!0:D.ordered=!0,D.maxPacketLifeTime&&typeof D.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(D.maxRetransmits&&typeof D.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(D.maxPacketLifeTime&&D.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(I&&D.ordered&&(D.maxPacketLifeTime||D.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(!I&&(D.maxPacketLifeTime||D.maxRetransmits)&&(D.ordered=!1),D.label&&typeof D.label!="string")throw new TypeError("invalid params.label");if(D.protocol&&typeof D.protocol!="string")throw new TypeError("invalid params.protocol")}function C(D){if(typeof D!="object")throw new TypeError("caps is not an object");if(!D.numStreams||typeof D.numStreams!="object")throw new TypeError("missing caps.numStreams");T(D.numStreams)}function R(D,I,E){const x={codecs:[],headerExtensions:[]};if(E)for(const L of D.codecs??[]){if(h(L))continue;const F=(I.codecs??[]).find(V=>P(V,L,{strict:!0,modify:!0}));if(!F)continue;const q={mimeType:L.mimeType,kind:L.kind,clockRate:L.clockRate,channels:L.channels,localPayloadType:L.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:F.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:L.parameters,remoteParameters:F.parameters,rtcpFeedback:M(L,F)};x.codecs.push(q)}else for(const L of I.codecs??[]){if(h(L))continue;const F=(D.codecs??[]).find(V=>P(V,L,{strict:!0,modify:!0}));if(!F)continue;const q={mimeType:F.mimeType,kind:F.kind,clockRate:F.clockRate,channels:F.channels,localPayloadType:F.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:L.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:F.parameters,remoteParameters:L.parameters,rtcpFeedback:M(F,L)};x.codecs.push(q)}for(const L of x.codecs){const F=D.codecs.find(V=>h(V)&&V.parameters.apt===L.localPayloadType),q=I.codecs.find(V=>h(V)&&V.parameters.apt===L.remotePayloadType);F&&q&&(L.localRtxPayloadType=F.preferredPayloadType,L.remoteRtxPayloadType=q.preferredPayloadType)}for(const L of I.headerExtensions){const F=D.headerExtensions.find(V=>k(V,L));if(!F)continue;const q={kind:L.kind,uri:L.uri,sendId:F.preferredId,recvId:L.preferredId,encrypt:F.preferredEncrypt,direction:"sendrecv"};switch(L.direction){case"sendrecv":{q.direction="sendrecv";break}case"recvonly":{q.direction="sendonly";break}case"sendonly":{q.direction="recvonly";break}case"inactive":{q.direction="inactive";break}}x.headerExtensions.push(q)}return x}function v(D){const I={codecs:[],headerExtensions:[]};for(const E of D.codecs){const x={mimeType:E.mimeType,kind:E.kind,preferredPayloadType:E.remotePayloadType,clockRate:E.clockRate,channels:E.channels,parameters:E.localParameters,rtcpFeedback:E.rtcpFeedback};if(I.codecs.push(x),!E.remoteRtxPayloadType)continue;const L={mimeType:`${E.kind}/rtx`,kind:E.kind,preferredPayloadType:E.remoteRtxPayloadType,clockRate:E.clockRate,parameters:{apt:E.remotePayloadType},rtcpFeedback:[]};I.codecs.push(L)}for(const E of D.headerExtensions){if(E.direction!=="sendrecv"&&E.direction!=="recvonly")continue;const x={kind:E.kind,uri:E.uri,preferredId:E.recvId,preferredEncrypt:E.encrypt,direction:E.direction};I.headerExtensions.push(x)}return I}function l(D,I){const E={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const x of I.codecs){if(x.kind!==D)continue;const L={mimeType:x.mimeType,payloadType:x.localPayloadType,clockRate:x.clockRate,channels:x.channels,parameters:x.localParameters,rtcpFeedback:x.rtcpFeedback};if(E.codecs.push(L),x.localRtxPayloadType){const F={mimeType:`${x.kind}/rtx`,payloadType:x.localRtxPayloadType,clockRate:x.clockRate,parameters:{apt:x.localPayloadType},rtcpFeedback:[]};E.codecs.push(F)}}for(const x of I.headerExtensions){if(x.kind&&x.kind!==D||x.direction!=="sendrecv"&&x.direction!=="sendonly")continue;const L={uri:x.uri,id:x.sendId,encrypt:x.encrypt,parameters:{}};E.headerExtensions.push(L)}return E}function b(D,I){const E={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const x of I.codecs){if(x.kind!==D)continue;const L={mimeType:x.mimeType,payloadType:x.localPayloadType,clockRate:x.clockRate,channels:x.channels,parameters:x.remoteParameters,rtcpFeedback:x.rtcpFeedback};if(E.codecs.push(L),x.localRtxPayloadType){const F={mimeType:`${x.kind}/rtx`,payloadType:x.localRtxPayloadType,clockRate:x.clockRate,parameters:{apt:x.localPayloadType},rtcpFeedback:[]};E.codecs.push(F)}}for(const x of I.headerExtensions){if(x.kind&&x.kind!==D||x.direction!=="sendrecv"&&x.direction!=="sendonly")continue;const L={uri:x.uri,id:x.sendId,encrypt:x.encrypt,parameters:{}};E.headerExtensions.push(L)}if(E.headerExtensions.some(x=>x.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const x of E.codecs)x.rtcpFeedback=(x.rtcpFeedback??[]).filter(L=>L.type!=="goog-remb");else if(E.headerExtensions.some(x=>x.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const x of E.codecs)x.rtcpFeedback=(x.rtcpFeedback??[]).filter(L=>L.type!=="transport-cc");else for(const x of E.codecs)x.rtcpFeedback=(x.rtcpFeedback??[]).filter(L=>L.type!=="transport-cc"&&L.type!=="goog-remb");return E}function S(D,I){const E=[];if(!I)E.push(D[0]),h(D[1])&&E.push(D[1]);else{for(let x=0;x<D.length;++x)if(P(D[x],I,{strict:!0})){E.push(D[x]),h(D[x+1])&&E.push(D[x+1]);break}if(E.length===0)throw new TypeError("no matching codec found")}return E}function p(D){D=e.clone(D),w(D);const I={mid:s,codecs:[],headerExtensions:[],encodings:[{ssrc:t}],rtcp:{cname:"probator"}};return I.codecs.push(D.codecs[0]),I.codecs[0].payloadType=_,I.headerExtensions=D.headerExtensions,I}function o(D,I){return I.codecs.some(E=>E.kind===D)}function r(D,I){if(w(D),D.codecs.length===0)return!1;const E=D.codecs[0];return I.codecs.some(x=>x.remotePayloadType===E.payloadType)}function i(D){const I=new RegExp("^(audio|video)/(.+)","i");if(typeof D!="object")throw new TypeError("codec is not an object");if(!D.mimeType||typeof D.mimeType!="string")throw new TypeError("missing codec.mimeType");const E=I.exec(D.mimeType);if(!E)throw new TypeError("invalid codec.mimeType");if(D.kind=E[1].toLowerCase(),D.preferredPayloadType&&typeof D.preferredPayloadType!="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof D.clockRate!="number")throw new TypeError("missing codec.clockRate");D.kind==="audio"?typeof D.channels!="number"&&(D.channels=1):delete D.channels,(!D.parameters||typeof D.parameters!="object")&&(D.parameters={});for(const x of Object.keys(D.parameters)){let L=D.parameters[x];if(L===void 0&&(D.parameters[x]="",L=""),typeof L!="string"&&typeof L!="number")throw new TypeError(`invalid codec parameter [key:${x}s, value:${L}]`);if(x==="apt"&&typeof L!="number")throw new TypeError("invalid codec apt parameter")}(!D.rtcpFeedback||!Array.isArray(D.rtcpFeedback))&&(D.rtcpFeedback=[]);for(const x of D.rtcpFeedback)c(x)}function c(D){if(typeof D!="object")throw new TypeError("fb is not an object");if(!D.type||typeof D.type!="string")throw new TypeError("missing fb.type");(!D.parameter||typeof D.parameter!="string")&&(D.parameter="")}function a(D){if(typeof D!="object")throw new TypeError("ext is not an object");if(D.kind!=="audio"&&D.kind!=="video")throw new TypeError("invalid ext.kind");if(!D.uri||typeof D.uri!="string")throw new TypeError("missing ext.uri");if(typeof D.preferredId!="number")throw new TypeError("missing ext.preferredId");if(D.preferredEncrypt&&typeof D.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(D.preferredEncrypt||(D.preferredEncrypt=!1),D.direction&&typeof D.direction!="string")throw new TypeError("invalid ext.direction");D.direction||(D.direction="sendrecv")}function d(D){const I=new RegExp("^(audio|video)/(.+)","i");if(typeof D!="object")throw new TypeError("codec is not an object");if(!D.mimeType||typeof D.mimeType!="string")throw new TypeError("missing codec.mimeType");const E=I.exec(D.mimeType);if(!E)throw new TypeError("invalid codec.mimeType");if(typeof D.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof D.clockRate!="number")throw new TypeError("missing codec.clockRate");E[1].toLowerCase()==="audio"?typeof D.channels!="number"&&(D.channels=1):delete D.channels,(!D.parameters||typeof D.parameters!="object")&&(D.parameters={});for(const L of Object.keys(D.parameters)){let F=D.parameters[L];if(F===void 0&&(D.parameters[L]="",F=""),typeof F!="string"&&typeof F!="number")throw new TypeError(`invalid codec parameter [key:${L}s, value:${F}]`);if(L==="apt"&&typeof F!="number")throw new TypeError("invalid codec apt parameter")}(!D.rtcpFeedback||!Array.isArray(D.rtcpFeedback))&&(D.rtcpFeedback=[]);for(const L of D.rtcpFeedback)c(L)}function u(D){if(typeof D!="object")throw new TypeError("ext is not an object");if(!D.uri||typeof D.uri!="string")throw new TypeError("missing ext.uri");if(typeof D.id!="number")throw new TypeError("missing ext.id");if(D.encrypt&&typeof D.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");D.encrypt||(D.encrypt=!1),(!D.parameters||typeof D.parameters!="object")&&(D.parameters={});for(const I of Object.keys(D.parameters)){let E=D.parameters[I];if(E===void 0&&(D.parameters[I]="",E=""),typeof E!="string"&&typeof E!="number")throw new TypeError("invalid header extension parameter")}}function f(D){if(typeof D!="object")throw new TypeError("encoding is not an object");if(D.ssrc&&typeof D.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(D.rid&&typeof D.rid!="string")throw new TypeError("invalid encoding.rid");if(D.rtx&&typeof D.rtx!="object")throw new TypeError("invalid encoding.rtx");if(D.rtx&&typeof D.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if((!D.dtx||typeof D.dtx!="boolean")&&(D.dtx=!1),D.scalabilityMode&&typeof D.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function g(D){if(typeof D!="object")throw new TypeError("rtcp is not an object");if(D.cname&&typeof D.cname!="string")throw new TypeError("invalid rtcp.cname");(!D.reducedSize||typeof D.reducedSize!="boolean")&&(D.reducedSize=!0)}function T(D){if(typeof D!="object")throw new TypeError("numStreams is not an object");if(typeof D.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof D.MIS!="number")throw new TypeError("missing numStreams.MIS")}function h(D){return D?/.+\/rtx$/i.test(D.mimeType):!1}function P(D,I,{strict:E=!1,modify:x=!1}={}){const L=D.mimeType.toLowerCase(),F=I.mimeType.toLowerCase();if(L!==F||D.clockRate!==I.clockRate||D.channels!==I.channels)return!1;switch(L){case"video/h264":{if(E){const q=D.parameters["packetization-mode"]??0,V=I.parameters["packetization-mode"]??0;if(q!==V||!n.isSameProfile(D.parameters,I.parameters))return!1;let Y;try{Y=n.generateProfileLevelIdStringForAnswer(D.parameters,I.parameters)}catch{return!1}x&&(Y?(D.parameters["profile-level-id"]=Y,I.parameters["profile-level-id"]=Y):(delete D.parameters["profile-level-id"],delete I.parameters["profile-level-id"]))}break}case"video/vp9":{if(E){const q=D.parameters["profile-id"]??0,V=I.parameters["profile-id"]??0;if(q!==V)return!1}break}}return!0}function k(D,I){return!(D.kind&&I.kind&&D.kind!==I.kind||D.uri!==I.uri)}function M(D,I){const E=[];for(const x of D.rtcpFeedback??[]){const L=(I.rtcpFeedback??[]).find(F=>F.type===x.type&&(F.parameter===x.parameter||!F.parameter&&!x.parameter));L&&E.push(L)}return E}return se}var dt={},ts={},pt={},lt={},oi;function vo(){if(oi)return lt;oi=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.Logger=void 0;const n=Pr(),e="awaitqueue";let s=class{_debug;_warn;_error;constructor(_){_?(this._debug=n(`${e}:${_}`),this._warn=n(`${e}:WARN:${_}`),this._error=n(`${e}:ERROR:${_}`)):(this._debug=n(e),this._warn=n(`${e}:WARN`),this._error=n(`${e}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};return lt.Logger=s,lt}var Fe={},ci;function On(){if(ci)return Fe;ci=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.AwaitQueueRemovedTaskError=Fe.AwaitQueueStoppedError=void 0;class n extends Error{constructor(t){super(t??"queue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,n)}}Fe.AwaitQueueStoppedError=n;class e extends Error{constructor(t){super(t??"queue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,e)}}return Fe.AwaitQueueRemovedTaskError=e,Fe}var di;function yo(){if(di)return pt;di=1,Object.defineProperty(pt,"__esModule",{value:!0}),pt.AwaitQueue=void 0;const n=vo(),e=On(),s=new n.Logger("AwaitQueue");let t=class{pendingTasks=new Map;nextTaskId=0;stopping=!1;constructor(){s.debug("constructor()")}get size(){return this.pendingTasks.size}async push(m,w){if(w=w??m.name,s.debug(`push() [name:${w}]`),typeof m!="function")throw new TypeError("given task is not a function");if(w)try{Object.defineProperty(m,"name",{value:w})}catch{}return new Promise((y,C)=>{const R={id:this.nextTaskId++,task:m,name:w,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:v=>{if(R.completed)return;R.completed=!0,this.pendingTasks.delete(R.id),s.debug(`resolving task [name:${R.name}]`),y(v);const[l]=this.pendingTasks.values();l&&!l.executedAt&&this.execute(l)},reject:v=>{if(!R.completed&&(R.completed=!0,this.pendingTasks.delete(R.id),s.debug(`rejecting task [name:${R.name}]: %s`,String(v)),C(v),!this.stopping)){const[l]=this.pendingTasks.values();l&&!l.executedAt&&this.execute(l)}}};this.pendingTasks.set(R.id,R),this.pendingTasks.size===1&&this.execute(R)})}stop(){s.debug("stop()"),this.stopping=!0;for(const m of this.pendingTasks.values())s.debug(`stop() | stopping task [name:${m.name}]`),m.reject(new e.AwaitQueueStoppedError);this.stopping=!1}remove(m){s.debug(`remove() [taskIdx:${m}]`);const w=Array.from(this.pendingTasks.values())[m];if(!w){s.debug(`stop() | no task with given idx [taskIdx:${m}]`);return}w.reject(new e.AwaitQueueRemovedTaskError)}dump(){const m=Date.now();let w=0;return Array.from(this.pendingTasks.values()).map(y=>({idx:w++,task:y.task,name:y.name,enqueuedTime:y.executedAt?y.executedAt-y.enqueuedAt:m-y.enqueuedAt,executionTime:y.executedAt?m-y.executedAt:0}))}async execute(m){if(s.debug(`execute() [name:${m.name}]`),m.executedAt)throw new Error("task already being executed");m.executedAt=Date.now();try{const w=await m.task();m.resolve(w)}catch(w){m.reject(w)}}};return pt.AwaitQueue=t,pt}var pi;function bo(){return pi||(pi=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.AwaitQueueRemovedTaskError=n.AwaitQueueStoppedError=n.AwaitQueue=void 0;var e=yo();Object.defineProperty(n,"AwaitQueue",{enumerable:!0,get:function(){return e.AwaitQueue}});var s=On();Object.defineProperty(n,"AwaitQueueStoppedError",{enumerable:!0,get:function(){return s.AwaitQueueStoppedError}}),Object.defineProperty(n,"AwaitQueueRemovedTaskError",{enumerable:!0,get:function(){return s.AwaitQueueRemovedTaskError}})}(ts)),ts}var ut={},li;function An(){if(li)return ut;li=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.Producer=void 0;const n=Q(),e=xe(),s=te(),t=new n.Logger("Producer");let _=class extends e.EnhancedEventEmitter{_id;_localId;_closed=!1;_rtpSender;_track;_kind;_rtpParameters;_paused;_maxSpatialLayer;_stopTracks;_disableTrackOnPause;_zeroRtpOnPause;_appData;_observer=new e.EnhancedEventEmitter;constructor({id:w,localId:y,rtpSender:C,track:R,rtpParameters:v,stopTracks:l,disableTrackOnPause:b,zeroRtpOnPause:S,appData:p}){super(),t.debug("constructor()"),this._id=w,this._localId=y,this._rtpSender=C,this._track=R,this._kind=R.kind,this._rtpParameters=v,this._paused=b?!R.enabled:!1,this._maxSpatialLayer=void 0,this._stopTracks=l,this._disableTrackOnPause=b,this._zeroRtpOnPause=S,this._appData=p??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(w){this._appData=w}get observer(){return this._observer}close(){this._closed||(t.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(t.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new s.InvalidStateError("closed");return new Promise((w,y)=>{this.safeEmit("@getstats",w,y)})}pause(){if(t.debug("pause()"),this._closed){t.error("pause() | Producer closed");return}this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((w,y)=>{this.safeEmit("@pause",w,y)}).catch(()=>{}),this._observer.safeEmit("pause")}resume(){if(t.debug("resume()"),this._closed){t.error("resume() | Producer closed");return}this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((w,y)=>{this.safeEmit("@resume",w,y)}).catch(()=>{}),this._observer.safeEmit("resume")}async replaceTrack({track:w}){if(t.debug("replaceTrack() [track:%o]",w),this._closed){if(w&&this._stopTracks)try{w.stop()}catch{}throw new s.InvalidStateError("closed")}else if(w&&w.readyState==="ended")throw new s.InvalidStateError("track ended");if(w===this._track){t.debug("replaceTrack() | same track, ignored");return}await new Promise((y,C)=>{this.safeEmit("@replacetrack",w,y,C)}),this.destroyTrack(),this._track=w,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()}async setMaxSpatialLayer(w){if(this._closed)throw new s.InvalidStateError("closed");if(this._kind!=="video")throw new s.UnsupportedError("not a video Producer");if(typeof w!="number")throw new TypeError("invalid spatialLayer");w!==this._maxSpatialLayer&&(await new Promise((y,C)=>{this.safeEmit("@setmaxspatiallayer",w,y,C)}).catch(()=>{}),this._maxSpatialLayer=w)}async setRtpEncodingParameters(w){if(this._closed)throw new s.InvalidStateError("closed");if(typeof w!="object")throw new TypeError("invalid params");await new Promise((y,C)=>{this.safeEmit("@setrtpencodingparameters",w,y,C)})}onTrackEnded(){t.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}};return ut.Producer=_,ut}var ht={},ui;function Nn(){if(ui)return ht;ui=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.Consumer=void 0;const n=Q(),e=xe(),s=te(),t=new n.Logger("Consumer");let _=class extends e.EnhancedEventEmitter{_id;_localId;_producerId;_closed=!1;_rtpReceiver;_track;_rtpParameters;_paused;_appData;_observer=new e.EnhancedEventEmitter;constructor({id:w,localId:y,producerId:C,rtpReceiver:R,track:v,rtpParameters:l,appData:b}){super(),t.debug("constructor()"),this._id=w,this._localId=y,this._producerId=C,this._rtpReceiver=R,this._track=v,this._rtpParameters=l,this._paused=!v.enabled,this._appData=b??{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(w){this._appData=w}get observer(){return this._observer}close(){this._closed||(t.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(t.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new s.InvalidStateError("closed");return new Promise((w,y)=>{this.safeEmit("@getstats",w,y)})}pause(){if(t.debug("pause()"),this._closed){t.error("pause() | Consumer closed");return}if(this._paused){t.debug("pause() | Consumer is already paused");return}this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause")}resume(){if(t.debug("resume()"),this._closed){t.error("resume() | Consumer closed");return}if(!this._paused){t.debug("resume() | Consumer is already resumed");return}this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")}onTrackEnded(){t.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}};return ht.Consumer=_,ht}var ft={},hi;function jn(){if(hi)return ft;hi=1,Object.defineProperty(ft,"__esModule",{value:!0}),ft.DataProducer=void 0;const n=Q(),e=xe(),s=te(),t=new n.Logger("DataProducer");let _=class extends e.EnhancedEventEmitter{_id;_dataChannel;_closed=!1;_sctpStreamParameters;_appData;_observer=new e.EnhancedEventEmitter;constructor({id:w,dataChannel:y,sctpStreamParameters:C,appData:R}){super(),t.debug("constructor()"),this._id=w,this._dataChannel=y,this._sctpStreamParameters=C,this._appData=R??{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(w){this._dataChannel.bufferedAmountLowThreshold=w}get appData(){return this._appData}set appData(w){this._appData=w}get observer(){return this._observer}close(){this._closed||(t.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(t.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(w){if(t.debug("send()"),this._closed)throw new s.InvalidStateError("closed");this._dataChannel.send(w)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(t.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",w=>{if(this._closed)return;let{error:y}=w;y||(y=new Error("unknown DataChannel error")),y.errorDetail==="sctp-failure"?t.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",y.sctpCauseCode,y.message):t.error('DataChannel "error" event: %o',y),this.safeEmit("error",y)}),this._dataChannel.addEventListener("close",()=>{this._closed||(t.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||t.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}};return ft.DataProducer=_,ft}var mt={},fi;function Fn(){if(fi)return mt;fi=1,Object.defineProperty(mt,"__esModule",{value:!0}),mt.DataConsumer=void 0;const n=Q(),e=xe(),s=new n.Logger("DataConsumer");let t=class extends e.EnhancedEventEmitter{_id;_dataProducerId;_dataChannel;_closed=!1;_sctpStreamParameters;_appData;_observer=new e.EnhancedEventEmitter;constructor({id:m,dataProducerId:w,dataChannel:y,sctpStreamParameters:C,appData:R}){super(),s.debug("constructor()"),this._id=m,this._dataProducerId=w,this._dataChannel=y,this._sctpStreamParameters=C,this._appData=R??{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(m){this._dataChannel.binaryType=m}get appData(){return this._appData}set appData(m){this._appData=m}get observer(){return this._observer}close(){this._closed||(s.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(s.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(s.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",m=>{if(this._closed)return;let{error:w}=m;w||(w=new Error("unknown DataChannel error")),w.errorDetail==="sctp-failure"?s.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",w.sctpCauseCode,w.message):s.error('DataChannel "error" event: %o',w),this.safeEmit("error",w)}),this._dataChannel.addEventListener("close",()=>{this._closed||(s.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",m=>{this._closed||this.safeEmit("message",m.data)})}};return mt.DataConsumer=t,mt}var mi;function Bn(){if(mi)return dt;mi=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.Transport=void 0;const n=bo(),e=Q(),s=xe(),t=te(),_=X(),m=re(),w=An(),y=Nn(),C=jn(),R=Fn(),v=new e.Logger("Transport");class l{consumerOptions;promise;resolve;reject;constructor(p){this.consumerOptions=p,this.promise=new Promise((o,r)=>{this.resolve=o,this.reject=r})}}let b=class extends s.EnhancedEventEmitter{_id;_closed=!1;_direction;_extendedRtpCapabilities;_canProduceByKind;_maxSctpMessageSize;_handler;_iceGatheringState="new";_connectionState="new";_appData;_producers=new Map;_consumers=new Map;_dataProducers=new Map;_dataConsumers=new Map;_probatorConsumerCreated=!1;_awaitQueue=new n.AwaitQueue;_pendingConsumerTasks=[];_consumerCreationInProgress=!1;_pendingPauseConsumers=new Map;_consumerPauseInProgress=!1;_pendingResumeConsumers=new Map;_consumerResumeInProgress=!1;_pendingCloseConsumers=new Map;_consumerCloseInProgress=!1;_observer=new s.EnhancedEventEmitter;constructor({direction:p,id:o,iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:a,iceServers:d,iceTransportPolicy:u,additionalSettings:f,proprietaryConstraints:g,appData:T,handlerFactory:h,extendedRtpCapabilities:P,canProduceByKind:k}){super(),v.debug("constructor() [id:%s, direction:%s]",o,p),this._id=o,this._direction=p,this._extendedRtpCapabilities=P,this._canProduceByKind=k,this._maxSctpMessageSize=a?a.maxMessageSize:null;const M=_.clone(f)??{};delete M.iceServers,delete M.iceTransportPolicy,delete M.bundlePolicy,delete M.rtcpMuxPolicy,delete M.sdpSemantics,this._handler=h(),this._handler.run({direction:p,iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:a,iceServers:d,iceTransportPolicy:u,additionalSettings:M,proprietaryConstraints:g,extendedRtpCapabilities:P}),this._appData=T??{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(p){this._appData=p}get observer(){return this._observer}close(){if(!this._closed){v.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const p of this._producers.values())p.transportClosed();this._producers.clear();for(const p of this._consumers.values())p.transportClosed();this._consumers.clear();for(const p of this._dataProducers.values())p.transportClosed();this._dataProducers.clear();for(const p of this._dataConsumers.values())p.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new t.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:p}){if(v.debug("restartIce()"),this._closed)throw new t.InvalidStateError("closed");if(!p)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(p),"transport.restartIce()")}async updateIceServers({iceServers:p}={}){if(v.debug("updateIceServers()"),this._closed)throw new t.InvalidStateError("closed");if(!Array.isArray(p))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(p),"transport.updateIceServers()")}async produce({track:p,encodings:o,codecOptions:r,codec:i,stopTracks:c=!0,disableTrackOnPause:a=!0,zeroRtpOnPause:d=!1,onRtpSender:u,appData:f={}}={}){if(v.debug("produce() [track:%o]",p),this._closed)throw new t.InvalidStateError("closed");if(p){if(this._direction!=="send")throw new t.UnsupportedError("not a sending Transport");if(this._canProduceByKind[p.kind]){if(p.readyState==="ended")throw new t.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(f&&typeof f!="object")throw new TypeError("if given, appData must be an object")}else throw new t.UnsupportedError(`cannot produce ${p.kind}`)}else throw new TypeError("missing track");return this._awaitQueue.push(async()=>{let g;if(o&&!Array.isArray(o))throw TypeError("encodings must be an array");o&&o.length===0?g=void 0:o&&(g=o.map(k=>{const M={active:!0};return k.active===!1&&(M.active=!1),typeof k.dtx=="boolean"&&(M.dtx=k.dtx),typeof k.scalabilityMode=="string"&&(M.scalabilityMode=k.scalabilityMode),typeof k.scaleResolutionDownBy=="number"&&(M.scaleResolutionDownBy=k.scaleResolutionDownBy),typeof k.maxBitrate=="number"&&(M.maxBitrate=k.maxBitrate),typeof k.maxFramerate=="number"&&(M.maxFramerate=k.maxFramerate),typeof k.adaptivePtime=="boolean"&&(M.adaptivePtime=k.adaptivePtime),typeof k.priority=="string"&&(M.priority=k.priority),typeof k.networkPriority=="string"&&(M.networkPriority=k.networkPriority),M}));const{localId:T,rtpParameters:h,rtpSender:P}=await this._handler.send({track:p,encodings:g,codecOptions:r,codec:i,onRtpSender:u});try{m.validateRtpParameters(h);const{id:k}=await new Promise((D,I)=>{this.safeEmit("produce",{kind:p.kind,rtpParameters:h,appData:f},D,I)}),M=new w.Producer({id:k,localId:T,rtpSender:P,track:p,rtpParameters:h,stopTracks:c,disableTrackOnPause:a,zeroRtpOnPause:d,appData:f});return this._producers.set(M.id,M),this.handleProducer(M),this._observer.safeEmit("newproducer",M),M}catch(k){throw this._handler.stopSending(T).catch(()=>{}),k}},"transport.produce()").catch(g=>{if(c)try{p.stop()}catch{}throw g})}async consume({id:p,producerId:o,kind:r,rtpParameters:i,streamId:c,onRtpReceiver:a,appData:d={}}){if(v.debug("consume()"),this._closed)throw new t.InvalidStateError("closed");if(this._direction!=="recv")throw new t.UnsupportedError("not a receiving Transport");if(typeof p!="string")throw new TypeError("missing id");if(typeof o!="string")throw new TypeError("missing producerId");if(r!=="audio"&&r!=="video")throw new TypeError(`invalid kind '${r}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(d&&typeof d!="object")throw new TypeError("if given, appData must be an object");const u=_.clone(i);if(!m.canReceive(u,this._extendedRtpCapabilities))throw new t.UnsupportedError("cannot consume this Producer");const g=new l({id:p,producerId:o,kind:r,rtpParameters:u,streamId:c,onRtpReceiver:a,appData:d});return this._pendingConsumerTasks.push(g),queueMicrotask(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),g.promise}async produceData({ordered:p=!0,maxPacketLifeTime:o,maxRetransmits:r,label:i="",protocol:c="",appData:a={}}={}){if(v.debug("produceData()"),this._closed)throw new t.InvalidStateError("closed");if(this._direction!=="send")throw new t.UnsupportedError("not a sending Transport");if(this._maxSctpMessageSize){if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(a&&typeof a!="object")throw new TypeError("if given, appData must be an object")}else throw new t.UnsupportedError("SCTP not enabled by remote Transport");return(o||r)&&(p=!1),this._awaitQueue.push(async()=>{const{dataChannel:d,sctpStreamParameters:u}=await this._handler.sendDataChannel({ordered:p,maxPacketLifeTime:o,maxRetransmits:r,label:i,protocol:c});m.validateSctpStreamParameters(u);const{id:f}=await new Promise((T,h)=>{this.safeEmit("producedata",{sctpStreamParameters:u,label:i,protocol:c,appData:a},T,h)}),g=new C.DataProducer({id:f,dataChannel:d,sctpStreamParameters:u,appData:a});return this._dataProducers.set(g.id,g),this.handleDataProducer(g),this._observer.safeEmit("newdataproducer",g),g},"transport.produceData()")}async consumeData({id:p,dataProducerId:o,sctpStreamParameters:r,label:i="",protocol:c="",appData:a={}}){if(v.debug("consumeData()"),this._closed)throw new t.InvalidStateError("closed");if(this._direction!=="recv")throw new t.UnsupportedError("not a receiving Transport");if(this._maxSctpMessageSize){if(typeof p!="string")throw new TypeError("missing id");if(typeof o!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(a&&typeof a!="object")throw new TypeError("if given, appData must be an object")}else throw new t.UnsupportedError("SCTP not enabled by remote Transport");const d=_.clone(r);return m.validateSctpStreamParameters(d),this._awaitQueue.push(async()=>{const{dataChannel:u}=await this._handler.receiveDataChannel({sctpStreamParameters:d,label:i,protocol:c}),f=new R.DataConsumer({id:p,dataProducerId:o,dataChannel:u,sctpStreamParameters:d,appData:a});return this._dataConsumers.set(f.id,f),this.handleDataConsumer(f),this._observer.safeEmit("newdataconsumer",f),f},"transport.consumeData()")}createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0){v.debug("createPendingConsumers() | there is no Consumer to be created");return}const p=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let o;const r=[];for(const i of p){const{id:c,kind:a,rtpParameters:d,streamId:u,onRtpReceiver:f}=i.consumerOptions;r.push({trackId:c,kind:a,rtpParameters:d,streamId:u,onRtpReceiver:f})}try{const i=await this._handler.receive(r);for(let c=0;c<i.length;++c){const a=p[c],d=i[c],{id:u,producerId:f,kind:g,rtpParameters:T,appData:h}=a.consumerOptions,{localId:P,rtpReceiver:k,track:M}=d,D=new y.Consumer({id:u,localId:P,producerId:f,rtpReceiver:k,track:M,rtpParameters:T,appData:h});this._consumers.set(D.id,D),this.handleConsumer(D),!this._probatorConsumerCreated&&!o&&g==="video"&&(o=D),this._observer.safeEmit("newconsumer",D),a.resolve(D)}}catch(i){for(const c of p)c.reject(i)}if(o)try{const i=m.generateProbatorRtpParameters(o.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:i}]),v.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(i){v.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",i)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0){v.debug("pausePendingConsumers() | there is no Consumer to be paused");return}const p=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const o=p.map(r=>r.localId);await this._handler.pauseReceiving(o)}catch(o){v.error("pausePendingConsumers() | failed to pause Consumers:",o)}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0){v.debug("resumePendingConsumers() | there is no Consumer to be resumed");return}const p=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const o=p.map(r=>r.localId);await this._handler.resumeReceiving(o)}catch(o){v.error("resumePendingConsumers() | failed to resume Consumers:",o)}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0){v.debug("closePendingConsumers() | there is no Consumer to be closed");return}const p=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(p.map(o=>o.localId))}catch(o){v.error("closePendingConsumers() | failed to close Consumers:",o)}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const p=this._handler;p.on("@connect",({dtlsParameters:o},r,i)=>{if(this._closed){i(new t.InvalidStateError("closed"));return}this.safeEmit("connect",{dtlsParameters:o},r,i)}),p.on("@icegatheringstatechange",o=>{o!==this._iceGatheringState&&(v.debug("ICE gathering state changed to %s",o),this._iceGatheringState=o,this._closed||this.safeEmit("icegatheringstatechange",o))}),p.on("@icecandidateerror",o=>{v.warn(`ICE candidate error [url:${o.url}, localAddress:${o.address}, localPort:${o.port}]: ${o.errorCode} "${o.errorText}"`),this.safeEmit("icecandidateerror",o)}),p.on("@connectionstatechange",o=>{o!==this._connectionState&&(v.debug("connection state changed to %s",o),this._connectionState=o,this._closed||this.safeEmit("connectionstatechange",o))})}handleProducer(p){p.on("@close",()=>{this._producers.delete(p.id),!this._closed&&this._awaitQueue.push(async()=>await this._handler.stopSending(p.localId),"producer @close event").catch(o=>v.warn("producer.close() failed:%o",o))}),p.on("@pause",(o,r)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(p.localId),"producer @pause event").then(o).catch(r)}),p.on("@resume",(o,r)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(p.localId),"producer @resume event").then(o).catch(r)}),p.on("@replacetrack",(o,r,i)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(p.localId,o),"producer @replacetrack event").then(r).catch(i)}),p.on("@setmaxspatiallayer",(o,r,i)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(p.localId,o),"producer @setmaxspatiallayer event").then(r).catch(i)}),p.on("@setrtpencodingparameters",(o,r,i)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(p.localId,o),"producer @setrtpencodingparameters event").then(r).catch(i)}),p.on("@getstats",(o,r)=>{if(this._closed)return r(new t.InvalidStateError("closed"));this._handler.getSenderStats(p.localId).then(o).catch(r)})}handleConsumer(p){p.on("@close",()=>{this._consumers.delete(p.id),this._pendingPauseConsumers.delete(p.id),this._pendingResumeConsumers.delete(p.id),!this._closed&&(this._pendingCloseConsumers.set(p.id,p),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),p.on("@pause",()=>{this._pendingResumeConsumers.has(p.id)&&this._pendingResumeConsumers.delete(p.id),this._pendingPauseConsumers.set(p.id,p),queueMicrotask(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),p.on("@resume",()=>{this._pendingPauseConsumers.has(p.id)&&this._pendingPauseConsumers.delete(p.id),this._pendingResumeConsumers.set(p.id,p),queueMicrotask(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),p.on("@getstats",(o,r)=>{if(this._closed)return r(new t.InvalidStateError("closed"));this._handler.getReceiverStats(p.localId).then(o).catch(r)})}handleDataProducer(p){p.on("@close",()=>{this._dataProducers.delete(p.id)})}handleDataConsumer(p){p.on("@close",()=>{this._dataConsumers.delete(p.id)})}};return dt.Transport=b,dt}var gt={},he={},rs={},ss={exports:{}},gi;function Ss(){if(gi)return ss.exports;gi=1;var n=ss.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return e.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return e.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return e.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var s="candidate:%s %d %s %d %s %d typ %s";return s+=e.raddr!=null?" raddr %s rport %d":"%v%v",s+=e.tcptype!=null?" tcptype %s":"%v",e.generation!=null&&(s+=" generation %d"),s+=e["network-id"]!=null?" network-id %d":"%v",s+=e["network-cost"]!=null?" network-cost %d":"%v",s}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var s="ssrc:%d";return e.attribute!=null&&(s+=" %s",e.value!=null&&(s+=":%s")),s}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return e.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(e.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var s="mediaclk:";return s+=e.id!=null?"id=%s %s":"%v%s",s+=e.mediaClockValue!=null?"=%s":"",s+=e.rateNumerator!=null?" rate=%s":"",s+=e.rateDenominator!=null?"/%s":"",s}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};return Object.keys(n).forEach(function(e){var s=n[e];s.forEach(function(t){t.reg||(t.reg=/(.*)/),t.format||(t.format="%s")})}),ss.exports}var _i;function So(){return _i||(_i=1,function(n){var e=function(y){return String(Number(y))===y?Number(y):y},s=function(y,C,R,v){if(v&&!R)C[v]=e(y[1]);else for(var l=0;l<R.length;l+=1)y[l+1]!=null&&(C[R[l]]=e(y[l+1]))},t=function(y,C,R){var v=y.name&&y.names;y.push&&!C[y.push]?C[y.push]=[]:v&&!C[y.name]&&(C[y.name]={});var l=y.push?{}:v?C[y.name]:C;s(R.match(y.reg),l,y.names,y.name),y.push&&C[y.push].push(l)},_=Ss(),m=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(y){var C={},R=[],v=C;return y.split(/(\r\n|\r|\n)/).filter(m).forEach(function(l){var b=l[0],S=l.slice(2);b==="m"&&(R.push({rtp:[],fmtp:[]}),v=R[R.length-1]);for(var p=0;p<(_[b]||[]).length;p+=1){var o=_[b][p];if(o.reg.test(S))return t(o,v,S)}}),C.media=R,C};var w=function(y,C){var R=C.split(/=(.+)/,2);return R.length===2?y[R[0]]=e(R[1]):R.length===1&&C.length>1&&(y[R[0]]=void 0),y};n.parseParams=function(y){return y.split(/;\s?/).reduce(w,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(y){return y.toString().split(" ").map(Number)},n.parseRemoteCandidates=function(y){for(var C=[],R=y.split(" ").map(e),v=0;v<R.length;v+=3)C.push({component:R[v],ip:R[v+1],port:R[v+2]});return C},n.parseImageAttributes=function(y){return y.split(" ").map(function(C){return C.substring(1,C.length-1).split(",").reduce(w,{})})},n.parseSimulcastStreamList=function(y){return y.split(";").map(function(C){return C.split(",").map(function(R){var v,l=!1;return R[0]!=="~"?v=e(R):(v=e(R.substring(1,R.length)),l=!0),{scid:v,paused:l}})})}}(rs)),rs}var is,wi;function Ro(){if(wi)return is;wi=1;var n=Ss(),e=/%[sdv%]/g,s=function(w){var y=1,C=arguments,R=C.length;return w.replace(e,function(v){if(y>=R)return v;var l=C[y];switch(y+=1,v){case"%%":return"%";case"%s":return String(l);case"%d":return Number(l);case"%v":return""}})},t=function(w,y,C){var R=y.format instanceof Function?y.format(y.push?C:C[y.name]):y.format,v=[w+"="+R];if(y.names)for(var l=0;l<y.names.length;l+=1){var b=y.names[l];y.name?v.push(C[y.name][b]):v.push(C[y.names[l]])}else v.push(C[y.name]);return s.apply(null,v)},_=["v","o","s","i","u","e","p","c","b","t","r","z","a"],m=["i","c","b","a"];return is=function(w,y){y=y||{},w.version==null&&(w.version=0),w.name==null&&(w.name=" "),w.media.forEach(function(l){l.payloads==null&&(l.payloads="")});var C=y.outerOrder||_,R=y.innerOrder||m,v=[];return C.forEach(function(l){n[l].forEach(function(b){b.name in w&&w[b.name]!=null?v.push(t(l,b,w)):b.push in w&&w[b.push]!=null&&w[b.push].forEach(function(S){v.push(t(l,b,S))})})}),w.media.forEach(function(l){v.push(t("m",n.m[0],l)),R.forEach(function(b){n[b].forEach(function(S){S.name in l&&l[S.name]!=null?v.push(t(b,S,l)):S.push in l&&l[S.push]!=null&&l[S.push].forEach(function(p){v.push(t(b,S,p))})})})}),v.join(`\r
`)+`\r
`},is}var vi;function ae(){if(vi)return he;vi=1;var n=So(),e=Ro(),s=Ss();return he.grammar=s,he.write=e,he.parse=n.parse,he.parseParams=n.parseParams,he.parseFmtpConfig=n.parseFmtpConfig,he.parsePayloads=n.parsePayloads,he.parseRemoteCandidates=n.parseRemoteCandidates,he.parseImageAttributes=n.parseImageAttributes,he.parseSimulcastStreamList=n.parseSimulcastStreamList,he}var Be={},yi;function me(){if(yi)return Be;yi=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.extractRtpCapabilities=e,Be.extractDtlsParameters=s,Be.getCname=t,Be.applyCodecParameters=_;const n=ae();function e({sdpObject:m}){const w=new Map,y=[];let C=!1,R=!1;for(const l of m.media){const b=l.type;switch(b){case"audio":{if(C)continue;C=!0;break}case"video":{if(R)continue;R=!0;break}default:continue}for(const S of l.rtp){const p={kind:b,mimeType:`${b}/${S.codec}`,preferredPayloadType:S.payload,clockRate:S.rate,channels:S.encoding,parameters:{},rtcpFeedback:[]};w.set(p.preferredPayloadType,p)}for(const S of l.fmtp??[]){const p=n.parseParams(S.config),o=w.get(S.payload);o&&(p?.hasOwnProperty("profile-level-id")&&(p["profile-level-id"]=String(p["profile-level-id"])),o.parameters=p)}for(const S of l.rtcpFb??[]){const p={type:S.type,parameter:S.subtype};if(p.parameter||delete p.parameter,S.payload!=="*"){const o=w.get(S.payload);if(!o)continue;o.rtcpFeedback.push(p)}else for(const o of w.values())o.kind===b&&!/.+\/rtx$/i.test(o.mimeType)&&o.rtcpFeedback.push(p)}for(const S of l.ext??[]){if(S["encrypt-uri"])continue;const p={kind:b,uri:S.uri,preferredId:S.value};y.push(p)}}return{codecs:Array.from(w.values()),headerExtensions:y}}function s({sdpObject:m}){let w=m.setup,y=m.fingerprint;if(!w||!y){const v=(m.media??[]).find(l=>l.port!==0);v&&(w??=v.setup,y??=v.fingerprint)}if(w){if(!y)throw new Error("no a=fingerprint found at SDP session or media level")}else throw new Error("no a=setup found at SDP session or media level");let C;switch(w){case"active":{C="client";break}case"passive":{C="server";break}case"actpass":{C="auto";break}}return{role:C,fingerprints:[{algorithm:y.type,value:y.hash}]}}function t({offerMediaObject:m}){const w=(m.ssrcs??[]).find(y=>y.attribute==="cname");return w?w.value:""}function _({offerRtpParameters:m,answerMediaObject:w}){for(const y of m.codecs){const C=y.mimeType.toLowerCase();if(C!=="audio/opus"||!(w.rtp??[]).find(b=>b.payload===y.payloadType))continue;w.fmtp=w.fmtp??[];let v=w.fmtp.find(b=>b.payload===y.payloadType);v||(v={payload:y.payloadType,config:""},w.fmtp.push(v));const l=n.parseParams(v.config);switch(C){case"audio/opus":{const b=y.parameters["sprop-stereo"];b!==void 0&&(l.stereo=Number(b)?1:0);break}}v.config="";for(const b of Object.keys(l))v.config&&(v.config+=";"),v.config+=`${b}=${l[b]}`}}return Be}var _t={},bi;function qe(){if(bi)return _t;bi=1,Object.defineProperty(_t,"__esModule",{value:!0}),_t.getRtpEncodings=n,_t.addLegacySimulcast=e;function n({offerMediaObject:s}){const t=new Set;for(const w of s.ssrcs??[]){const y=w.id;t.add(y)}if(t.size===0)throw new Error("no a=ssrc lines found");const _=new Map;for(const w of s.ssrcGroups??[]){if(w.semantics!=="FID")continue;let[y,C]=w.ssrcs.split(/\s+/);y=Number(y),C=Number(C),t.has(y)&&(t.delete(y),t.delete(C),_.set(y,C))}for(const w of t)_.set(w,null);const m=[];for(const[w,y]of _){const C={ssrc:w};y&&(C.rtx={ssrc:y}),m.push(C)}return m}function e({offerMediaObject:s,numStreams:t}){if(t<=1)throw new TypeError("numStreams must be greater than 1");const _=(s.ssrcs??[]).find(S=>S.attribute==="msid");if(!_)throw new Error("a=ssrc line with msid information not found");const[m,w]=_.value.split(" "),y=Number(_.id);let C;(s.ssrcGroups??[]).some(S=>{if(S.semantics!=="FID")return!1;const p=S.ssrcs.split(/\s+/);return Number(p[0])===y?(C=Number(p[1]),!0):!1});const R=s.ssrcs.find(S=>S.attribute==="cname");if(!R)throw new Error("a=ssrc line with cname information not found");const v=R.value,l=[],b=[];for(let S=0;S<t;++S)l.push(y+S),C&&b.push(C+S);s.ssrcGroups=[],s.ssrcs=[],s.ssrcGroups.push({semantics:"SIM",ssrcs:l.join(" ")});for(const S of l)s.ssrcs.push({id:S,attribute:"cname",value:v}),s.ssrcs.push({id:S,attribute:"msid",value:`${m} ${w}`});for(let S=0;S<b.length;++S){const p=l[S],o=b[S];s.ssrcs.push({id:o,attribute:"cname",value:v}),s.ssrcs.push({id:o,attribute:"msid",value:`${m} ${w}`}),s.ssrcGroups.push({semantics:"FID",ssrcs:`${p} ${o}`})}}return _t}var tr={},Si;function kr(){if(Si)return tr;Si=1,Object.defineProperty(tr,"__esModule",{value:!0}),tr.addNackSupportForOpus=n;function n(e){for(const s of e.codecs??[])(s.mimeType.toLowerCase()==="audio/opus"||s.mimeType.toLowerCase()==="audio/multiopus")&&!s.rtcpFeedback?.some(t=>t.type==="nack"&&!t.parameter)&&(s.rtcpFeedback||(s.rtcpFeedback=[]),s.rtcpFeedback.push({type:"nack"}))}return tr}var wt={},Ri;function oe(){if(Ri)return wt;Ri=1,Object.defineProperty(wt,"__esModule",{value:!0}),wt.HandlerInterface=void 0;const n=xe();let e=class extends n.EnhancedEventEmitter{constructor(){super()}};return wt.HandlerInterface=e,wt}var vt={},Te={},Ci;function Co(){if(Ci)return Te;Ci=1,Object.defineProperty(Te,"__esModule",{value:!0}),Te.OfferMediaSection=Te.AnswerMediaSection=Te.MediaSection=void 0;const n=ae(),e=X();let s=class{_mediaObject;_planB;constructor({iceParameters:y,iceCandidates:C,dtlsParameters:R,planB:v=!1}){if(this._mediaObject={},this._planB=v,y&&this.setIceParameters(y),C){this._mediaObject.candidates=[];for(const l of C){const b={};b.component=1,b.foundation=l.foundation,b.ip=l.address??l.ip,b.port=l.port,b.priority=l.priority,b.transport=l.protocol,b.type=l.type,l.tcpType&&(b.tcptype=l.tcpType),this._mediaObject.candidates.push(b)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}R&&this.setDtlsRole(R.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(y){this._mediaObject.iceUfrag=y.usernameFragment,this._mediaObject.icePwd=y.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}};Te.MediaSection=s;class t extends s{constructor({iceParameters:y,iceCandidates:C,dtlsParameters:R,sctpParameters:v,plainRtpParameters:l,planB:b=!1,offerMediaObject:S,offerRtpParameters:p,answerRtpParameters:o,codecOptions:r}){switch(super({iceParameters:y,iceCandidates:C,dtlsParameters:R,planB:b}),this._mediaObject.mid=String(S.mid),this._mediaObject.type=S.type,this._mediaObject.protocol=S.protocol,l?(this._mediaObject.connection={ip:l.ip,version:l.ipVersion},this._mediaObject.port=l.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),S.type){case"audio":case"video":{this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const i of o.codecs){const c={payload:i.payloadType,codec:m(i),rate:i.clockRate};i.channels>1&&(c.encoding=i.channels),this._mediaObject.rtp.push(c);const a=e.clone(i.parameters)??{};let d=e.clone(i.rtcpFeedback)??[];if(r){const{opusStereo:f,opusFec:g,opusDtx:T,opusMaxPlaybackRate:h,opusMaxAverageBitrate:P,opusPtime:k,opusNack:M,videoGoogleStartBitrate:D,videoGoogleMaxBitrate:I,videoGoogleMinBitrate:E}=r,x=p.codecs.find(L=>L.payloadType===i.payloadType);switch(i.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":{f!==void 0&&(x.parameters["sprop-stereo"]=f?1:0,a.stereo=f?1:0),g!==void 0&&(x.parameters.useinbandfec=g?1:0,a.useinbandfec=g?1:0),T!==void 0&&(x.parameters.usedtx=T?1:0,a.usedtx=T?1:0),h!==void 0&&(a.maxplaybackrate=h),P!==void 0&&(a.maxaveragebitrate=P),k!==void 0&&(x.parameters.ptime=k,a.ptime=k),M||(x.rtcpFeedback=x.rtcpFeedback.filter(L=>L.type!=="nack"||L.parameter),d=d.filter(L=>L.type!=="nack"||L.parameter));break}case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":case"video/av1":{D!==void 0&&(a["x-google-start-bitrate"]=D),I!==void 0&&(a["x-google-max-bitrate"]=I),E!==void 0&&(a["x-google-min-bitrate"]=E);break}}}const u={payload:i.payloadType,config:""};for(const f of Object.keys(a))u.config&&(u.config+=";"),u.config+=`${f}=${a[f]}`;u.config&&this._mediaObject.fmtp.push(u);for(const f of d)this._mediaObject.rtcpFb.push({payload:i.payloadType,type:f.type,subtype:f.parameter})}this._mediaObject.payloads=o.codecs.map(i=>i.payloadType).join(" "),this._mediaObject.ext=[];for(const i of o.headerExtensions)(S.ext??[]).some(a=>a.uri===i.uri)&&this._mediaObject.ext.push({uri:i.uri,value:i.id});if(S.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),S.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:S.simulcast.list1},this._mediaObject.rids=[];for(const i of S.rids??[])i.direction==="send"&&this._mediaObject.rids.push({id:i.id,direction:"recv"})}else if(S.simulcast_03){this._mediaObject.simulcast_03={value:S.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const i of S.rids??[])i.direction==="send"&&this._mediaObject.rids.push({id:i.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&this._mediaObject.type==="video"&&(this._mediaObject.xGoogleFlag="conference");break}case"application":{typeof S.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=v.port,this._mediaObject.maxMessageSize=v.maxMessageSize):S.sctpmap&&(this._mediaObject.payloads=v.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:v.port,maxMessageSize:v.maxMessageSize});break}}}setDtlsRole(y){switch(y){case"client":{this._mediaObject.setup="active";break}case"server":{this._mediaObject.setup="passive";break}case"auto":{this._mediaObject.setup="actpass";break}}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(y){if(!this._mediaObject.simulcast?.list1)return;const C={};for(const l of y)l.rid&&(C[l.rid]=l);const R=this._mediaObject.simulcast.list1,v=n.parseSimulcastStreamList(R);for(const l of v)for(const b of l)b.paused=!C[b.scid]?.active;this._mediaObject.simulcast.list1=v.map(l=>l.map(b=>`${b.paused?"~":""}${b.scid}`).join(",")).join(";")}}Te.AnswerMediaSection=t;class _ extends s{constructor({iceParameters:y,iceCandidates:C,dtlsParameters:R,sctpParameters:v,plainRtpParameters:l,planB:b=!1,mid:S,kind:p,offerRtpParameters:o,streamId:r,trackId:i,oldDataChannelSpec:c=!1}){switch(super({iceParameters:y,iceCandidates:C,dtlsParameters:R,planB:b}),this._mediaObject.mid=String(S),this._mediaObject.type=p,l?(this._mediaObject.connection={ip:l.ip,version:l.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=l.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},v?this._mediaObject.protocol="UDP/DTLS/SCTP":this._mediaObject.protocol="UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),this._mediaObject.extmapAllowMixed="extmap-allow-mixed",p){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${r??"-"} ${i}`);for(const f of o.codecs){const g={payload:f.payloadType,codec:m(f),rate:f.clockRate};f.channels>1&&(g.encoding=f.channels),this._mediaObject.rtp.push(g);const T={payload:f.payloadType,config:""};for(const h of Object.keys(f.parameters))T.config&&(T.config+=";"),T.config+=`${h}=${f.parameters[h]}`;T.config&&this._mediaObject.fmtp.push(T);for(const h of f.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:f.payloadType,type:h.type,subtype:h.parameter})}this._mediaObject.payloads=o.codecs.map(f=>f.payloadType).join(" "),this._mediaObject.ext=[];for(const f of o.headerExtensions)this._mediaObject.ext.push({uri:f.uri,value:f.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const a=o.encodings[0],d=a.ssrc,u=a.rtx?.ssrc;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],o.rtcp.cname&&this._mediaObject.ssrcs.push({id:d,attribute:"cname",value:o.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:d,attribute:"msid",value:`${r??"-"} ${i}`}),u&&(o.rtcp.cname&&this._mediaObject.ssrcs.push({id:u,attribute:"cname",value:o.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:u,attribute:"msid",value:`${r??"-"} ${i}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${d} ${u}`}));break}case"application":{c?(this._mediaObject.payloads=v.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:v.port,maxMessageSize:v.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=v.port,this._mediaObject.maxMessageSize=v.maxMessageSize);break}}}setDtlsRole(y){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:y,streamId:C,trackId:R}){const v=y.encodings[0],l=v.ssrc,b=v.rtx?.ssrc,S=this._mediaObject.payloads.split(" ");for(const p of y.codecs){if(S.includes(String(p.payloadType)))continue;const o={payload:p.payloadType,codec:m(p),rate:p.clockRate};p.channels>1&&(o.encoding=p.channels),this._mediaObject.rtp.push(o);const r={payload:p.payloadType,config:""};for(const i of Object.keys(p.parameters))r.config&&(r.config+=";"),r.config+=`${i}=${p.parameters[i]}`;r.config&&this._mediaObject.fmtp.push(r);for(const i of p.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:p.payloadType,type:i.type,subtype:i.parameter})}this._mediaObject.payloads+=` ${y.codecs.filter(p=>!this._mediaObject.payloads.includes(p.payloadType)).map(p=>p.payloadType).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),y.rtcp.cname&&this._mediaObject.ssrcs.push({id:l,attribute:"cname",value:y.rtcp.cname}),this._mediaObject.ssrcs.push({id:l,attribute:"msid",value:`${C??"-"} ${R}`}),b&&(y.rtcp.cname&&this._mediaObject.ssrcs.push({id:b,attribute:"cname",value:y.rtcp.cname}),this._mediaObject.ssrcs.push({id:b,attribute:"msid",value:`${C??"-"} ${R}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${l} ${b}`}))}planBStopReceiving({offerRtpParameters:y}){const C=y.encodings[0],R=C.ssrc,v=C.rtx?.ssrc;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(l=>l.id!==R&&l.id!==v),v&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(l=>l.ssrcs!==`${R} ${v}`))}}Te.OfferMediaSection=_;function m(w){const C=new RegExp("^(audio|video)/(.+)","i").exec(w.mimeType);if(!C)throw new TypeError("invalid codec.mimeType");return C[2]}return Te}var Ti;function ge(){if(Ti)return vt;Ti=1,Object.defineProperty(vt,"__esModule",{value:!0}),vt.RemoteSdp=void 0;const n=ae(),e=Q(),s=Co(),t=["av1","h264"],_=new e.Logger("RemoteSdp");let m=class{_iceParameters;_iceCandidates;_dtlsParameters;_sctpParameters;_plainRtpParameters;_planB;_mediaSections=[];_midToIndex=new Map;_firstMid;_sdpObject;constructor({iceParameters:y,iceCandidates:C,dtlsParameters:R,sctpParameters:v,plainRtpParameters:l,planB:b=!1}){if(this._iceParameters=y,this._iceCandidates=C,this._dtlsParameters=R,this._sctpParameters=v,this._plainRtpParameters=l,this._planB=b,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},y?.iceLite&&(this._sdpObject.icelite="ice-lite"),R){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const S=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:R.fingerprints[S-1].algorithm,hash:R.fingerprints[S-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}l&&(this._sdpObject.origin.address=l.ip,this._sdpObject.origin.ipVer=l.ipVersion)}updateIceParameters(y){_.debug("updateIceParameters() [iceParameters:%o]",y),this._iceParameters=y,this._sdpObject.icelite=y.iceLite?"ice-lite":void 0;for(const C of this._mediaSections)C.setIceParameters(y)}updateDtlsRole(y){_.debug("updateDtlsRole() [role:%s]",y),this._dtlsParameters.role=y;for(const C of this._mediaSections)C.setDtlsRole(y)}setSessionExtmapAllowMixed(){_.debug("setSessionExtmapAllowMixed()"),this._sdpObject.extmapAllowMixed="extmap-allow-mixed"}getNextMediaSectionIdx(){for(let y=0;y<this._mediaSections.length;++y){const C=this._mediaSections[y];if(C.closed)return{idx:y,reuseMid:C.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:y,reuseMid:C,offerRtpParameters:R,answerRtpParameters:v,codecOptions:l}){const b=new s.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:y,offerRtpParameters:R,answerRtpParameters:v,codecOptions:l}),S=b.getObject();S.rtp.find(o=>t.includes(o.codec.toLowerCase()))||(S.ext=S.ext.filter(o=>o.uri!=="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension")),C?this._replaceMediaSection(b,C):this._midToIndex.has(b.mid)?this._replaceMediaSection(b):this._addMediaSection(b)}receive({mid:y,kind:C,offerRtpParameters:R,streamId:v,trackId:l}){const b=this._midToIndex.get(y);let S;if(b!==void 0&&(S=this._mediaSections[b]),this.setSessionExtmapAllowMixed(),S)S.planBReceive({offerRtpParameters:R,streamId:v,trackId:l}),this._replaceMediaSection(S);else{S=new s.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:y,kind:C,offerRtpParameters:R,streamId:v,trackId:l});const p=this._mediaSections.find(o=>o.closed);p?this._replaceMediaSection(S,p.mid):this._addMediaSection(S)}}pauseMediaSection(y){this._findMediaSection(y).pause()}resumeSendingMediaSection(y){this._findMediaSection(y).resume()}resumeReceivingMediaSection(y){this._findMediaSection(y).resume()}disableMediaSection(y){this._findMediaSection(y).disable()}closeMediaSection(y){const C=this._findMediaSection(y);return y===this._firstMid?(_.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",y),this.disableMediaSection(y),!1):(C.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(y,C){const R=this._findMediaSection(y);R.muxSimulcastStreams(C),this._replaceMediaSection(R)}planBStopReceiving({mid:y,offerRtpParameters:C}){const R=this._findMediaSection(y);R.planBStopReceiving({offerRtpParameters:C}),this._replaceMediaSection(R)}sendSctpAssociation({offerMediaObject:y}){const C=new s.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:y});this._addMediaSection(C)}receiveSctpAssociation({oldDataChannelSpec:y=!1}={}){const C=new s.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:y});this._addMediaSection(C)}getSdp(){return this._sdpObject.origin.sessionVersion++,n.write(this._sdpObject)}_addMediaSection(y){this._firstMid||(this._firstMid=y.mid),this._mediaSections.push(y),this._midToIndex.set(y.mid,this._mediaSections.length-1),this._sdpObject.media.push(y.getObject()),this._regenerateBundleMids()}_replaceMediaSection(y,C){if(typeof C=="string"){const R=this._midToIndex.get(C);if(R===void 0)throw new Error(`no media section found for reuseMid '${C}'`);const v=this._mediaSections[R];this._mediaSections[R]=y,this._midToIndex.delete(v.mid),this._midToIndex.set(y.mid,R),this._sdpObject.media[R]=y.getObject(),this._regenerateBundleMids()}else{const R=this._midToIndex.get(y.mid);if(R===void 0)throw new Error(`no media section found with mid '${y.mid}'`);this._mediaSections[R]=y,this._sdpObject.media[R]=y.getObject()}}_findMediaSection(y){const C=this._midToIndex.get(y);if(C===void 0)throw new Error(`no media section found with mid '${y}'`);return this._mediaSections[C]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(y=>!y.closed).map(y=>y.mid).join(" "))}};return vt.RemoteSdp=m,vt}var rr={},Di;function Le(){if(Di)return rr;Di=1,Object.defineProperty(rr,"__esModule",{value:!0}),rr.parse=e;const n=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function e(s){const t=n.exec(s??"");return t?{spatialLayers:Number(t[1]),temporalLayers:Number(t[2])}:{spatialLayers:1,temporalLayers:1}}return rr}var Pi;function To(){if(Pi)return gt;Pi=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.Chrome111=void 0;const n=ae(),e=Q(),s=X(),t=re(),_=me(),m=qe(),w=kr(),y=te(),C=oe(),R=ge(),v=Le(),l=new e.Logger("Chrome111"),b="Chrome111",S={OS:1024,MIS:1024};let p=class qn extends C.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new qn}constructor(){super()}get name(){return b}close(){if(l.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{r.addTransceiver("audio"),r.addTransceiver("video",{sendEncodings:[{scalabilityMode:"L3T3"}]});const i=await r.createOffer();try{r.close()}catch{}const c=n.parse(i.sdp),a=_.extractRtpCapabilities({sdpObject:c});return w.addNackSupportForOpus(a),a}catch(i){try{r.close()}catch{}throw i}}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:S}}run({direction:r,iceParameters:i,iceCandidates:c,dtlsParameters:a,sctpParameters:d,iceServers:u,iceTransportPolicy:f,additionalSettings:g,proprietaryConstraints:T,extendedRtpCapabilities:h}){this.assertNotClosed(),l.debug("run()"),this._direction=r,this._remoteSdp=new R.RemoteSdp({iceParameters:i,iceCandidates:c,dtlsParameters:a,sctpParameters:d}),this._sendingRtpParametersByKind={audio:t.getSendingRtpParameters("audio",h),video:t.getSendingRtpParameters("video",h)},this._sendingRemoteRtpParametersByKind={audio:t.getSendingRemoteRtpParameters("audio",h),video:t.getSendingRemoteRtpParameters("video",h)},a.role&&a.role!=="auto"&&(this._forcedLocalDtlsRole=a.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:u??[],iceTransportPolicy:f??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...g},T),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",P=>{this.emit("@icecandidateerror",P)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(l.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}))}async updateIceServers(r){this.assertNotClosed(),l.debug("updateIceServers()");const i=this._pc.getConfiguration();i.iceServers=r,this._pc.setConfiguration(i)}async restartIce(r){if(this.assertNotClosed(),l.debug("restartIce()"),this._remoteSdp.updateIceParameters(r),!!this._transportReady)if(this._direction==="send"){const i=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}else{const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:r,encodings:i,codecOptions:c,codec:a,onRtpSender:d}){if(this.assertNotClosed(),this.assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),i&&i.length>1){let I=1;for(const E of i){const x=E.scalabilityMode?(0,v.parse)(E.scalabilityMode).temporalLayers:3;x>I&&(I=x)}i.forEach((E,x)=>{E.rid=`r${x}`,E.scalabilityMode=`L1T${I}`})}const u=s.clone(this._sendingRtpParametersByKind[r.kind]);u.codecs=t.reduceCodecs(u.codecs,a);const f=s.clone(this._sendingRemoteRtpParametersByKind[r.kind]);f.codecs=t.reduceCodecs(f.codecs,a);const g=this._remoteSdp.getNextMediaSectionIdx(),T=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream],sendEncodings:i});d&&d(T.sender);const h=await this._pc.createOffer();let P=n.parse(h.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",h),await this._pc.setLocalDescription(h);const k=T.mid;u.mid=k,P=n.parse(this._pc.localDescription.sdp);const M=P.media[g.idx];if(u.rtcp.cname=_.getCname({offerMediaObject:M}),!i)u.encodings=m.getRtpEncodings({offerMediaObject:M});else if(i.length===1){const I=m.getRtpEncodings({offerMediaObject:M});Object.assign(I[0],i[0]),u.encodings=I}else u.encodings=i;this._remoteSdp.send({offerMediaObject:M,reuseMid:g.reuseMid,offerRtpParameters:u,answerRtpParameters:f,codecOptions:c});const D={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",D),await this._pc.setRemoteDescription(D),this._mapMidTransceiver.set(k,T),{localId:k,rtpParameters:u,rtpSender:T.sender}}async stopSending(r){if(this.assertSendDirection(),l.debug("stopSending() [localId:%s]",r),this._closed)return;const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");if(i.sender.replaceTrack(null),this._pc.removeTrack(i.sender),this._remoteSdp.closeMediaSection(i.mid))try{i.stop()}catch{}const a=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d),this._mapMidTransceiver.delete(r)}async pauseSending(r){this.assertNotClosed(),this.assertSendDirection(),l.debug("pauseSending() [localId:%s]",r);const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="inactive",this._remoteSdp.pauseMediaSection(r);const c=await this._pc.createOffer();l.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async resumeSending(r){this.assertNotClosed(),this.assertSendDirection(),l.debug("resumeSending() [localId:%s]",r);const i=this._mapMidTransceiver.get(r);if(this._remoteSdp.resumeSendingMediaSection(r),!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="sendonly";const c=await this._pc.createOffer();l.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(r,i){this.assertNotClosed(),this.assertSendDirection(),i?l.debug("replaceTrack() [localId:%s, track.id:%s]",r,i.id):l.debug("replaceTrack() [localId:%s, no track]",r);const c=this._mapMidTransceiver.get(r);if(!c)throw new Error("associated RTCRtpTransceiver not found");await c.sender.replaceTrack(i)}async setMaxSpatialLayer(r,i){this.assertNotClosed(),this.assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",r,i);const c=this._mapMidTransceiver.get(r);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((f,g)=>{g<=i?f.active=!0:f.active=!1}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(r,a.encodings);const d=await this._pc.createOffer();l.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const u={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}async setRtpEncodingParameters(r,i){this.assertNotClosed(),this.assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",r,i);const c=this._mapMidTransceiver.get(r);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((f,g)=>{a.encodings[g]={...f,...i}}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(r,a.encodings);const d=await this._pc.createOffer();l.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const u={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}async getSenderStats(r){this.assertNotClosed(),this.assertSendDirection();const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");return i.sender.getStats()}async sendDataChannel({ordered:r,maxPacketLifeTime:i,maxRetransmits:c,label:a,protocol:d}){this.assertNotClosed(),this.assertSendDirection();const u={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:i,maxRetransmits:c,protocol:d};l.debug("sendDataChannel() [options:%o]",u);const f=this._pc.createDataChannel(a,u);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%S.MIS,!this._hasDataChannelMediaSection){const T=await this._pc.createOffer(),h=n.parse(T.sdp),P=h.media.find(M=>M.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const k={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),this._hasDataChannelMediaSection=!0}const g={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits};return{dataChannel:f,sctpStreamParameters:g}}async receive(r){this.assertNotClosed(),this.assertRecvDirection();const i=[],c=new Map;for(const f of r){const{trackId:g,kind:T,rtpParameters:h,streamId:P}=f;l.debug("receive() [trackId:%s, kind:%s]",g,T);const k=h.mid??String(this._mapMidTransceiver.size);c.set(g,k),this._remoteSdp.receive({mid:k,kind:T,offerRtpParameters:h,streamId:P??h.rtcp.cname,trackId:g})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);for(const f of r){const{trackId:g,onRtpReceiver:T}=f;if(T){const h=c.get(g),P=this._pc.getTransceivers().find(k=>k.mid===h);if(!P)throw new Error("transceiver not found");T(P.receiver)}}let d=await this._pc.createAnswer();const u=n.parse(d.sdp);for(const f of r){const{trackId:g,rtpParameters:T}=f,h=c.get(g),P=u.media.find(k=>String(k.mid)===h);_.applyCodecParameters({offerRtpParameters:T,answerMediaObject:P})}d={type:"answer",sdp:n.write(u)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u}),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const f of r){const{trackId:g}=f,T=c.get(g),h=this._pc.getTransceivers().find(P=>P.mid===T);if(h)this._mapMidTransceiver.set(T,h),i.push({localId:T,track:h.receiver.track,rtpReceiver:h.receiver});else throw new Error("new RTCRtpTransceiver not found")}return i}async stopReceiving(r){if(this.assertRecvDirection(),this._closed)return;for(const a of r){l.debug("stopReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(d.mid)}const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const a of r)this._mapMidTransceiver.delete(a)}async pauseReceiving(r){this.assertNotClosed(),this.assertRecvDirection();for(const a of r){l.debug("pauseReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="inactive",this._remoteSdp.pauseMediaSection(a)}const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async resumeReceiving(r){this.assertNotClosed(),this.assertRecvDirection();for(const a of r){l.debug("resumeReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(a)}const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async getReceiverStats(r){this.assertNotClosed(),this.assertRecvDirection();const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");return i.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:r,label:i,protocol:c}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:a,ordered:d,maxPacketLifeTime:u,maxRetransmits:f}=r,g={negotiated:!0,id:a,ordered:d,maxPacketLifeTime:u,maxRetransmits:f,protocol:c};l.debug("receiveDataChannel() [options:%o]",g);const T=this._pc.createDataChannel(i,g);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const h={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",h),await this._pc.setRemoteDescription(h);const P=await this._pc.createAnswer();if(!this._transportReady){const k=n.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:k})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:T}}async setupTransport({localDtlsRole:r,localSdpObject:i}){i||(i=n.parse(this._pc.localDescription.sdp));const c=_.extractDtlsParameters({sdpObject:i});c.role=r,this._remoteSdp.updateDtlsRole(r==="client"?"server":"client"),await new Promise((a,d)=>{this.safeEmit("@connect",{dtlsParameters:c},a,d)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new y.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return gt.Chrome111=p,gt}var yt={},ki;function Do(){if(ki)return yt;ki=1,Object.defineProperty(yt,"__esModule",{value:!0}),yt.Chrome74=void 0;const n=ae(),e=Q(),s=X(),t=re(),_=me(),m=qe(),w=kr(),y=te(),C=oe(),R=ge(),v=Le(),l=new e.Logger("Chrome74"),b="Chrome74",S={OS:1024,MIS:1024};let p=class Un extends C.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Un}constructor(){super()}get name(){return b}close(){if(l.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{r.addTransceiver("audio"),r.addTransceiver("video");const i=await r.createOffer();try{r.close()}catch{}const c=n.parse(i.sdp),a=_.extractRtpCapabilities({sdpObject:c});return w.addNackSupportForOpus(a),a}catch(i){try{r.close()}catch{}throw i}}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:S}}run({direction:r,iceParameters:i,iceCandidates:c,dtlsParameters:a,sctpParameters:d,iceServers:u,iceTransportPolicy:f,additionalSettings:g,proprietaryConstraints:T,extendedRtpCapabilities:h}){l.debug("run()"),this._direction=r,this._remoteSdp=new R.RemoteSdp({iceParameters:i,iceCandidates:c,dtlsParameters:a,sctpParameters:d}),this._sendingRtpParametersByKind={audio:t.getSendingRtpParameters("audio",h),video:t.getSendingRtpParameters("video",h)},this._sendingRemoteRtpParametersByKind={audio:t.getSendingRemoteRtpParameters("audio",h),video:t.getSendingRemoteRtpParameters("video",h)},a.role&&a.role!=="auto"&&(this._forcedLocalDtlsRole=a.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:u??[],iceTransportPolicy:f??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...g},T),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",P=>{this.emit("@icecandidateerror",P)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(l.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}))}async updateIceServers(r){this.assertNotClosed(),l.debug("updateIceServers()");const i=this._pc.getConfiguration();i.iceServers=r,this._pc.setConfiguration(i)}async restartIce(r){if(this.assertNotClosed(),l.debug("restartIce()"),this._remoteSdp.updateIceParameters(r),!!this._transportReady)if(this._direction==="send"){const i=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}else{const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:r,encodings:i,codecOptions:c,codec:a}){this.assertNotClosed(),this.assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),i&&i.length>1&&i.forEach((E,x)=>{E.rid=`r${x}`});const d=s.clone(this._sendingRtpParametersByKind[r.kind]);d.codecs=t.reduceCodecs(d.codecs,a);const u=s.clone(this._sendingRemoteRtpParametersByKind[r.kind]);u.codecs=t.reduceCodecs(u.codecs,a);const f=this._remoteSdp.getNextMediaSectionIdx(),g=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream],sendEncodings:i});let T=await this._pc.createOffer(),h=n.parse(T.sdp);h.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let P;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h});let k=!1;const M=(0,v.parse)((i??[{}])[0].scalabilityMode);i&&i.length===1&&M.spatialLayers>1&&d.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(l.debug("send() | enabling legacy simulcast for VP9 SVC"),k=!0,h=n.parse(T.sdp),P=h.media[f.idx],m.addLegacySimulcast({offerMediaObject:P,numStreams:M.spatialLayers}),T={type:"offer",sdp:n.write(h)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T);const D=g.mid;if(d.mid=D,h=n.parse(this._pc.localDescription.sdp),P=h.media[f.idx],d.rtcp.cname=_.getCname({offerMediaObject:P}),!i)d.encodings=m.getRtpEncodings({offerMediaObject:P});else if(i.length===1){let E=m.getRtpEncodings({offerMediaObject:P});Object.assign(E[0],i[0]),k&&(E=[E[0]]),d.encodings=E}else d.encodings=i;if(d.encodings.length>1&&(d.codecs[0].mimeType.toLowerCase()==="video/vp8"||d.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const E of d.encodings)E.scalabilityMode?E.scalabilityMode=`L1T${M.temporalLayers}`:E.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:P,reuseMid:f.reuseMid,offerRtpParameters:d,answerRtpParameters:u,codecOptions:c});const I={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",I),await this._pc.setRemoteDescription(I),this._mapMidTransceiver.set(D,g),{localId:D,rtpParameters:d,rtpSender:g.sender}}async stopSending(r){if(this.assertSendDirection(),l.debug("stopSending() [localId:%s]",r),this._closed)return;const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");if(i.sender.replaceTrack(null),this._pc.removeTrack(i.sender),this._remoteSdp.closeMediaSection(i.mid))try{i.stop()}catch{}const a=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d),this._mapMidTransceiver.delete(r)}async pauseSending(r){this.assertNotClosed(),this.assertSendDirection(),l.debug("pauseSending() [localId:%s]",r);const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="inactive",this._remoteSdp.pauseMediaSection(r);const c=await this._pc.createOffer();l.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async resumeSending(r){this.assertNotClosed(),this.assertSendDirection(),l.debug("resumeSending() [localId:%s]",r);const i=this._mapMidTransceiver.get(r);if(this._remoteSdp.resumeSendingMediaSection(r),!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="sendonly";const c=await this._pc.createOffer();l.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(r,i){this.assertNotClosed(),this.assertSendDirection(),i?l.debug("replaceTrack() [localId:%s, track.id:%s]",r,i.id):l.debug("replaceTrack() [localId:%s, no track]",r);const c=this._mapMidTransceiver.get(r);if(!c)throw new Error("associated RTCRtpTransceiver not found");await c.sender.replaceTrack(i)}async setMaxSpatialLayer(r,i){this.assertNotClosed(),this.assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",r,i);const c=this._mapMidTransceiver.get(r);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((f,g)=>{g<=i?f.active=!0:f.active=!1}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(r,a.encodings);const d=await this._pc.createOffer();l.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const u={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}async setRtpEncodingParameters(r,i){this.assertNotClosed(),this.assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",r,i);const c=this._mapMidTransceiver.get(r);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((f,g)=>{a.encodings[g]={...f,...i}}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(r,a.encodings);const d=await this._pc.createOffer();l.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const u={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}async getSenderStats(r){this.assertNotClosed(),this.assertSendDirection();const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");return i.sender.getStats()}async sendDataChannel({ordered:r,maxPacketLifeTime:i,maxRetransmits:c,label:a,protocol:d}){this.assertNotClosed(),this.assertSendDirection();const u={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:i,maxRetransmits:c,protocol:d};l.debug("sendDataChannel() [options:%o]",u);const f=this._pc.createDataChannel(a,u);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%S.MIS,!this._hasDataChannelMediaSection){const T=await this._pc.createOffer(),h=n.parse(T.sdp),P=h.media.find(M=>M.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const k={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),this._hasDataChannelMediaSection=!0}const g={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits};return{dataChannel:f,sctpStreamParameters:g}}async receive(r){this.assertNotClosed(),this.assertRecvDirection();const i=[],c=new Map;for(const f of r){const{trackId:g,kind:T,rtpParameters:h,streamId:P}=f;l.debug("receive() [trackId:%s, kind:%s]",g,T);const k=h.mid??String(this._mapMidTransceiver.size);c.set(g,k),this._remoteSdp.receive({mid:k,kind:T,offerRtpParameters:h,streamId:P??h.rtcp.cname,trackId:g})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);let d=await this._pc.createAnswer();const u=n.parse(d.sdp);for(const f of r){const{trackId:g,rtpParameters:T}=f,h=c.get(g),P=u.media.find(k=>String(k.mid)===h);_.applyCodecParameters({offerRtpParameters:T,answerMediaObject:P})}d={type:"answer",sdp:n.write(u)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u}),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const f of r){const{trackId:g}=f,T=c.get(g),h=this._pc.getTransceivers().find(P=>P.mid===T);if(h)this._mapMidTransceiver.set(T,h),i.push({localId:T,track:h.receiver.track,rtpReceiver:h.receiver});else throw new Error("new RTCRtpTransceiver not found")}return i}async stopReceiving(r){if(this.assertRecvDirection(),this._closed)return;for(const a of r){l.debug("stopReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(d.mid)}const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const a of r)this._mapMidTransceiver.delete(a)}async pauseReceiving(r){this.assertNotClosed(),this.assertRecvDirection();for(const a of r){l.debug("pauseReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="inactive",this._remoteSdp.pauseMediaSection(a)}const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async resumeReceiving(r){this.assertNotClosed(),this.assertRecvDirection();for(const a of r){l.debug("resumeReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(a)}const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async getReceiverStats(r){this.assertNotClosed(),this.assertRecvDirection();const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");return i.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:r,label:i,protocol:c}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:a,ordered:d,maxPacketLifeTime:u,maxRetransmits:f}=r,g={negotiated:!0,id:a,ordered:d,maxPacketLifeTime:u,maxRetransmits:f,protocol:c};l.debug("receiveDataChannel() [options:%o]",g);const T=this._pc.createDataChannel(i,g);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const h={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",h),await this._pc.setRemoteDescription(h);const P=await this._pc.createAnswer();if(!this._transportReady){const k=n.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:k})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:T}}async setupTransport({localDtlsRole:r,localSdpObject:i}){i||(i=n.parse(this._pc.localDescription.sdp));const c=_.extractDtlsParameters({sdpObject:i});c.role=r,this._remoteSdp.updateDtlsRole(r==="client"?"server":"client"),await new Promise((a,d)=>{this.safeEmit("@connect",{dtlsParameters:c},a,d)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new y.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return yt.Chrome74=p,yt}var bt={},Ei;function Po(){if(Ei)return bt;Ei=1,Object.defineProperty(bt,"__esModule",{value:!0}),bt.Chrome70=void 0;const n=ae(),e=Q(),s=X(),t=re(),_=me(),m=qe(),w=oe(),y=ge(),C=Le(),R=new e.Logger("Chrome70"),v="Chrome70",l={OS:1024,MIS:1024};let b=class $n extends w.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new $n}constructor(){super()}get name(){return v}close(){if(R.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){R.debug("getNativeRtpCapabilities()");const p=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{p.addTransceiver("audio"),p.addTransceiver("video");const o=await p.createOffer();try{p.close()}catch{}const r=n.parse(o.sdp);return _.extractRtpCapabilities({sdpObject:r})}catch(o){try{p.close()}catch{}throw o}}async getNativeSctpCapabilities(){return R.debug("getNativeSctpCapabilities()"),{numStreams:l}}run({direction:p,iceParameters:o,iceCandidates:r,dtlsParameters:i,sctpParameters:c,iceServers:a,iceTransportPolicy:d,additionalSettings:u,proprietaryConstraints:f,extendedRtpCapabilities:g}){R.debug("run()"),this._direction=p,this._remoteSdp=new y.RemoteSdp({iceParameters:o,iceCandidates:r,dtlsParameters:i,sctpParameters:c}),this._sendingRtpParametersByKind={audio:t.getSendingRtpParameters("audio",g),video:t.getSendingRtpParameters("video",g)},this._sendingRemoteRtpParametersByKind={audio:t.getSendingRemoteRtpParameters("audio",g),video:t.getSendingRemoteRtpParameters("video",g)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...u},f),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",T=>{this.emit("@icecandidateerror",T)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(R.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(p){R.debug("updateIceServers()");const o=this._pc.getConfiguration();o.iceServers=p,this._pc.setConfiguration(o)}async restartIce(p){if(R.debug("restartIce()"),this._remoteSdp.updateIceParameters(p),!!this._transportReady)if(this._direction==="send"){const o=await this._pc.createOffer({iceRestart:!0});R.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const r={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const o={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);const r=await this._pc.createAnswer();R.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this._pc.getStats()}async send({track:p,encodings:o,codecOptions:r,codec:i}){this.assertSendDirection(),R.debug("send() [kind:%s, track.id:%s]",p.kind,p.id);const c=s.clone(this._sendingRtpParametersByKind[p.kind]);c.codecs=t.reduceCodecs(c.codecs,i);const a=s.clone(this._sendingRemoteRtpParametersByKind[p.kind]);a.codecs=t.reduceCodecs(a.codecs,i);const d=this._remoteSdp.getNextMediaSectionIdx(),u=this._pc.addTransceiver(p,{direction:"sendonly",streams:[this._sendStream]});let f=await this._pc.createOffer(),g=n.parse(f.sdp);g.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let T;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:g}),o&&o.length>1&&(R.debug("send() | enabling legacy simulcast"),g=n.parse(f.sdp),T=g.media[d.idx],m.addLegacySimulcast({offerMediaObject:T,numStreams:o.length}),f={type:"offer",sdp:n.write(g)});let h=!1;const P=(0,C.parse)((o??[{}])[0].scalabilityMode);if(o&&o.length===1&&P.spatialLayers>1&&c.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(R.debug("send() | enabling legacy simulcast for VP9 SVC"),h=!0,g=n.parse(f.sdp),T=g.media[d.idx],m.addLegacySimulcast({offerMediaObject:T,numStreams:P.spatialLayers}),f={type:"offer",sdp:n.write(g)}),R.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f),o){R.debug("send() | applying given encodings");const D=u.sender.getParameters();for(let I=0;I<(D.encodings??[]).length;++I){const E=D.encodings[I],x=o[I];if(!x)break;D.encodings[I]=Object.assign(E,x)}await u.sender.setParameters(D)}const k=u.mid;if(c.mid=k,g=n.parse(this._pc.localDescription.sdp),T=g.media[d.idx],c.rtcp.cname=_.getCname({offerMediaObject:T}),c.encodings=m.getRtpEncodings({offerMediaObject:T}),o)for(let D=0;D<c.encodings.length;++D)o[D]&&Object.assign(c.encodings[D],o[D]);if(h&&(c.encodings=[c.encodings[0]]),c.encodings.length>1&&(c.codecs[0].mimeType.toLowerCase()==="video/vp8"||c.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const D of c.encodings)D.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:T,reuseMid:d.reuseMid,offerRtpParameters:c,answerRtpParameters:a,codecOptions:r});const M={type:"answer",sdp:this._remoteSdp.getSdp()};return R.debug("send() | calling pc.setRemoteDescription() [answer:%o]",M),await this._pc.setRemoteDescription(M),this._mapMidTransceiver.set(k,u),{localId:k,rtpParameters:c,rtpSender:u.sender}}async stopSending(p){this.assertSendDirection(),R.debug("stopSending() [localId:%s]",p);const o=this._mapMidTransceiver.get(p);if(!o)throw new Error("associated RTCRtpTransceiver not found");if(o.sender.replaceTrack(null),this._pc.removeTrack(o.sender),this._remoteSdp.closeMediaSection(o.mid))try{o.stop()}catch{}const i=await this._pc.createOffer();R.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),this._mapMidTransceiver.delete(p)}async pauseSending(p){}async resumeSending(p){}async replaceTrack(p,o){this.assertSendDirection(),o?R.debug("replaceTrack() [localId:%s, track.id:%s]",p,o.id):R.debug("replaceTrack() [localId:%s, no track]",p);const r=this._mapMidTransceiver.get(p);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(o)}async setMaxSpatialLayer(p,o){this.assertSendDirection(),R.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",p,o);const r=this._mapMidTransceiver.get(p);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach((d,u)=>{u<=o?d.active=!0:d.active=!1}),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(p,i.encodings);const c=await this._pc.createOffer();R.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(p,o){this.assertSendDirection(),R.debug("setRtpEncodingParameters() [localId:%s, params:%o]",p,o);const r=this._mapMidTransceiver.get(p);if(!r)throw new Error("associated RTCRtpTransceiver not found");const i=r.sender.getParameters();i.encodings.forEach((d,u)=>{i.encodings[u]={...d,...o}}),await r.sender.setParameters(i),this._remoteSdp.muxMediaSectionSimulcast(p,i.encodings);const c=await this._pc.createOffer();R.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(p){this.assertSendDirection();const o=this._mapMidTransceiver.get(p);if(!o)throw new Error("associated RTCRtpTransceiver not found");return o.sender.getStats()}async sendDataChannel({ordered:p,maxPacketLifeTime:o,maxRetransmits:r,label:i,protocol:c}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:p,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:r,protocol:c};R.debug("sendDataChannel() [options:%o]",a);const d=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%l.MIS,!this._hasDataChannelMediaSection){const f=await this._pc.createOffer(),g=n.parse(f.sdp),T=g.media.find(P=>P.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:g}),R.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f),this._remoteSdp.sendSctpAssociation({offerMediaObject:T});const h={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}const u={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:d,sctpStreamParameters:u}}async receive(p){this.assertRecvDirection();const o=[],r=new Map;for(const d of p){const{trackId:u,kind:f,rtpParameters:g,streamId:T}=d;R.debug("receive() [trackId:%s, kind:%s]",u,f);const h=g.mid??String(this._mapMidTransceiver.size);r.set(u,h),this._remoteSdp.receive({mid:h,kind:f,offerRtpParameters:g,streamId:T??g.rtcp.cname,trackId:u})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let c=await this._pc.createAnswer();const a=n.parse(c.sdp);for(const d of p){const{trackId:u,rtpParameters:f}=d,g=r.get(u),T=a.media.find(h=>String(h.mid)===g);_.applyCodecParameters({offerRtpParameters:f,answerMediaObject:T})}c={type:"answer",sdp:n.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),R.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const d of p){const{trackId:u}=d,f=r.get(u),g=this._pc.getTransceivers().find(T=>T.mid===f);if(!g)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(f,g),o.push({localId:f,track:g.receiver.track,rtpReceiver:g.receiver})}return o}async stopReceiving(p){this.assertRecvDirection();for(const i of p){R.debug("stopReceiving() [localId:%s]",i);const c=this._mapMidTransceiver.get(i);if(!c)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(c.mid)}const o={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);const r=await this._pc.createAnswer();R.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const i of p)this._mapMidTransceiver.delete(i)}async pauseReceiving(p){}async resumeReceiving(p){}async getReceiverStats(p){this.assertRecvDirection();const o=this._mapMidTransceiver.get(p);if(!o)throw new Error("associated RTCRtpTransceiver not found");return o.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:p,label:o,protocol:r}){this.assertRecvDirection();const{streamId:i,ordered:c,maxPacketLifeTime:a,maxRetransmits:d}=p,u={negotiated:!0,id:i,ordered:c,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:d,protocol:r};R.debug("receiveDataChannel() [options:%o]",u);const f=this._pc.createDataChannel(o,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const g={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);const T=await this._pc.createAnswer();if(!this._transportReady){const h=n.parse(T.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h})}R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setLocalDescription(T),this._hasDataChannelMediaSection=!0}return{dataChannel:f}}async setupTransport({localDtlsRole:p,localSdpObject:o}){o||(o=n.parse(this._pc.localDescription.sdp));const r=_.extractDtlsParameters({sdpObject:o});r.role=p,this._remoteSdp.updateDtlsRole(p==="client"?"server":"client"),await new Promise((i,c)=>{this.safeEmit("@connect",{dtlsParameters:r},i,c)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return bt.Chrome70=b,bt}var St={},Rt={},xi;function Er(){if(xi)return Rt;xi=1,Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.getRtpEncodings=n,Rt.addLegacySimulcast=e;function n({offerMediaObject:s,track:t}){const _=new Set;for(const y of s.ssrcs??[]){if(y.attribute!=="msid")continue;if(y.value.split(" ")[1]===t.id){const R=y.id;_.add(R)}}if(_.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);const m=new Map;for(const y of s.ssrcGroups??[]){if(y.semantics!=="FID")continue;let[C,R]=y.ssrcs.split(/\s+/);C=Number(C),R=Number(R),_.has(C)&&(_.delete(C),_.delete(R),m.set(C,R))}for(const y of _)m.set(y,null);const w=[];for(const[y,C]of m){const R={ssrc:y};C&&(R.rtx={ssrc:C}),w.push(R)}return w}function e({offerMediaObject:s,track:t,numStreams:_}){if(_<=1)throw new TypeError("numStreams must be greater than 1");let m,w,y;if(!(s.ssrcs??[]).find(S=>S.attribute!=="msid"?!1:S.value.split(" ")[1]===t.id?(m=S.id,y=S.value.split(" ")[0],!0):!1))throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);(s.ssrcGroups??[]).some(S=>{if(S.semantics!=="FID")return!1;const p=S.ssrcs.split(/\s+/);return Number(p[0])===m?(w=Number(p[1]),!0):!1});const R=s.ssrcs.find(S=>S.attribute==="cname"&&S.id===m);if(!R)throw new Error(`a=ssrc line with cname information not found [track.id:${t.id}]`);const v=R.value,l=[],b=[];for(let S=0;S<_;++S)l.push(m+S),w&&b.push(w+S);s.ssrcGroups=s.ssrcGroups??[],s.ssrcs=s.ssrcs??[],s.ssrcGroups.push({semantics:"SIM",ssrcs:l.join(" ")});for(const S of l)s.ssrcs.push({id:S,attribute:"cname",value:v}),s.ssrcs.push({id:S,attribute:"msid",value:`${y} ${t.id}`});for(let S=0;S<b.length;++S){const p=l[S],o=b[S];s.ssrcs.push({id:o,attribute:"cname",value:v}),s.ssrcs.push({id:o,attribute:"msid",value:`${y} ${t.id}`}),s.ssrcGroups.push({semantics:"FID",ssrcs:`${p} ${o}`})}}return Rt}var Li;function ko(){if(Li)return St;Li=1,Object.defineProperty(St,"__esModule",{value:!0}),St.Chrome67=void 0;const n=ae(),e=Q(),s=X(),t=re(),_=me(),m=Er(),w=oe(),y=ge(),C=new e.Logger("Chrome67"),R="Chrome67",v={OS:1024,MIS:1024};let l=class zn extends w.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_sendStream=new MediaStream;_mapSendLocalIdRtpSender=new Map;_nextSendLocalId=0;_mapRecvLocalIdInfo=new Map;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new zn}constructor(){super()}get name(){return R}close(){if(C.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){C.debug("getNativeRtpCapabilities()");const S=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const p=await S.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{S.close()}catch{}const o=n.parse(p.sdp);return _.extractRtpCapabilities({sdpObject:o})}catch(p){try{S.close()}catch{}throw p}}async getNativeSctpCapabilities(){return C.debug("getNativeSctpCapabilities()"),{numStreams:v}}run({direction:S,iceParameters:p,iceCandidates:o,dtlsParameters:r,sctpParameters:i,iceServers:c,iceTransportPolicy:a,additionalSettings:d,proprietaryConstraints:u,extendedRtpCapabilities:f}){C.debug("run()"),this._direction=S,this._remoteSdp=new y.RemoteSdp({iceParameters:p,iceCandidates:o,dtlsParameters:r,sctpParameters:i,planB:!0}),this._sendingRtpParametersByKind={audio:t.getSendingRtpParameters("audio",f),video:t.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:t.getSendingRemoteRtpParameters("audio",f),video:t.getSendingRemoteRtpParameters("video",f)},r.role&&r.role!=="auto"&&(this._forcedLocalDtlsRole=r.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:c??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...d},u),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",g=>{this.emit("@icecandidateerror",g)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(S){C.debug("updateIceServers()");const p=this._pc.getConfiguration();p.iceServers=S,this._pc.setConfiguration(p)}async restartIce(S){if(C.debug("restartIce()"),this._remoteSdp.updateIceParameters(S),!!this._transportReady)if(this._direction==="send"){const p=await this._pc.createOffer({iceRestart:!0});C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const o={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}else{const p={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);const o=await this._pc.createAnswer();C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o)}}async getTransportStats(){return this._pc.getStats()}async send({track:S,encodings:p,codecOptions:o,codec:r}){this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",S.kind,S.id),r&&C.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(S),this._pc.addTrack(S,this._sendStream);let i=await this._pc.createOffer(),c=n.parse(i.sdp);c.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let a;const d=s.clone(this._sendingRtpParametersByKind[S.kind]);d.codecs=t.reduceCodecs(d.codecs);const u=s.clone(this._sendingRemoteRtpParametersByKind[S.kind]);if(u.codecs=t.reduceCodecs(u.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),S.kind==="video"&&p&&p.length>1&&(C.debug("send() | enabling simulcast"),c=n.parse(i.sdp),a=c.media.find(h=>h.type==="video"),m.addLegacySimulcast({offerMediaObject:a,track:S,numStreams:p.length}),i={type:"offer",sdp:n.write(c)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),c=n.parse(this._pc.localDescription.sdp),a=c.media.find(h=>h.type===S.kind),d.rtcp.cname=_.getCname({offerMediaObject:a}),d.encodings=m.getRtpEncodings({offerMediaObject:a,track:S}),p)for(let h=0;h<d.encodings.length;++h)p[h]&&Object.assign(d.encodings[h],p[h]);if(d.encodings.length>1&&d.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const h of d.encodings)h.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:d,answerRtpParameters:u,codecOptions:o});const f={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f);const g=String(this._nextSendLocalId);this._nextSendLocalId++;const T=this._pc.getSenders().find(h=>h.track===S);return this._mapSendLocalIdRtpSender.set(g,T),{localId:g,rtpParameters:d,rtpSender:T}}async stopSending(S){this.assertSendDirection(),C.debug("stopSending() [localId:%s]",S);const p=this._mapSendLocalIdRtpSender.get(S);if(!p)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(p),p.track&&this._sendStream.removeTrack(p.track),this._mapSendLocalIdRtpSender.delete(S);const o=await this._pc.createOffer();C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",o);try{await this._pc.setLocalDescription(o)}catch(i){if(this._sendStream.getTracks().length===0){C.warn("stopSending() | ignoring expected error due no sending tracks: %s",i.toString());return}throw i}if(this._pc.signalingState==="stable")return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async pauseSending(S){}async resumeSending(S){}async replaceTrack(S,p){this.assertSendDirection(),p?C.debug("replaceTrack() [localId:%s, track.id:%s]",S,p.id):C.debug("replaceTrack() [localId:%s, no track]",S);const o=this._mapSendLocalIdRtpSender.get(S);if(!o)throw new Error("associated RTCRtpSender not found");const r=o.track;await o.replaceTrack(p),r&&this._sendStream.removeTrack(r),p&&this._sendStream.addTrack(p)}async setMaxSpatialLayer(S,p){this.assertSendDirection(),C.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",S,p);const o=this._mapSendLocalIdRtpSender.get(S);if(!o)throw new Error("associated RTCRtpSender not found");const r=o.getParameters();r.encodings.forEach((i,c)=>{c<=p?i.active=!0:i.active=!1}),await o.setParameters(r)}async setRtpEncodingParameters(S,p){this.assertSendDirection(),C.debug("setRtpEncodingParameters() [localId:%s, params:%o]",S,p);const o=this._mapSendLocalIdRtpSender.get(S);if(!o)throw new Error("associated RTCRtpSender not found");const r=o.getParameters();r.encodings.forEach((i,c)=>{r.encodings[c]={...i,...p}}),await o.setParameters(r)}async getSenderStats(S){this.assertSendDirection();const p=this._mapSendLocalIdRtpSender.get(S);if(!p)throw new Error("associated RTCRtpSender not found");return p.getStats()}async sendDataChannel({ordered:S,maxPacketLifeTime:p,maxRetransmits:o,label:r,protocol:i}){this.assertSendDirection();const c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:S,maxPacketLifeTime:p,maxRetransmitTime:p,maxRetransmits:o,protocol:i};C.debug("sendDataChannel() [options:%o]",c);const a=this._pc.createDataChannel(r,c);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%v.MIS,!this._hasDataChannelMediaSection){const u=await this._pc.createOffer(),f=n.parse(u.sdp),g=f.media.find(h=>h.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f}),C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),this._remoteSdp.sendSctpAssociation({offerMediaObject:g});const T={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T),this._hasDataChannelMediaSection=!0}const d={streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits};return{dataChannel:a,sctpStreamParameters:d}}async receive(S){this.assertRecvDirection();const p=[];for(const c of S){const{trackId:a,kind:d,rtpParameters:u,streamId:f}=c;C.debug("receive() [trackId:%s, kind:%s]",a,d);const g=d;this._remoteSdp.receive({mid:g,kind:d,offerRtpParameters:u,streamId:f??u.rtcp.cname,trackId:a})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let r=await this._pc.createAnswer();const i=n.parse(r.sdp);for(const c of S){const{kind:a,rtpParameters:d}=c,u=a,f=i.media.find(g=>String(g.mid)===u);_.applyCodecParameters({offerRtpParameters:d,answerMediaObject:f})}r={type:"answer",sdp:n.write(i)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const c of S){const{kind:a,trackId:d,rtpParameters:u}=c,f=d,g=a,T=this._pc.getReceivers().find(h=>h.track&&h.track.id===f);if(!T)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(f,{mid:g,rtpParameters:u,rtpReceiver:T}),p.push({localId:f,track:T.track,rtpReceiver:T})}return p}async stopReceiving(S){this.assertRecvDirection();for(const r of S){C.debug("stopReceiving() [localId:%s]",r);const{mid:i,rtpParameters:c}=this._mapRecvLocalIdInfo.get(r)??{};this._mapRecvLocalIdInfo.delete(r),this._remoteSdp.planBStopReceiving({mid:i,offerRtpParameters:c})}const p={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);const o=await this._pc.createAnswer();C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o)}async pauseReceiving(S){}async resumeReceiving(S){}async getReceiverStats(S){this.assertRecvDirection();const{rtpReceiver:p}=this._mapRecvLocalIdInfo.get(S)??{};if(!p)throw new Error("associated RTCRtpReceiver not found");return p.getStats()}async receiveDataChannel({sctpStreamParameters:S,label:p,protocol:o}){this.assertRecvDirection();const{streamId:r,ordered:i,maxPacketLifeTime:c,maxRetransmits:a}=S,d={negotiated:!0,id:r,ordered:i,maxPacketLifeTime:c,maxRetransmitTime:c,maxRetransmits:a,protocol:o};C.debug("receiveDataChannel() [options:%o]",d);const u=this._pc.createDataChannel(p,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const f={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),await this._pc.setRemoteDescription(f);const g=await this._pc.createAnswer();if(!this._transportReady){const T=n.parse(g.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:T})}C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setLocalDescription(g),this._hasDataChannelMediaSection=!0}return{dataChannel:u}}async setupTransport({localDtlsRole:S,localSdpObject:p}){p||(p=n.parse(this._pc.localDescription.sdp));const o=_.extractDtlsParameters({sdpObject:p});o.role=S,this._remoteSdp.updateDtlsRole(S==="client"?"server":"client"),await new Promise((r,i)=>{this.safeEmit("@connect",{dtlsParameters:o},r,i)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return St.Chrome67=l,St}var Ct={},Ii;function Eo(){if(Ii)return Ct;Ii=1,Object.defineProperty(Ct,"__esModule",{value:!0}),Ct.Chrome55=void 0;const n=ae(),e=Q(),s=te(),t=X(),_=re(),m=me(),w=Er(),y=oe(),C=ge(),R=new e.Logger("Chrome55"),v="Chrome55",l={OS:1024,MIS:1024};let b=class Vn extends y.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_sendStream=new MediaStream;_mapSendLocalIdTrack=new Map;_nextSendLocalId=0;_mapRecvLocalIdInfo=new Map;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Vn}constructor(){super()}get name(){return v}close(){if(R.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){R.debug("getNativeRtpCapabilities()");const p=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const o=await p.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{p.close()}catch{}const r=n.parse(o.sdp);return m.extractRtpCapabilities({sdpObject:r})}catch(o){try{p.close()}catch{}throw o}}async getNativeSctpCapabilities(){return R.debug("getNativeSctpCapabilities()"),{numStreams:l}}run({direction:p,iceParameters:o,iceCandidates:r,dtlsParameters:i,sctpParameters:c,iceServers:a,iceTransportPolicy:d,additionalSettings:u,proprietaryConstraints:f,extendedRtpCapabilities:g}){R.debug("run()"),this._direction=p,this._remoteSdp=new C.RemoteSdp({iceParameters:o,iceCandidates:r,dtlsParameters:i,sctpParameters:c,planB:!0}),this._sendingRtpParametersByKind={audio:_.getSendingRtpParameters("audio",g),video:_.getSendingRtpParameters("video",g)},this._sendingRemoteRtpParametersByKind={audio:_.getSendingRemoteRtpParameters("audio",g),video:_.getSendingRemoteRtpParameters("video",g)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...u},f),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",T=>{this.emit("@icecandidateerror",T)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(R.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(p){R.debug("updateIceServers()");const o=this._pc.getConfiguration();o.iceServers=p,this._pc.setConfiguration(o)}async restartIce(p){if(R.debug("restartIce()"),this._remoteSdp.updateIceParameters(p),!!this._transportReady)if(this._direction==="send"){const o=await this._pc.createOffer({iceRestart:!0});R.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const r={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const o={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);const r=await this._pc.createAnswer();R.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this._pc.getStats()}async send({track:p,encodings:o,codecOptions:r,codec:i}){this.assertSendDirection(),R.debug("send() [kind:%s, track.id:%s]",p.kind,p.id),i&&R.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(p),this._pc.addStream(this._sendStream);let c=await this._pc.createOffer(),a=n.parse(c.sdp);a.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let d;const u=t.clone(this._sendingRtpParametersByKind[p.kind]);u.codecs=_.reduceCodecs(u.codecs);const f=t.clone(this._sendingRemoteRtpParametersByKind[p.kind]);if(f.codecs=_.reduceCodecs(f.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),p.kind==="video"&&o&&o.length>1&&(R.debug("send() | enabling simulcast"),a=n.parse(c.sdp),d=a.media.find(h=>h.type==="video"),w.addLegacySimulcast({offerMediaObject:d,track:p,numStreams:o.length}),c={type:"offer",sdp:n.write(a)}),R.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),a=n.parse(this._pc.localDescription.sdp),d=a.media.find(h=>h.type===p.kind),u.rtcp.cname=m.getCname({offerMediaObject:d}),u.encodings=w.getRtpEncodings({offerMediaObject:d,track:p}),o)for(let h=0;h<u.encodings.length;++h)o[h]&&Object.assign(u.encodings[h],o[h]);if(u.encodings.length>1&&u.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const h of u.encodings)h.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,offerRtpParameters:u,answerRtpParameters:f,codecOptions:r});const g={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g);const T=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(T,p),{localId:T,rtpParameters:u}}async stopSending(p){this.assertSendDirection(),R.debug("stopSending() [localId:%s]",p);const o=this._mapSendLocalIdTrack.get(p);if(!o)throw new Error("track not found");this._mapSendLocalIdTrack.delete(p),this._sendStream.removeTrack(o),this._pc.addStream(this._sendStream);const r=await this._pc.createOffer();R.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(c){if(this._sendStream.getTracks().length===0){R.warn("stopSending() | ignoring expected error due no sending tracks: %s",c.toString());return}throw c}if(this._pc.signalingState==="stable")return;const i={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async pauseSending(p){}async resumeSending(p){}async replaceTrack(p,o){throw new s.UnsupportedError("not implemented")}async setMaxSpatialLayer(p,o){throw new s.UnsupportedError(" not implemented")}async setRtpEncodingParameters(p,o){throw new s.UnsupportedError("not supported")}async getSenderStats(p){throw new s.UnsupportedError("not implemented")}async sendDataChannel({ordered:p,maxPacketLifeTime:o,maxRetransmits:r,label:i,protocol:c}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:p,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:r,protocol:c};R.debug("sendDataChannel() [options:%o]",a);const d=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%l.MIS,!this._hasDataChannelMediaSection){const f=await this._pc.createOffer(),g=n.parse(f.sdp),T=g.media.find(P=>P.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:g}),R.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f),this._remoteSdp.sendSctpAssociation({offerMediaObject:T});const h={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}const u={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:d,sctpStreamParameters:u}}async receive(p){this.assertRecvDirection();const o=[];for(const a of p){const{trackId:d,kind:u,rtpParameters:f,streamId:g}=a;R.debug("receive() [trackId:%s, kind:%s]",d,u);const T=u;this._remoteSdp.receive({mid:T,kind:u,offerRtpParameters:f,streamId:g??f.rtcp.cname,trackId:d})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let i=await this._pc.createAnswer();const c=n.parse(i.sdp);for(const a of p){const{kind:d,rtpParameters:u}=a,f=d,g=c.media.find(T=>String(T.mid)===f);m.applyCodecParameters({offerRtpParameters:u,answerMediaObject:g})}i={type:"answer",sdp:n.write(c)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),R.debug("receive() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const a of p){const{kind:d,trackId:u,rtpParameters:f}=a,g=d,T=u,h=a.streamId??f.rtcp.cname,k=this._pc.getRemoteStreams().find(M=>M.id===h).getTrackById(T);if(!k)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(T,{mid:g,rtpParameters:f}),o.push({localId:T,track:k})}return o}async stopReceiving(p){this.assertRecvDirection();for(const i of p){R.debug("stopReceiving() [localId:%s]",i);const{mid:c,rtpParameters:a}=this._mapRecvLocalIdInfo.get(i)??{};this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:c,offerRtpParameters:a})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);const r=await this._pc.createAnswer();R.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async pauseReceiving(p){}async resumeReceiving(p){}async getReceiverStats(p){throw new s.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:p,label:o,protocol:r}){this.assertRecvDirection();const{streamId:i,ordered:c,maxPacketLifeTime:a,maxRetransmits:d}=p,u={negotiated:!0,id:i,ordered:c,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:d,protocol:r};R.debug("receiveDataChannel() [options:%o]",u);const f=this._pc.createDataChannel(o,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const g={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);const T=await this._pc.createAnswer();if(!this._transportReady){const h=n.parse(T.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h})}R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setLocalDescription(T),this._hasDataChannelMediaSection=!0}return{dataChannel:f}}async setupTransport({localDtlsRole:p,localSdpObject:o}){o||(o=n.parse(this._pc.localDescription.sdp));const r=m.extractDtlsParameters({sdpObject:o});r.role=p,this._remoteSdp.updateDtlsRole(p==="client"?"server":"client"),await new Promise((i,c)=>{this.safeEmit("@connect",{dtlsParameters:r},i,c)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Ct.Chrome55=b,Ct}var Tt={},Mi;function xo(){if(Mi)return Tt;Mi=1,Object.defineProperty(Tt,"__esModule",{value:!0}),Tt.Firefox120=void 0;const n=ae(),e=Q(),s=te(),t=X(),_=re(),m=me(),w=qe(),y=oe(),C=ge(),R=Le(),v=new e.Logger("Firefox120"),l="Firefox120",b={OS:16,MIS:2048};let S=class Hn extends y.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Hn}constructor(){super()}get name(){return l}close(){if(v.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){v.debug("getNativeRtpCapabilities()");const o=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),r=document.createElement("canvas");r.getContext("2d");const c=r.captureStream().getVideoTracks()[0];try{o.addTransceiver("audio",{direction:"sendrecv"}),o.addTransceiver(c,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const a=await o.createOffer();try{r.remove()}catch{}try{c.stop()}catch{}try{o.close()}catch{}const d=n.parse(a.sdp);return m.extractRtpCapabilities({sdpObject:d})}catch(a){try{r.remove()}catch{}try{c.stop()}catch{}try{o.close()}catch{}throw a}}async getNativeSctpCapabilities(){return v.debug("getNativeSctpCapabilities()"),{numStreams:b}}run({direction:o,iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:a,iceServers:d,iceTransportPolicy:u,additionalSettings:f,proprietaryConstraints:g,extendedRtpCapabilities:T}){this.assertNotClosed(),v.debug("run()"),this._direction=o,this._remoteSdp=new C.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:a}),this._sendingRtpParametersByKind={audio:_.getSendingRtpParameters("audio",T),video:_.getSendingRtpParameters("video",T)},this._sendingRemoteRtpParametersByKind={audio:_.getSendingRemoteRtpParameters("audio",T),video:_.getSendingRemoteRtpParameters("video",T)},this._pc=new RTCPeerConnection({iceServers:d??[],iceTransportPolicy:u??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...f},g),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",h=>{this.emit("@icecandidateerror",h)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(v.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(o){throw this.assertNotClosed(),new s.UnsupportedError("not supported")}async restartIce(o){if(this.assertNotClosed(),v.debug("restartIce()"),this._remoteSdp.updateIceParameters(o),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});v.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();v.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:o,encodings:r,codecOptions:i,codec:c,onRtpSender:a}){this.assertNotClosed(),this.assertSendDirection(),v.debug("send() [kind:%s, track.id:%s]",o.kind,o.id),r&&r.length>1&&r.forEach((D,I)=>{D.rid=`r${I}`});const d=t.clone(this._sendingRtpParametersByKind[o.kind]);d.codecs=_.reduceCodecs(d.codecs,c);const u=t.clone(this._sendingRemoteRtpParametersByKind[o.kind]);u.codecs=_.reduceCodecs(u.codecs,c);const f=this._pc.addTransceiver(o,{direction:"sendonly",streams:[this._sendStream],sendEncodings:r});a&&a(f.sender);const g=await this._pc.createOffer();let T=n.parse(g.sdp);T.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:T});const h=(0,R.parse)((r??[{}])[0].scalabilityMode);v.debug("send() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g);const P=f.mid;d.mid=P,T=n.parse(this._pc.localDescription.sdp);const k=T.media[T.media.length-1];if(d.rtcp.cname=m.getCname({offerMediaObject:k}),!r)d.encodings=w.getRtpEncodings({offerMediaObject:k});else if(r.length===1){const D=w.getRtpEncodings({offerMediaObject:k});Object.assign(D[0],r[0]),d.encodings=D}else d.encodings=r;if(d.encodings.length>1&&(d.codecs[0].mimeType.toLowerCase()==="video/vp8"||d.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const D of d.encodings)D.scalabilityMode?D.scalabilityMode=`L1T${h.temporalLayers}`:D.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:k,offerRtpParameters:d,answerRtpParameters:u,codecOptions:i});const M={type:"answer",sdp:this._remoteSdp.getSdp()};return v.debug("send() | calling pc.setRemoteDescription() [answer:%o]",M),await this._pc.setRemoteDescription(M),this._mapMidTransceiver.set(P,f),{localId:P,rtpParameters:d,rtpSender:f.sender}}async stopSending(o){if(this.assertSendDirection(),v.debug("stopSending() [localId:%s]",o),this._closed)return;const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated transceiver not found");r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.disableMediaSection(r.mid);const i=await this._pc.createOffer();v.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),this._mapMidTransceiver.delete(o)}async pauseSending(o){this.assertNotClosed(),this.assertSendDirection(),v.debug("pauseSending() [localId:%s]",o);const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(o);const i=await this._pc.createOffer();v.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async resumeSending(o){this.assertNotClosed(),this.assertSendDirection(),v.debug("resumeSending() [localId:%s]",o);const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(o);const i=await this._pc.createOffer();v.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async replaceTrack(o,r){this.assertNotClosed(),this.assertSendDirection(),r?v.debug("replaceTrack() [localId:%s, track.id:%s]",o,r.id):v.debug("replaceTrack() [localId:%s, no track]",o);const i=this._mapMidTransceiver.get(o);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(r)}async setMaxSpatialLayer(o,r){this.assertNotClosed(),this.assertSendDirection(),v.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",o,r);const i=this._mapMidTransceiver.get(o);if(!i)throw new Error("associated transceiver not found");const c=i.sender.getParameters();c.encodings.forEach((u,f)=>{f<=r?u.active=!0:u.active=!1}),await i.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(o,c.encodings);const a=await this._pc.createOffer();v.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async setRtpEncodingParameters(o,r){this.assertNotClosed(),this.assertSendDirection(),v.debug("setRtpEncodingParameters() [localId:%s, params:%o]",o,r);const i=this._mapMidTransceiver.get(o);if(!i)throw new Error("associated RTCRtpTransceiver not found");const c=i.sender.getParameters();c.encodings.forEach((u,f)=>{c.encodings[f]={...u,...r}}),await i.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(o,c.encodings);const a=await this._pc.createOffer();v.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async getSenderStats(o){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:o,maxPacketLifeTime:r,maxRetransmits:i,label:c,protocol:a}){this.assertNotClosed(),this.assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:o,maxPacketLifeTime:r,maxRetransmits:i,protocol:a};v.debug("sendDataChannel() [options:%o]",d);const u=this._pc.createDataChannel(c,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%b.MIS,!this._hasDataChannelMediaSection){const g=await this._pc.createOffer(),T=n.parse(g.sdp),h=T.media.find(k=>k.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:T}),v.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g),this._remoteSdp.sendSctpAssociation({offerMediaObject:h});const P={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P),this._hasDataChannelMediaSection=!0}const f={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits};return{dataChannel:u,sctpStreamParameters:f}}async receive(o){this.assertNotClosed(),this.assertRecvDirection();const r=[],i=new Map;for(const u of o){const{trackId:f,kind:g,rtpParameters:T,streamId:h}=u;v.debug("receive() [trackId:%s, kind:%s]",f,g);const P=T.mid??String(this._mapMidTransceiver.size);i.set(f,P),this._remoteSdp.receive({mid:P,kind:g,offerRtpParameters:T,streamId:h??T.rtcp.cname,trackId:f})}const c={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);for(const u of o){const{trackId:f,onRtpReceiver:g}=u;if(g){const T=i.get(f),h=this._pc.getTransceivers().find(P=>P.mid===T);if(!h)throw new Error("transceiver not found");g(h.receiver)}}let a=await this._pc.createAnswer();const d=n.parse(a.sdp);for(const u of o){const{trackId:f,rtpParameters:g}=u,T=i.get(f),h=d.media.find(P=>String(P.mid)===T);m.applyCodecParameters({offerRtpParameters:g,answerMediaObject:h}),a={type:"answer",sdp:n.write(d)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:d}),v.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const u of o){const{trackId:f}=u,g=i.get(f),T=this._pc.getTransceivers().find(h=>h.mid===g);if(!T)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(g,T),r.push({localId:g,track:T.receiver.track,rtpReceiver:T.receiver})}return r}async stopReceiving(o){if(this.assertRecvDirection(),this._closed)return;for(const c of o){v.debug("stopReceiving() [localId:%s]",c);const a=this._mapMidTransceiver.get(c);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();v.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const c of o)this._mapMidTransceiver.delete(c)}async pauseReceiving(o){this.assertNotClosed(),this.assertRecvDirection();for(const c of o){v.debug("pauseReceiving() [localId:%s]",c);const a=this._mapMidTransceiver.get(c);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(c)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();v.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(o){this.assertNotClosed(),this.assertRecvDirection();for(const c of o){v.debug("resumeReceiving() [localId:%s]",c);const a=this._mapMidTransceiver.get(c);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();v.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(o){this.assertRecvDirection();const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:o,label:r,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:c,ordered:a,maxPacketLifeTime:d,maxRetransmits:u}=o,f={negotiated:!0,id:c,ordered:a,maxPacketLifeTime:d,maxRetransmits:u,protocol:i};v.debug("receiveDataChannel() [options:%o]",f);const g=this._pc.createDataChannel(r,f);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const T={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",T),await this._pc.setRemoteDescription(T);const h=await this._pc.createAnswer();if(!this._transportReady){const P=n.parse(h.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:P})}v.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setLocalDescription(h),this._hasDataChannelMediaSection=!0}return{dataChannel:g}}async setupTransport({localDtlsRole:o,localSdpObject:r}){r||(r=n.parse(this._pc.localDescription.sdp));const i=m.extractDtlsParameters({sdpObject:r});i.role=o,this._remoteSdp.updateDtlsRole(o==="client"?"server":"client"),await new Promise((c,a)=>{this.safeEmit("@connect",{dtlsParameters:i},c,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new s.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Tt.Firefox120=S,Tt}var Dt={},Oi;function Lo(){if(Oi)return Dt;Oi=1,Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.Firefox60=void 0;const n=ae(),e=Q(),s=te(),t=X(),_=re(),m=me(),w=qe(),y=oe(),C=ge(),R=Le(),v=new e.Logger("Firefox60"),l="Firefox60",b={OS:16,MIS:2048};let S=class Kn extends y.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Kn}constructor(){super()}get name(){return l}close(){if(v.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){v.debug("getNativeRtpCapabilities()");const o=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),r=document.createElement("canvas");r.getContext("2d");const c=r.captureStream().getVideoTracks()[0];try{o.addTransceiver("audio",{direction:"sendrecv"});const a=o.addTransceiver(c,{direction:"sendrecv"}),d=a.sender.getParameters(),u=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];d.encodings=u,await a.sender.setParameters(d);const f=await o.createOffer();try{r.remove()}catch{}try{c.stop()}catch{}try{o.close()}catch{}const g=n.parse(f.sdp);return m.extractRtpCapabilities({sdpObject:g})}catch(a){try{r.remove()}catch{}try{c.stop()}catch{}try{o.close()}catch{}throw a}}async getNativeSctpCapabilities(){return v.debug("getNativeSctpCapabilities()"),{numStreams:b}}run({direction:o,iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:a,iceServers:d,iceTransportPolicy:u,additionalSettings:f,proprietaryConstraints:g,extendedRtpCapabilities:T}){this.assertNotClosed(),v.debug("run()"),this._direction=o,this._remoteSdp=new C.RemoteSdp({iceParameters:r,iceCandidates:i,dtlsParameters:c,sctpParameters:a}),this._sendingRtpParametersByKind={audio:_.getSendingRtpParameters("audio",T),video:_.getSendingRtpParameters("video",T)},this._sendingRemoteRtpParametersByKind={audio:_.getSendingRemoteRtpParameters("audio",T),video:_.getSendingRemoteRtpParameters("video",T)},this._pc=new RTCPeerConnection({iceServers:d??[],iceTransportPolicy:u??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...f},g),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",h=>{this.emit("@icecandidateerror",h)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(v.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(o){throw this.assertNotClosed(),new s.UnsupportedError("not supported")}async restartIce(o){if(this.assertNotClosed(),v.debug("restartIce()"),this._remoteSdp.updateIceParameters(o),!!this._transportReady)if(this._direction==="send"){const r=await this._pc.createOffer({iceRestart:!0});v.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const i={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const r={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();v.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:o,encodings:r,codecOptions:i,codec:c}){this.assertNotClosed(),this.assertSendDirection(),v.debug("send() [kind:%s, track.id:%s]",o.kind,o.id),r&&(r=t.clone(r),r.forEach((M,D)=>{M.rid=`r${D}`}),r.reverse());const a=t.clone(this._sendingRtpParametersByKind[o.kind]);a.codecs=_.reduceCodecs(a.codecs,c);const d=t.clone(this._sendingRemoteRtpParametersByKind[o.kind]);d.codecs=_.reduceCodecs(d.codecs,c);const u=this._pc.addTransceiver(o,{direction:"sendonly",streams:[this._sendStream]});if(r){const M=u.sender.getParameters();M.encodings=r,await u.sender.setParameters(M)}const f=await this._pc.createOffer();let g=n.parse(f.sdp);g.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed(),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:g});const T=(0,R.parse)((r??[{}])[0].scalabilityMode);v.debug("send() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f);const h=u.mid;a.mid=h,g=n.parse(this._pc.localDescription.sdp);const P=g.media[g.media.length-1];if(a.rtcp.cname=m.getCname({offerMediaObject:P}),!r)a.encodings=w.getRtpEncodings({offerMediaObject:P});else if(r.length===1){const M=w.getRtpEncodings({offerMediaObject:P});Object.assign(M[0],r[0]),a.encodings=M}else a.encodings=r.reverse();if(a.encodings.length>1&&(a.codecs[0].mimeType.toLowerCase()==="video/vp8"||a.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const M of a.encodings)M.scalabilityMode?M.scalabilityMode=`L1T${T.temporalLayers}`:M.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:P,offerRtpParameters:a,answerRtpParameters:d,codecOptions:i});const k={type:"answer",sdp:this._remoteSdp.getSdp()};return v.debug("send() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),this._mapMidTransceiver.set(h,u),{localId:h,rtpParameters:a,rtpSender:u.sender}}async stopSending(o){if(this.assertSendDirection(),v.debug("stopSending() [localId:%s]",o),this._closed)return;const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated transceiver not found");r.sender.replaceTrack(null),this._pc.removeTrack(r.sender),this._remoteSdp.disableMediaSection(r.mid);const i=await this._pc.createOffer();v.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),this._mapMidTransceiver.delete(o)}async pauseSending(o){this.assertNotClosed(),this.assertSendDirection(),v.debug("pauseSending() [localId:%s]",o);const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="inactive",this._remoteSdp.pauseMediaSection(o);const i=await this._pc.createOffer();v.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async resumeSending(o){this.assertNotClosed(),this.assertSendDirection(),v.debug("resumeSending() [localId:%s]",o);const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated RTCRtpTransceiver not found");r.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(o);const i=await this._pc.createOffer();v.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}async replaceTrack(o,r){this.assertNotClosed(),this.assertSendDirection(),r?v.debug("replaceTrack() [localId:%s, track.id:%s]",o,r.id):v.debug("replaceTrack() [localId:%s, no track]",o);const i=this._mapMidTransceiver.get(o);if(!i)throw new Error("associated RTCRtpTransceiver not found");await i.sender.replaceTrack(r)}async setMaxSpatialLayer(o,r){this.assertNotClosed(),this.assertSendDirection(),v.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",o,r);const i=this._mapMidTransceiver.get(o);if(!i)throw new Error("associated transceiver not found");const c=i.sender.getParameters();r=c.encodings.length-1-r,c.encodings.forEach((u,f)=>{f>=r?u.active=!0:u.active=!1}),await i.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(o,c.encodings);const a=await this._pc.createOffer();v.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async setRtpEncodingParameters(o,r){this.assertNotClosed(),this.assertSendDirection(),v.debug("setRtpEncodingParameters() [localId:%s, params:%o]",o,r);const i=this._mapMidTransceiver.get(o);if(!i)throw new Error("associated RTCRtpTransceiver not found");const c=i.sender.getParameters();c.encodings.forEach((u,f)=>{c.encodings[f]={...u,...r}}),await i.sender.setParameters(c),this._remoteSdp.muxMediaSectionSimulcast(o,c.encodings);const a=await this._pc.createOffer();v.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d)}async getSenderStats(o){this.assertNotClosed(),this.assertSendDirection();const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.sender.getStats()}async sendDataChannel({ordered:o,maxPacketLifeTime:r,maxRetransmits:i,label:c,protocol:a}){this.assertNotClosed(),this.assertSendDirection();const d={negotiated:!0,id:this._nextSendSctpStreamId,ordered:o,maxPacketLifeTime:r,maxRetransmits:i,protocol:a};v.debug("sendDataChannel() [options:%o]",d);const u=this._pc.createDataChannel(c,d);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%b.MIS,!this._hasDataChannelMediaSection){const g=await this._pc.createOffer(),T=n.parse(g.sdp),h=T.media.find(k=>k.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:T}),v.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",g),await this._pc.setLocalDescription(g),this._remoteSdp.sendSctpAssociation({offerMediaObject:h});const P={type:"answer",sdp:this._remoteSdp.getSdp()};v.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P),this._hasDataChannelMediaSection=!0}const f={streamId:d.id,ordered:d.ordered,maxPacketLifeTime:d.maxPacketLifeTime,maxRetransmits:d.maxRetransmits};return{dataChannel:u,sctpStreamParameters:f}}async receive(o){this.assertNotClosed(),this.assertRecvDirection();const r=[],i=new Map;for(const u of o){const{trackId:f,kind:g,rtpParameters:T,streamId:h}=u;v.debug("receive() [trackId:%s, kind:%s]",f,g);const P=T.mid??String(this._mapMidTransceiver.size);i.set(f,P),this._remoteSdp.receive({mid:P,kind:g,offerRtpParameters:T,streamId:h??T.rtcp.cname,trackId:f})}const c={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let a=await this._pc.createAnswer();const d=n.parse(a.sdp);for(const u of o){const{trackId:f,rtpParameters:g}=u,T=i.get(f),h=d.media.find(P=>String(P.mid)===T);m.applyCodecParameters({offerRtpParameters:g,answerMediaObject:h}),a={type:"answer",sdp:n.write(d)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:d}),v.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const u of o){const{trackId:f}=u,g=i.get(f),T=this._pc.getTransceivers().find(h=>h.mid===g);if(!T)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(g,T),r.push({localId:g,track:T.receiver.track,rtpReceiver:T.receiver})}return r}async stopReceiving(o){if(this.assertRecvDirection(),this._closed)return;for(const c of o){v.debug("stopReceiving() [localId:%s]",c);const a=this._mapMidTransceiver.get(c);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();v.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i);for(const c of o)this._mapMidTransceiver.delete(c)}async pauseReceiving(o){this.assertNotClosed(),this.assertRecvDirection();for(const c of o){v.debug("pauseReceiving() [localId:%s]",c);const a=this._mapMidTransceiver.get(c);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(c)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();v.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async resumeReceiving(o){this.assertNotClosed(),this.assertRecvDirection();for(const c of o){v.debug("resumeReceiving() [localId:%s]",c);const a=this._mapMidTransceiver.get(c);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(c)}const r={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);const i=await this._pc.createAnswer();v.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(o){this.assertRecvDirection();const r=this._mapMidTransceiver.get(o);if(!r)throw new Error("associated RTCRtpTransceiver not found");return r.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:o,label:r,protocol:i}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:c,ordered:a,maxPacketLifeTime:d,maxRetransmits:u}=o,f={negotiated:!0,id:c,ordered:a,maxPacketLifeTime:d,maxRetransmits:u,protocol:i};v.debug("receiveDataChannel() [options:%o]",f);const g=this._pc.createDataChannel(r,f);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const T={type:"offer",sdp:this._remoteSdp.getSdp()};v.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",T),await this._pc.setRemoteDescription(T);const h=await this._pc.createAnswer();if(!this._transportReady){const P=n.parse(h.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:P})}v.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setLocalDescription(h),this._hasDataChannelMediaSection=!0}return{dataChannel:g}}async setupTransport({localDtlsRole:o,localSdpObject:r}){r||(r=n.parse(this._pc.localDescription.sdp));const i=m.extractDtlsParameters({sdpObject:r});i.role=o,this._remoteSdp.updateDtlsRole(o==="client"?"server":"client"),await new Promise((c,a)=>{this.safeEmit("@connect",{dtlsParameters:i},c,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new s.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Dt.Firefox60=S,Dt}var Pt={},Ai;function Io(){if(Ai)return Pt;Ai=1,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.Safari12=void 0;const n=ae(),e=Q(),s=X(),t=re(),_=me(),m=qe(),w=kr(),y=te(),C=oe(),R=ge(),v=Le(),l=new e.Logger("Safari12"),b="Safari12",S={OS:1024,MIS:1024};let p=class Gn extends C.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Gn}constructor(){super()}get name(){return b}close(){if(l.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{r.addTransceiver("audio"),r.addTransceiver("video");const i=await r.createOffer();try{r.close()}catch{}const c=n.parse(i.sdp),a=_.extractRtpCapabilities({sdpObject:c});return w.addNackSupportForOpus(a),a}catch(i){try{r.close()}catch{}throw i}}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:S}}run({direction:r,iceParameters:i,iceCandidates:c,dtlsParameters:a,sctpParameters:d,iceServers:u,iceTransportPolicy:f,additionalSettings:g,proprietaryConstraints:T,extendedRtpCapabilities:h}){this.assertNotClosed(),l.debug("run()"),this._direction=r,this._remoteSdp=new R.RemoteSdp({iceParameters:i,iceCandidates:c,dtlsParameters:a,sctpParameters:d}),this._sendingRtpParametersByKind={audio:t.getSendingRtpParameters("audio",h),video:t.getSendingRtpParameters("video",h)},this._sendingRemoteRtpParametersByKind={audio:t.getSendingRemoteRtpParameters("audio",h),video:t.getSendingRemoteRtpParameters("video",h)},a.role&&a.role!=="auto"&&(this._forcedLocalDtlsRole=a.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:u??[],iceTransportPolicy:f??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...g},T),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",P=>{this.emit("@icecandidateerror",P)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(l.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(r){this.assertNotClosed(),l.debug("updateIceServers()");const i=this._pc.getConfiguration();i.iceServers=r,this._pc.setConfiguration(i)}async restartIce(r){if(this.assertNotClosed(),l.debug("restartIce()"),this._remoteSdp.updateIceParameters(r),!!this._transportReady)if(this._direction==="send"){const i=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}else{const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:r,encodings:i,codecOptions:c,codec:a,onRtpSender:d}){this.assertNotClosed(),this.assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",r.kind,r.id);const u=s.clone(this._sendingRtpParametersByKind[r.kind]);u.codecs=t.reduceCodecs(u.codecs,a);const f=s.clone(this._sendingRemoteRtpParametersByKind[r.kind]);f.codecs=t.reduceCodecs(f.codecs,a);const g=this._remoteSdp.getNextMediaSectionIdx(),T=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream]});d&&d(T.sender);let h=await this._pc.createOffer(),P=n.parse(h.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let k;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P});const M=(0,v.parse)((i??[{}])[0].scalabilityMode);i&&i.length>1&&(l.debug("send() | enabling legacy simulcast"),P=n.parse(h.sdp),k=P.media[g.idx],m.addLegacySimulcast({offerMediaObject:k,numStreams:i.length}),h={type:"offer",sdp:n.write(P)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",h),await this._pc.setLocalDescription(h);const D=T.mid;if(u.mid=D,P=n.parse(this._pc.localDescription.sdp),k=P.media[g.idx],u.rtcp.cname=_.getCname({offerMediaObject:k}),u.encodings=m.getRtpEncodings({offerMediaObject:k}),i)for(let E=0;E<u.encodings.length;++E)i[E]&&Object.assign(u.encodings[E],i[E]);if(u.encodings.length>1&&(u.codecs[0].mimeType.toLowerCase()==="video/vp8"||u.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const E of u.encodings)E.scalabilityMode?E.scalabilityMode=`L1T${M.temporalLayers}`:E.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:k,reuseMid:g.reuseMid,offerRtpParameters:u,answerRtpParameters:f,codecOptions:c});const I={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",I),await this._pc.setRemoteDescription(I),this._mapMidTransceiver.set(D,T),{localId:D,rtpParameters:u,rtpSender:T.sender}}async stopSending(r){if(this.assertSendDirection(),this._closed)return;l.debug("stopSending() [localId:%s]",r);const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");if(i.sender.replaceTrack(null),this._pc.removeTrack(i.sender),this._remoteSdp.closeMediaSection(i.mid))try{i.stop()}catch{}const a=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d),this._mapMidTransceiver.delete(r)}async pauseSending(r){this.assertNotClosed(),this.assertSendDirection(),l.debug("pauseSending() [localId:%s]",r);const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="inactive",this._remoteSdp.pauseMediaSection(r);const c=await this._pc.createOffer();l.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async resumeSending(r){this.assertNotClosed(),this.assertSendDirection(),l.debug("resumeSending() [localId:%s]",r);const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(r);const c=await this._pc.createOffer();l.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(r,i){this.assertNotClosed(),this.assertSendDirection(),i?l.debug("replaceTrack() [localId:%s, track.id:%s]",r,i.id):l.debug("replaceTrack() [localId:%s, no track]",r);const c=this._mapMidTransceiver.get(r);if(!c)throw new Error("associated RTCRtpTransceiver not found");await c.sender.replaceTrack(i)}async setMaxSpatialLayer(r,i){this.assertNotClosed(),this.assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",r,i);const c=this._mapMidTransceiver.get(r);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((f,g)=>{g<=i?f.active=!0:f.active=!1}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(r,a.encodings);const d=await this._pc.createOffer();l.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const u={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}async setRtpEncodingParameters(r,i){this.assertNotClosed(),this.assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",r,i);const c=this._mapMidTransceiver.get(r);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((f,g)=>{a.encodings[g]={...f,...i}}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(r,a.encodings);const d=await this._pc.createOffer();l.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const u={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}async getSenderStats(r){this.assertNotClosed(),this.assertSendDirection();const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");return i.sender.getStats()}async sendDataChannel({ordered:r,maxPacketLifeTime:i,maxRetransmits:c,label:a,protocol:d}){this.assertNotClosed(),this.assertSendDirection();const u={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:i,maxRetransmits:c,protocol:d};l.debug("sendDataChannel() [options:%o]",u);const f=this._pc.createDataChannel(a,u);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%S.MIS,!this._hasDataChannelMediaSection){const T=await this._pc.createOffer(),h=n.parse(T.sdp),P=h.media.find(M=>M.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const k={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),this._hasDataChannelMediaSection=!0}const g={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits};return{dataChannel:f,sctpStreamParameters:g}}async receive(r){this.assertNotClosed(),this.assertRecvDirection();const i=[],c=new Map;for(const f of r){const{trackId:g,kind:T,rtpParameters:h,streamId:P}=f;l.debug("receive() [trackId:%s, kind:%s]",g,T);const k=h.mid??String(this._mapMidTransceiver.size);c.set(g,k),this._remoteSdp.receive({mid:k,kind:T,offerRtpParameters:h,streamId:P??h.rtcp.cname,trackId:g})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);for(const f of r){const{trackId:g,onRtpReceiver:T}=f;if(T){const h=c.get(g),P=this._pc.getTransceivers().find(k=>k.mid===h);if(!P)throw new Error("transceiver not found");T(P.receiver)}}let d=await this._pc.createAnswer();const u=n.parse(d.sdp);for(const f of r){const{trackId:g,rtpParameters:T}=f,h=c.get(g),P=u.media.find(k=>String(k.mid)===h);_.applyCodecParameters({offerRtpParameters:T,answerMediaObject:P})}d={type:"answer",sdp:n.write(u)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u}),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const f of r){const{trackId:g}=f,T=c.get(g),h=this._pc.getTransceivers().find(P=>P.mid===T);if(!h)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(T,h),i.push({localId:T,track:h.receiver.track,rtpReceiver:h.receiver})}return i}async stopReceiving(r){if(this.assertRecvDirection(),this._closed)return;for(const a of r){l.debug("stopReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(d.mid)}const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const a of r)this._mapMidTransceiver.delete(a)}async pauseReceiving(r){this.assertNotClosed(),this.assertRecvDirection();for(const a of r){l.debug("pauseReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="inactive",this._remoteSdp.pauseMediaSection(a)}const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async resumeReceiving(r){this.assertNotClosed(),this.assertRecvDirection();for(const a of r){l.debug("resumeReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(a)}const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async getReceiverStats(r){this.assertNotClosed(),this.assertRecvDirection();const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");return i.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:r,label:i,protocol:c}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:a,ordered:d,maxPacketLifeTime:u,maxRetransmits:f}=r,g={negotiated:!0,id:a,ordered:d,maxPacketLifeTime:u,maxRetransmits:f,protocol:c};l.debug("receiveDataChannel() [options:%o]",g);const T=this._pc.createDataChannel(i,g);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const h={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",h),await this._pc.setRemoteDescription(h);const P=await this._pc.createAnswer();if(!this._transportReady){const k=n.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:k})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:T}}async setupTransport({localDtlsRole:r,localSdpObject:i}){i||(i=n.parse(this._pc.localDescription.sdp));const c=_.extractDtlsParameters({sdpObject:i});c.role=r,this._remoteSdp.updateDtlsRole(r==="client"?"server":"client"),await new Promise((a,d)=>{this.safeEmit("@connect",{dtlsParameters:c},a,d)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new y.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Pt.Safari12=p,Pt}var kt={},Ni;function Mo(){if(Ni)return kt;Ni=1,Object.defineProperty(kt,"__esModule",{value:!0}),kt.Safari11=void 0;const n=ae(),e=Q(),s=X(),t=re(),_=me(),m=Er(),w=oe(),y=ge(),C=new e.Logger("Safari11"),R="Safari11",v={OS:1024,MIS:1024};let l=class Qn extends w.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_sendStream=new MediaStream;_mapSendLocalIdRtpSender=new Map;_nextSendLocalId=0;_mapRecvLocalIdInfo=new Map;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Qn}constructor(){super()}get name(){return R}close(){if(C.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){C.debug("getNativeRtpCapabilities()");const S=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const p=await S.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{S.close()}catch{}const o=n.parse(p.sdp);return _.extractRtpCapabilities({sdpObject:o})}catch(p){try{S.close()}catch{}throw p}}async getNativeSctpCapabilities(){return C.debug("getNativeSctpCapabilities()"),{numStreams:v}}run({direction:S,iceParameters:p,iceCandidates:o,dtlsParameters:r,sctpParameters:i,iceServers:c,iceTransportPolicy:a,additionalSettings:d,proprietaryConstraints:u,extendedRtpCapabilities:f}){C.debug("run()"),this._direction=S,this._remoteSdp=new y.RemoteSdp({iceParameters:p,iceCandidates:o,dtlsParameters:r,sctpParameters:i,planB:!0}),this._sendingRtpParametersByKind={audio:t.getSendingRtpParameters("audio",f),video:t.getSendingRtpParameters("video",f)},this._sendingRemoteRtpParametersByKind={audio:t.getSendingRemoteRtpParameters("audio",f),video:t.getSendingRemoteRtpParameters("video",f)},r.role&&r.role!=="auto"&&(this._forcedLocalDtlsRole=r.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:c??[],iceTransportPolicy:a??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...d},u),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",g=>{this.emit("@icecandidateerror",g)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(S){C.debug("updateIceServers()");const p=this._pc.getConfiguration();p.iceServers=S,this._pc.setConfiguration(p)}async restartIce(S){if(C.debug("restartIce()"),this._remoteSdp.updateIceParameters(S),!!this._transportReady)if(this._direction==="send"){const p=await this._pc.createOffer({iceRestart:!0});C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",p),await this._pc.setLocalDescription(p);const o={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o)}else{const p={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);const o=await this._pc.createAnswer();C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o)}}async getTransportStats(){return this._pc.getStats()}async send({track:S,encodings:p,codecOptions:o,codec:r}){this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",S.kind,S.id),r&&C.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(S),this._pc.addTrack(S,this._sendStream);let i=await this._pc.createOffer(),c=n.parse(i.sdp);c.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let a;const d=s.clone(this._sendingRtpParametersByKind[S.kind]);d.codecs=t.reduceCodecs(d.codecs);const u=s.clone(this._sendingRemoteRtpParametersByKind[S.kind]);if(u.codecs=t.reduceCodecs(u.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:c}),S.kind==="video"&&p&&p.length>1&&(C.debug("send() | enabling simulcast"),c=n.parse(i.sdp),a=c.media.find(h=>h.type==="video"),m.addLegacySimulcast({offerMediaObject:a,track:S,numStreams:p.length}),i={type:"offer",sdp:n.write(c)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),c=n.parse(this._pc.localDescription.sdp),a=c.media.find(h=>h.type===S.kind),d.rtcp.cname=_.getCname({offerMediaObject:a}),d.encodings=m.getRtpEncodings({offerMediaObject:a,track:S}),p)for(let h=0;h<d.encodings.length;++h)p[h]&&Object.assign(d.encodings[h],p[h]);if(d.encodings.length>1&&d.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const h of d.encodings)h.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:a,offerRtpParameters:d,answerRtpParameters:u,codecOptions:o});const f={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",f),await this._pc.setRemoteDescription(f);const g=String(this._nextSendLocalId);this._nextSendLocalId++;const T=this._pc.getSenders().find(h=>h.track===S);return this._mapSendLocalIdRtpSender.set(g,T),{localId:g,rtpParameters:d,rtpSender:T}}async stopSending(S){this.assertSendDirection();const p=this._mapSendLocalIdRtpSender.get(S);if(!p)throw new Error("associated RTCRtpSender not found");p.track&&this._sendStream.removeTrack(p.track),this._mapSendLocalIdRtpSender.delete(S);const o=await this._pc.createOffer();C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",o);try{await this._pc.setLocalDescription(o)}catch(i){if(this._sendStream.getTracks().length===0){C.warn("stopSending() | ignoring expected error due no sending tracks: %s",i.toString());return}throw i}if(this._pc.signalingState==="stable")return;const r={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async pauseSending(S){}async resumeSending(S){}async replaceTrack(S,p){this.assertSendDirection(),p?C.debug("replaceTrack() [localId:%s, track.id:%s]",S,p.id):C.debug("replaceTrack() [localId:%s, no track]",S);const o=this._mapSendLocalIdRtpSender.get(S);if(!o)throw new Error("associated RTCRtpSender not found");const r=o.track;await o.replaceTrack(p),r&&this._sendStream.removeTrack(r),p&&this._sendStream.addTrack(p)}async setMaxSpatialLayer(S,p){this.assertSendDirection(),C.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",S,p);const o=this._mapSendLocalIdRtpSender.get(S);if(!o)throw new Error("associated RTCRtpSender not found");const r=o.getParameters();r.encodings.forEach((i,c)=>{c<=p?i.active=!0:i.active=!1}),await o.setParameters(r)}async setRtpEncodingParameters(S,p){this.assertSendDirection(),C.debug("setRtpEncodingParameters() [localId:%s, params:%o]",S,p);const o=this._mapSendLocalIdRtpSender.get(S);if(!o)throw new Error("associated RTCRtpSender not found");const r=o.getParameters();r.encodings.forEach((i,c)=>{r.encodings[c]={...i,...p}}),await o.setParameters(r)}async getSenderStats(S){this.assertSendDirection();const p=this._mapSendLocalIdRtpSender.get(S);if(!p)throw new Error("associated RTCRtpSender not found");return p.getStats()}async sendDataChannel({ordered:S,maxPacketLifeTime:p,maxRetransmits:o,label:r,protocol:i}){this.assertSendDirection();const c={negotiated:!0,id:this._nextSendSctpStreamId,ordered:S,maxPacketLifeTime:p,maxRetransmits:o,protocol:i};C.debug("sendDataChannel() [options:%o]",c);const a=this._pc.createDataChannel(r,c);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%v.MIS,!this._hasDataChannelMediaSection){const u=await this._pc.createOffer(),f=n.parse(u.sdp),g=f.media.find(h=>h.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:f}),C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",u),await this._pc.setLocalDescription(u),this._remoteSdp.sendSctpAssociation({offerMediaObject:g});const T={type:"answer",sdp:this._remoteSdp.getSdp()};C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setRemoteDescription(T),this._hasDataChannelMediaSection=!0}const d={streamId:c.id,ordered:c.ordered,maxPacketLifeTime:c.maxPacketLifeTime,maxRetransmits:c.maxRetransmits};return{dataChannel:a,sctpStreamParameters:d}}async receive(S){this.assertRecvDirection();const p=[];for(const c of S){const{trackId:a,kind:d,rtpParameters:u,streamId:f}=c;C.debug("receive() [trackId:%s, kind:%s]",a,d);const g=d;this._remoteSdp.receive({mid:g,kind:d,offerRtpParameters:u,streamId:f??u.rtcp.cname,trackId:a})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);let r=await this._pc.createAnswer();const i=n.parse(r.sdp);for(const c of S){const{kind:a,rtpParameters:d}=c,u=a,f=i.media.find(g=>String(g.mid)===u);_.applyCodecParameters({offerRtpParameters:d,answerMediaObject:f})}r={type:"answer",sdp:n.write(i)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:i}),C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const c of S){const{kind:a,trackId:d,rtpParameters:u}=c,f=a,g=d,T=this._pc.getReceivers().find(h=>h.track&&h.track.id===g);if(!T)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(g,{mid:f,rtpParameters:u,rtpReceiver:T}),p.push({localId:g,track:T.track,rtpReceiver:T})}return p}async stopReceiving(S){this.assertRecvDirection();for(const r of S){C.debug("stopReceiving() [localId:%s]",r);const{mid:i,rtpParameters:c}=this._mapRecvLocalIdInfo.get(r)??{};this._mapRecvLocalIdInfo.delete(r),this._remoteSdp.planBStopReceiving({mid:i,offerRtpParameters:c})}const p={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",p),await this._pc.setRemoteDescription(p);const o=await this._pc.createAnswer();C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",o),await this._pc.setLocalDescription(o)}async getReceiverStats(S){this.assertRecvDirection();const{rtpReceiver:p}=this._mapRecvLocalIdInfo.get(S)??{};if(!p)throw new Error("associated RTCRtpReceiver not found");return p.getStats()}async pauseReceiving(S){}async resumeReceiving(S){}async receiveDataChannel({sctpStreamParameters:S,label:p,protocol:o}){this.assertRecvDirection();const{streamId:r,ordered:i,maxPacketLifeTime:c,maxRetransmits:a}=S,d={negotiated:!0,id:r,ordered:i,maxPacketLifeTime:c,maxRetransmits:a,protocol:o};C.debug("receiveDataChannel() [options:%o]",d);const u=this._pc.createDataChannel(p,d);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const f={type:"offer",sdp:this._remoteSdp.getSdp()};C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",f),await this._pc.setRemoteDescription(f);const g=await this._pc.createAnswer();if(!this._transportReady){const T=n.parse(g.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:T})}C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setLocalDescription(g),this._hasDataChannelMediaSection=!0}return{dataChannel:u}}async setupTransport({localDtlsRole:S,localSdpObject:p}){p||(p=n.parse(this._pc.localDescription.sdp));const o=_.extractDtlsParameters({sdpObject:p});o.role=S,this._remoteSdp.updateDtlsRole(S==="client"?"server":"client"),await new Promise((r,i)=>{this.safeEmit("@connect",{dtlsParameters:o},r,i)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return kt.Safari11=l,kt}var Et={},xt={},ji;function Oo(){if(ji)return xt;ji=1,Object.defineProperty(xt,"__esModule",{value:!0}),xt.getCapabilities=e,xt.mangleRtpParameters=s;const n=X();function e(){const t=RTCRtpReceiver.getCapabilities(),_=n.clone(t);for(const m of _.codecs??[]){if(m.channels=m.numChannels,delete m.numChannels,m.mimeType=m.mimeType??`${m.kind}/${m.name}`,m.parameters){const w=m.parameters;w.apt&&(w.apt=Number(w.apt)),w["packetization-mode"]&&(w["packetization-mode"]=Number(w["packetization-mode"]))}for(const w of m.rtcpFeedback??[])w.parameter||(w.parameter="")}return _}function s(t){const _=n.clone(t);_.mid&&(_.muxId=_.mid,delete _.mid);for(const m of _.codecs)m.channels&&(m.numChannels=m.channels,delete m.channels),m.mimeType&&!m.name&&(m.name=m.mimeType.split("/")[1]),delete m.mimeType;return _}return xt}var Fi;function Ao(){if(Fi)return Et;Fi=1,Object.defineProperty(Et,"__esModule",{value:!0}),Et.Edge11=void 0;const n=Q(),e=te(),s=X(),t=re(),_=Oo(),m=oe(),w=new n.Logger("Edge11"),y="Edge11";let C=class Wn extends m.HandlerInterface{_sendingRtpParametersByKind;_remoteIceParameters;_remoteIceCandidates;_remoteDtlsParameters;_iceGatherer;_iceTransport;_dtlsTransport;_rtpSenders=new Map;_rtpReceivers=new Map;_nextSendLocalId=0;_cname;_transportReady=!1;static createFactory(){return()=>new Wn}constructor(){super()}get name(){return y}close(){w.debug("close()");try{this._iceGatherer.close()}catch{}try{this._iceTransport.stop()}catch{}try{this._dtlsTransport.stop()}catch{}for(const v of this._rtpSenders.values())try{v.stop()}catch{}for(const v of this._rtpReceivers.values())try{v.stop()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){return w.debug("getNativeRtpCapabilities()"),_.getCapabilities()}async getNativeSctpCapabilities(){return w.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:v,iceParameters:l,iceCandidates:b,dtlsParameters:S,sctpParameters:p,iceServers:o,iceTransportPolicy:r,additionalSettings:i,proprietaryConstraints:c,extendedRtpCapabilities:a}){w.debug("run()"),this._sendingRtpParametersByKind={audio:t.getSendingRtpParameters("audio",a),video:t.getSendingRtpParameters("video",a)},this._remoteIceParameters=l,this._remoteIceCandidates=b,this._remoteDtlsParameters=S,this._cname=`CNAME-${s.generateRandomNumber()}`,this.setIceGatherer({iceServers:o,iceTransportPolicy:r}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(v){throw new e.UnsupportedError("not supported")}async restartIce(v){if(w.debug("restartIce()"),this._remoteIceParameters=v,!!this._transportReady){w.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,v,"controlling");for(const l of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(l);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:v,encodings:l,codecOptions:b,codec:S}){w.debug("send() [kind:%s, track.id:%s]",v.kind,v.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),w.debug("send() | calling new RTCRtpSender()");const p=new RTCRtpSender(v,this._dtlsTransport),o=s.clone(this._sendingRtpParametersByKind[v.kind]);o.codecs=t.reduceCodecs(o.codecs,S);const r=o.codecs.some(a=>/.+\/rtx$/i.test(a.mimeType));l||(l=[{}]);for(const a of l)a.ssrc=s.generateRandomNumber(),r&&(a.rtx={ssrc:s.generateRandomNumber()});o.encodings=l,o.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const i=_.mangleRtpParameters(o);w.debug("send() | calling rtpSender.send() [params:%o]",i),await p.send(i);const c=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(c,p),{localId:c,rtpParameters:o,rtpSender:p}}async stopSending(v){w.debug("stopSending() [localId:%s]",v);const l=this._rtpSenders.get(v);if(!l)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(v);try{w.debug("stopSending() | calling rtpSender.stop()"),l.stop()}catch(b){throw w.warn("stopSending() | rtpSender.stop() failed:%o",b),b}}async pauseSending(v){}async resumeSending(v){}async replaceTrack(v,l){l?w.debug("replaceTrack() [localId:%s, track.id:%s]",v,l.id):w.debug("replaceTrack() [localId:%s, no track]",v);const b=this._rtpSenders.get(v);if(!b)throw new Error("RTCRtpSender not found");b.setTrack(l)}async setMaxSpatialLayer(v,l){w.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",v,l);const b=this._rtpSenders.get(v);if(!b)throw new Error("RTCRtpSender not found");const S=b.getParameters();S.encodings.forEach((p,o)=>{o<=l?p.active=!0:p.active=!1}),await b.setParameters(S)}async setRtpEncodingParameters(v,l){w.debug("setRtpEncodingParameters() [localId:%s, params:%o]",v,l);const b=this._rtpSenders.get(v);if(!b)throw new Error("RTCRtpSender not found");const S=b.getParameters();S.encodings.forEach((p,o)=>{S.encodings[o]={...p,...l}}),await b.setParameters(S)}async getSenderStats(v){const l=this._rtpSenders.get(v);if(!l)throw new Error("RTCRtpSender not found");return l.getStats()}async sendDataChannel(v){throw new e.UnsupportedError("not implemented")}async receive(v){const l=[];for(const b of v){const{trackId:S,kind:p}=b;w.debug("receive() [trackId:%s, kind:%s]",S,p)}this._transportReady||await this.setupTransport({localDtlsRole:"server"});for(const b of v){const{trackId:S,kind:p,rtpParameters:o}=b;w.debug("receive() | calling new RTCRtpReceiver()");const r=new RTCRtpReceiver(this._dtlsTransport,p);r.addEventListener("error",a=>{w.error('rtpReceiver "error" event [event:%o]',a)});const i=_.mangleRtpParameters(o);w.debug("receive() | calling rtpReceiver.receive() [params:%o]",i),await r.receive(i);const c=S;this._rtpReceivers.set(c,r),l.push({localId:c,track:r.track,rtpReceiver:r})}return l}async stopReceiving(v){for(const l of v){w.debug("stopReceiving() [localId:%s]",l);const b=this._rtpReceivers.get(l);if(!b)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(l);try{w.debug("stopReceiving() | calling rtpReceiver.stop()"),b.stop()}catch(S){w.warn("stopReceiving() | rtpReceiver.stop() failed:%o",S)}}}async pauseReceiving(v){}async resumeReceiving(v){}async getReceiverStats(v){const l=this._rtpReceivers.get(v);if(!l)throw new Error("RTCRtpReceiver not found");return l.getStats()}async receiveDataChannel(v){throw new e.UnsupportedError("not implemented")}setIceGatherer({iceServers:v,iceTransportPolicy:l}){const b=new RTCIceGatherer({iceServers:v??[],gatherPolicy:l??"all"});b.addEventListener("error",S=>{w.error('iceGatherer "error" event [event:%o]',S)});try{b.gather()}catch(S){w.debug("setIceGatherer() | iceGatherer.gather() failed: %s",S.toString())}this._iceGatherer=b}setIceTransport(){const v=new RTCIceTransport(this._iceGatherer);v.addEventListener("statechange",()=>{switch(v.state){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),v.addEventListener("icestatechange",()=>{switch(v.state){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}}),v.addEventListener("candidatepairchange",l=>{w.debug('iceTransport "candidatepairchange" event [pair:%o]',l.pair)}),this._iceTransport=v}setDtlsTransport(){const v=new RTCDtlsTransport(this._iceTransport);v.addEventListener("statechange",()=>{w.debug('dtlsTransport "statechange" event [state:%s]',v.state)}),v.addEventListener("dtlsstatechange",()=>{w.debug('dtlsTransport "dtlsstatechange" event [state:%s]',v.state),v.state==="closed"&&this.emit("@connectionstatechange","closed")}),v.addEventListener("error",l=>{w.error('dtlsTransport "error" event [event:%o]',l)}),this._dtlsTransport=v}async setupTransport({localDtlsRole:v}){w.debug("setupTransport()");const l=this._dtlsTransport.getLocalParameters();l.role=v,await new Promise((b,S)=>{this.safeEmit("@connect",{dtlsParameters:l},b,S)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const b of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(b);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(b=>b.algorithm==="sha-256"||b.algorithm==="sha-384"||b.algorithm==="sha-512"),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}};return Et.Edge11=C,Et}var Lt={},Bi;function No(){if(Bi)return Lt;Bi=1,Object.defineProperty(Lt,"__esModule",{value:!0}),Lt.ReactNativeUnifiedPlan=void 0;const n=ae(),e=Q(),s=X(),t=re(),_=me(),m=qe(),w=kr(),y=te(),C=oe(),R=ge(),v=Le(),l=new e.Logger("ReactNativeUnifiedPlan"),b="ReactNativeUnifiedPlan",S={OS:1024,MIS:1024};let p=class Yn extends C.HandlerInterface{_closed=!1;_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_mapMidTransceiver=new Map;_sendStream=new MediaStream;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Yn}constructor(){super()}get name(){return b}close(){if(l.debug("close()"),!this._closed){if(this._closed=!0,this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){l.debug("getNativeRtpCapabilities()");const r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{r.addTransceiver("audio"),r.addTransceiver("video");const i=await r.createOffer();try{r.close()}catch{}const c=n.parse(i.sdp),a=_.extractRtpCapabilities({sdpObject:c});return w.addNackSupportForOpus(a),a}catch(i){try{r.close()}catch{}throw i}}async getNativeSctpCapabilities(){return l.debug("getNativeSctpCapabilities()"),{numStreams:S}}run({direction:r,iceParameters:i,iceCandidates:c,dtlsParameters:a,sctpParameters:d,iceServers:u,iceTransportPolicy:f,additionalSettings:g,proprietaryConstraints:T,extendedRtpCapabilities:h}){this.assertNotClosed(),l.debug("run()"),this._direction=r,this._remoteSdp=new R.RemoteSdp({iceParameters:i,iceCandidates:c,dtlsParameters:a,sctpParameters:d}),this._sendingRtpParametersByKind={audio:t.getSendingRtpParameters("audio",h),video:t.getSendingRtpParameters("video",h)},this._sendingRemoteRtpParametersByKind={audio:t.getSendingRemoteRtpParameters("audio",h),video:t.getSendingRemoteRtpParameters("video",h)},a.role&&a.role!=="auto"&&(this._forcedLocalDtlsRole=a.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:u??[],iceTransportPolicy:f??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...g},T),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",P=>{this.emit("@icecandidateerror",P)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(l.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(r){this.assertNotClosed(),l.debug("updateIceServers()");const i=this._pc.getConfiguration();i.iceServers=r,this._pc.setConfiguration(i)}async restartIce(r){if(this.assertNotClosed(),l.debug("restartIce()"),this._remoteSdp.updateIceParameters(r),!!this._transportReady)if(this._direction==="send"){const i=await this._pc.createOffer({iceRestart:!0});l.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const c={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c)}else{const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:r,encodings:i,codecOptions:c,codec:a,onRtpSender:d}){this.assertNotClosed(),this.assertSendDirection(),l.debug("send() [kind:%s, track.id:%s]",r.kind,r.id),i&&i.length>1&&i.forEach((x,L)=>{x.rid=`r${L}`});const u=s.clone(this._sendingRtpParametersByKind[r.kind]);u.codecs=t.reduceCodecs(u.codecs,a);const f=s.clone(this._sendingRemoteRtpParametersByKind[r.kind]);f.codecs=t.reduceCodecs(f.codecs,a);const g=this._remoteSdp.getNextMediaSectionIdx(),T=this._pc.addTransceiver(r,{direction:"sendonly",streams:[this._sendStream],sendEncodings:i});d&&d(T.sender);let h=await this._pc.createOffer(),P=n.parse(h.sdp);P.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let k;this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P});let M=!1;const D=(0,v.parse)((i??[{}])[0].scalabilityMode);i&&i.length===1&&D.spatialLayers>1&&u.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(l.debug("send() | enabling legacy simulcast for VP9 SVC"),M=!0,P=n.parse(h.sdp),k=P.media[g.idx],m.addLegacySimulcast({offerMediaObject:k,numStreams:D.spatialLayers}),h={type:"offer",sdp:n.write(P)}),l.debug("send() | calling pc.setLocalDescription() [offer:%o]",h),await this._pc.setLocalDescription(h);let I=T.mid??void 0;if(I||l.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),u.mid=I,P=n.parse(this._pc.localDescription.sdp),k=P.media[g.idx],u.rtcp.cname=_.getCname({offerMediaObject:k}),!i)u.encodings=m.getRtpEncodings({offerMediaObject:k});else if(i.length===1){let x=m.getRtpEncodings({offerMediaObject:k});Object.assign(x[0],i[0]),M&&(x=[x[0]]),u.encodings=x}else u.encodings=i;if(u.encodings.length>1&&(u.codecs[0].mimeType.toLowerCase()==="video/vp8"||u.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const x of u.encodings)x.scalabilityMode?x.scalabilityMode=`L1T${D.temporalLayers}`:x.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:k,reuseMid:g.reuseMid,offerRtpParameters:u,answerRtpParameters:f,codecOptions:c});const E={type:"answer",sdp:this._remoteSdp.getSdp()};return l.debug("send() | calling pc.setRemoteDescription() [answer:%o]",E),await this._pc.setRemoteDescription(E),I||(I=T.mid,u.mid=I),this._mapMidTransceiver.set(I,T),{localId:I,rtpParameters:u,rtpSender:T.sender}}async stopSending(r){if(this.assertSendDirection(),this._closed)return;l.debug("stopSending() [localId:%s]",r);const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");if(i.sender.replaceTrack(null),this._pc.removeTrack(i.sender),this._remoteSdp.closeMediaSection(i.mid))try{i.stop()}catch{}const a=await this._pc.createOffer();l.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const d={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",d),await this._pc.setRemoteDescription(d),this._mapMidTransceiver.delete(r)}async pauseSending(r){this.assertNotClosed(),this.assertSendDirection(),l.debug("pauseSending() [localId:%s]",r);const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="inactive",this._remoteSdp.pauseMediaSection(r);const c=await this._pc.createOffer();l.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async resumeSending(r){this.assertNotClosed(),this.assertSendDirection(),l.debug("resumeSending() [localId:%s]",r);const i=this._mapMidTransceiver.get(r);if(this._remoteSdp.resumeSendingMediaSection(r),!i)throw new Error("associated RTCRtpTransceiver not found");i.direction="sendonly";const c=await this._pc.createOffer();l.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c);const a={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(r,i){this.assertNotClosed(),this.assertSendDirection(),i?l.debug("replaceTrack() [localId:%s, track.id:%s]",r,i.id):l.debug("replaceTrack() [localId:%s, no track]",r);const c=this._mapMidTransceiver.get(r);if(!c)throw new Error("associated RTCRtpTransceiver not found");await c.sender.replaceTrack(i)}async setMaxSpatialLayer(r,i){this.assertNotClosed(),this.assertSendDirection(),l.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",r,i);const c=this._mapMidTransceiver.get(r);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((f,g)=>{g<=i?f.active=!0:f.active=!1}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(r,a.encodings);const d=await this._pc.createOffer();l.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const u={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}async setRtpEncodingParameters(r,i){this.assertNotClosed(),this.assertSendDirection(),l.debug("setRtpEncodingParameters() [localId:%s, params:%o]",r,i);const c=this._mapMidTransceiver.get(r);if(!c)throw new Error("associated RTCRtpTransceiver not found");const a=c.sender.getParameters();a.encodings.forEach((f,g)=>{a.encodings[g]={...f,...i}}),await c.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(r,a.encodings);const d=await this._pc.createOffer();l.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",d),await this._pc.setLocalDescription(d);const u={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",u),await this._pc.setRemoteDescription(u)}async getSenderStats(r){this.assertNotClosed(),this.assertSendDirection();const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");return i.sender.getStats()}async sendDataChannel({ordered:r,maxPacketLifeTime:i,maxRetransmits:c,label:a,protocol:d}){this.assertNotClosed(),this.assertSendDirection();const u={negotiated:!0,id:this._nextSendSctpStreamId,ordered:r,maxPacketLifeTime:i,maxRetransmits:c,protocol:d};l.debug("sendDataChannel() [options:%o]",u);const f=this._pc.createDataChannel(a,u);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%S.MIS,!this._hasDataChannelMediaSection){const T=await this._pc.createOffer(),h=n.parse(T.sdp),P=h.media.find(M=>M.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h}),l.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",T),await this._pc.setLocalDescription(T),this._remoteSdp.sendSctpAssociation({offerMediaObject:P});const k={type:"answer",sdp:this._remoteSdp.getSdp()};l.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",k),await this._pc.setRemoteDescription(k),this._hasDataChannelMediaSection=!0}const g={streamId:u.id,ordered:u.ordered,maxPacketLifeTime:u.maxPacketLifeTime,maxRetransmits:u.maxRetransmits};return{dataChannel:f,sctpStreamParameters:g}}async receive(r){this.assertNotClosed(),this.assertRecvDirection();const i=[],c=new Map;for(const f of r){const{trackId:g,kind:T,rtpParameters:h,streamId:P}=f;l.debug("receive() [trackId:%s, kind:%s]",g,T);const k=h.mid??String(this._mapMidTransceiver.size);c.set(g,k),this._remoteSdp.receive({mid:k,kind:T,offerRtpParameters:h,streamId:P??h.rtcp.cname,trackId:g})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);for(const f of r){const{trackId:g,onRtpReceiver:T}=f;if(T){const h=c.get(g),P=this._pc.getTransceivers().find(k=>k.mid===h);if(!P)throw new Error("transceiver not found");T(P.receiver)}}let d=await this._pc.createAnswer();const u=n.parse(d.sdp);for(const f of r){const{trackId:g,rtpParameters:T}=f,h=c.get(g),P=u.media.find(k=>String(k.mid)===h);_.applyCodecParameters({offerRtpParameters:T,answerMediaObject:P})}d={type:"answer",sdp:n.write(u)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:u}),l.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const f of r){const{trackId:g}=f,T=c.get(g),h=this._pc.getTransceivers().find(P=>P.mid===T);if(h)this._mapMidTransceiver.set(T,h),i.push({localId:T,track:h.receiver.track,rtpReceiver:h.receiver});else throw new Error("new RTCRtpTransceiver not found")}return i}async stopReceiving(r){if(this.assertRecvDirection(),this._closed)return;for(const a of r){l.debug("stopReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(d.mid)}const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const a of r)this._mapMidTransceiver.delete(a)}async pauseReceiving(r){this.assertNotClosed(),this.assertRecvDirection();for(const a of r){l.debug("pauseReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="inactive",this._remoteSdp.pauseMediaSection(a)}const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async resumeReceiving(r){this.assertNotClosed(),this.assertRecvDirection();for(const a of r){l.debug("resumeReceiving() [localId:%s]",a);const d=this._mapMidTransceiver.get(a);if(!d)throw new Error("associated RTCRtpTransceiver not found");d.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(a)}const i={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const c=await this._pc.createAnswer();l.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c)}async getReceiverStats(r){this.assertNotClosed(),this.assertRecvDirection();const i=this._mapMidTransceiver.get(r);if(!i)throw new Error("associated RTCRtpTransceiver not found");return i.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:r,label:i,protocol:c}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:a,ordered:d,maxPacketLifeTime:u,maxRetransmits:f}=r,g={negotiated:!0,id:a,ordered:d,maxPacketLifeTime:u,maxRetransmits:f,protocol:c};l.debug("receiveDataChannel() [options:%o]",g);const T=this._pc.createDataChannel(i,g);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const h={type:"offer",sdp:this._remoteSdp.getSdp()};l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",h),await this._pc.setRemoteDescription(h);const P=await this._pc.createAnswer();if(!this._transportReady){const k=n.parse(P.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:k})}l.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setLocalDescription(P),this._hasDataChannelMediaSection=!0}return{dataChannel:T}}async setupTransport({localDtlsRole:r,localSdpObject:i}){i||(i=n.parse(this._pc.localDescription.sdp));const c=_.extractDtlsParameters({sdpObject:i});c.role=r,this._remoteSdp.updateDtlsRole(r==="client"?"server":"client"),await new Promise((a,d)=>{this.safeEmit("@connect",{dtlsParameters:c},a,d)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new y.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return Lt.ReactNativeUnifiedPlan=p,Lt}var It={},qi;function jo(){if(qi)return It;qi=1,Object.defineProperty(It,"__esModule",{value:!0}),It.ReactNative=void 0;const n=ae(),e=Q(),s=te(),t=X(),_=re(),m=me(),w=Er(),y=oe(),C=ge(),R=new e.Logger("ReactNative"),v="ReactNative",l={OS:1024,MIS:1024};let b=class Xn extends y.HandlerInterface{_direction;_remoteSdp;_sendingRtpParametersByKind;_sendingRemoteRtpParametersByKind;_forcedLocalDtlsRole;_pc;_sendStream=new MediaStream;_mapSendLocalIdTrack=new Map;_nextSendLocalId=0;_mapRecvLocalIdInfo=new Map;_hasDataChannelMediaSection=!1;_nextSendSctpStreamId=0;_transportReady=!1;static createFactory(){return()=>new Xn}constructor(){super()}get name(){return v}close(){if(R.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){R.debug("getNativeRtpCapabilities()");const p=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const o=await p.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{p.close()}catch{}const r=n.parse(o.sdp);return m.extractRtpCapabilities({sdpObject:r})}catch(o){try{p.close()}catch{}throw o}}async getNativeSctpCapabilities(){return R.debug("getNativeSctpCapabilities()"),{numStreams:l}}run({direction:p,iceParameters:o,iceCandidates:r,dtlsParameters:i,sctpParameters:c,iceServers:a,iceTransportPolicy:d,additionalSettings:u,proprietaryConstraints:f,extendedRtpCapabilities:g}){R.debug("run()"),this._direction=p,this._remoteSdp=new C.RemoteSdp({iceParameters:o,iceCandidates:r,dtlsParameters:i,sctpParameters:c,planB:!0}),this._sendingRtpParametersByKind={audio:_.getSendingRtpParameters("audio",g),video:_.getSendingRtpParameters("video",g)},this._sendingRemoteRtpParametersByKind={audio:_.getSendingRemoteRtpParameters("audio",g),video:_.getSendingRemoteRtpParameters("video",g)},i.role&&i.role!=="auto"&&(this._forcedLocalDtlsRole=i.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a??[],iceTransportPolicy:d??"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...u},f),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.addEventListener("icecandidateerror",T=>{this.emit("@icecandidateerror",T)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(R.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":{this.emit("@connectionstatechange","connecting");break}case"connected":case"completed":{this.emit("@connectionstatechange","connected");break}case"failed":{this.emit("@connectionstatechange","failed");break}case"disconnected":{this.emit("@connectionstatechange","disconnected");break}case"closed":{this.emit("@connectionstatechange","closed");break}}})}async updateIceServers(p){R.debug("updateIceServers()");const o=this._pc.getConfiguration();o.iceServers=p,this._pc.setConfiguration(o)}async restartIce(p){if(R.debug("restartIce()"),this._remoteSdp.updateIceParameters(p),!!this._transportReady)if(this._direction==="send"){const o=await this._pc.createOffer({iceRestart:!0});R.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",o),await this._pc.setLocalDescription(o);const r={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const o={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);const r=await this._pc.createAnswer();R.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this._pc.getStats()}async send({track:p,encodings:o,codecOptions:r,codec:i}){this.assertSendDirection(),R.debug("send() [kind:%s, track.id:%s]",p.kind,p.id),i&&R.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(p),this._pc.addStream(this._sendStream);let c=await this._pc.createOffer(),a=n.parse(c.sdp);a.extmapAllowMixed&&this._remoteSdp.setSessionExtmapAllowMixed();let d;const u=t.clone(this._sendingRtpParametersByKind[p.kind]);u.codecs=_.reduceCodecs(u.codecs);const f=t.clone(this._sendingRemoteRtpParametersByKind[p.kind]);if(f.codecs=_.reduceCodecs(f.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),p.kind==="video"&&o&&o.length>1&&(R.debug("send() | enabling simulcast"),a=n.parse(c.sdp),d=a.media.find(h=>h.type==="video"),w.addLegacySimulcast({offerMediaObject:d,track:p,numStreams:o.length}),c={type:"offer",sdp:n.write(a)}),R.debug("send() | calling pc.setLocalDescription() [offer:%o]",c),await this._pc.setLocalDescription(c),a=n.parse(this._pc.localDescription.sdp),d=a.media.find(h=>h.type===p.kind),u.rtcp.cname=m.getCname({offerMediaObject:d}),u.encodings=w.getRtpEncodings({offerMediaObject:d,track:p}),o)for(let h=0;h<u.encodings.length;++h)o[h]&&Object.assign(u.encodings[h],o[h]);if(u.encodings.length>1&&(u.codecs[0].mimeType.toLowerCase()==="video/vp8"||u.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const h of u.encodings)h.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:d,offerRtpParameters:u,answerRtpParameters:f,codecOptions:r});const g={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("send() | calling pc.setRemoteDescription() [answer:%o]",g),await this._pc.setRemoteDescription(g);const T=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(T,p),{localId:T,rtpParameters:u}}async stopSending(p){this.assertSendDirection(),R.debug("stopSending() [localId:%s]",p);const o=this._mapSendLocalIdTrack.get(p);if(!o)throw new Error("track not found");this._mapSendLocalIdTrack.delete(p),this._sendStream.removeTrack(o),this._pc.addStream(this._sendStream);const r=await this._pc.createOffer();R.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r);try{await this._pc.setLocalDescription(r)}catch(c){if(this._sendStream.getTracks().length===0){R.warn("stopSending() | ignoring expected error due no sending tracks: %s",c.toString());return}throw c}if(this._pc.signalingState==="stable")return;const i={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}async pauseSending(p){}async resumeSending(p){}async replaceTrack(p,o){throw new s.UnsupportedError("not implemented")}async setMaxSpatialLayer(p,o){throw new s.UnsupportedError("not implemented")}async setRtpEncodingParameters(p,o){throw new s.UnsupportedError("not implemented")}async getSenderStats(p){throw new s.UnsupportedError("not implemented")}async sendDataChannel({ordered:p,maxPacketLifeTime:o,maxRetransmits:r,label:i,protocol:c}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:p,maxPacketLifeTime:o,maxRetransmitTime:o,maxRetransmits:r,protocol:c};R.debug("sendDataChannel() [options:%o]",a);const d=this._pc.createDataChannel(i,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%l.MIS,!this._hasDataChannelMediaSection){const f=await this._pc.createOffer(),g=n.parse(f.sdp),T=g.media.find(P=>P.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:g}),R.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",f),await this._pc.setLocalDescription(f),this._remoteSdp.sendSctpAssociation({offerMediaObject:T});const h={type:"answer",sdp:this._remoteSdp.getSdp()};R.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",h),await this._pc.setRemoteDescription(h),this._hasDataChannelMediaSection=!0}const u={streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits};return{dataChannel:d,sctpStreamParameters:u}}async receive(p){this.assertRecvDirection();const o=[],r=new Map;for(const d of p){const{trackId:u,kind:f,rtpParameters:g}=d;R.debug("receive() [trackId:%s, kind:%s]",u,f);const T=f;let h=d.streamId??g.rtcp.cname;R.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),h+=`-hack-${t.generateRandomNumber()}`,r.set(u,h),this._remoteSdp.receive({mid:T,kind:f,offerRtpParameters:g,streamId:h,trackId:u})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let c=await this._pc.createAnswer();const a=n.parse(c.sdp);for(const d of p){const{kind:u,rtpParameters:f}=d,g=u,T=a.media.find(h=>String(h.mid)===g);m.applyCodecParameters({offerRtpParameters:f,answerMediaObject:T})}c={type:"answer",sdp:n.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),R.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const d of p){const{kind:u,trackId:f,rtpParameters:g}=d,T=f,h=u,P=r.get(f),M=this._pc.getRemoteStreams().find(D=>D.id===P).getTrackById(T);if(!M)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(T,{mid:h,rtpParameters:g}),o.push({localId:T,track:M})}return o}async stopReceiving(p){this.assertRecvDirection();for(const i of p){R.debug("stopReceiving() [localId:%s]",i);const{mid:c,rtpParameters:a}=this._mapRecvLocalIdInfo.get(i)??{};this._mapRecvLocalIdInfo.delete(i),this._remoteSdp.planBStopReceiving({mid:c,offerRtpParameters:a})}const o={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",o),await this._pc.setRemoteDescription(o);const r=await this._pc.createAnswer();R.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async pauseReceiving(p){}async resumeReceiving(p){}async getReceiverStats(p){throw new s.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:p,label:o,protocol:r}){this.assertRecvDirection();const{streamId:i,ordered:c,maxPacketLifeTime:a,maxRetransmits:d}=p,u={negotiated:!0,id:i,ordered:c,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:d,protocol:r};R.debug("receiveDataChannel() [options:%o]",u);const f=this._pc.createDataChannel(o,u);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const g={type:"offer",sdp:this._remoteSdp.getSdp()};R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",g),await this._pc.setRemoteDescription(g);const T=await this._pc.createAnswer();if(!this._transportReady){const h=n.parse(T.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:h})}R.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",T),await this._pc.setLocalDescription(T),this._hasDataChannelMediaSection=!0}return{dataChannel:f}}async setupTransport({localDtlsRole:p,localSdpObject:o}){o||(o=n.parse(this._pc.localDescription.sdp));const r=m.extractDtlsParameters({sdpObject:o});r.role=p,this._remoteSdp.updateDtlsRole(p==="client"?"server":"client"),await new Promise((i,c)=>{this.safeEmit("@connect",{dtlsParameters:r},i,c)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}};return It.ReactNative=b,It}var Ui;function Zn(){if(Ui)return Ae;Ui=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.Device=void 0,Ae.detectDeviceAsync=d,Ae.detectDevice=u;const n=mo(),e=Q(),s=xe(),t=te(),_=X(),m=re(),w=Bn(),y=To(),C=Do(),R=Po(),v=ko(),l=Eo(),b=xo(),S=Lo(),p=Io(),o=Mo(),r=Ao(),i=No(),c=jo(),a=new e.Logger("Device");async function d(T){a.debug("detectDeviceAsync() [userAgent:%s]",T),!T&&typeof navigator=="object"&&(T=navigator.userAgent);const h=await(0,n.UAParser)(T).withFeatureCheck();return g(h)}function u(T){a.debug("detectDevice() [userAgent:%s]",T),!T&&typeof navigator=="object"&&(T=navigator.userAgent);const h=(0,n.UAParser)(T);return g(h)}let f=class Jn{_handlerFactory;_handlerName;_loaded=!1;_extendedRtpCapabilities;_recvRtpCapabilities;_canProduceByKind;_sctpCapabilities;_observer=new s.EnhancedEventEmitter;static async factory({handlerName:h,handlerFactory:P}={}){if(a.debug("factory()"),h&&P)throw new TypeError("just one of handlerName or handlerInterface can be given");if(!h&&!P&&(h=await d(),!h))throw new t.UnsupportedError("device not supported");return new Jn({handlerName:h,handlerFactory:P})}constructor({handlerName:h,handlerFactory:P}={}){if(a.debug("constructor()"),h&&P)throw new TypeError("just one of handlerName or handlerInterface can be given");if(P)this._handlerFactory=P;else{if(h)a.debug("constructor() | handler given: %s",h);else if(h=u(),h)a.debug("constructor() | detected handler: %s",h);else throw new t.UnsupportedError("device not supported");switch(h){case"Chrome111":{this._handlerFactory=y.Chrome111.createFactory();break}case"Chrome74":{this._handlerFactory=C.Chrome74.createFactory();break}case"Chrome70":{this._handlerFactory=R.Chrome70.createFactory();break}case"Chrome67":{this._handlerFactory=v.Chrome67.createFactory();break}case"Chrome55":{this._handlerFactory=l.Chrome55.createFactory();break}case"Firefox120":{this._handlerFactory=b.Firefox120.createFactory();break}case"Firefox60":{this._handlerFactory=S.Firefox60.createFactory();break}case"Safari12":{this._handlerFactory=p.Safari12.createFactory();break}case"Safari11":{this._handlerFactory=o.Safari11.createFactory();break}case"Edge11":{this._handlerFactory=r.Edge11.createFactory();break}case"ReactNativeUnifiedPlan":{this._handlerFactory=i.ReactNativeUnifiedPlan.createFactory();break}case"ReactNative":{this._handlerFactory=c.ReactNative.createFactory();break}default:throw new TypeError(`unknown handlerName "${h}"`)}}const k=this._handlerFactory();this._handlerName=k.name,k.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new t.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new t.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:h,preferLocalCodecsOrder:P=!1}){a.debug("load() [routerRtpCapabilities:%o]",h);let k;try{if(this._loaded)throw new t.InvalidStateError("already loaded");const M=_.clone(h);m.validateRtpCapabilities(M),k=this._handlerFactory();const D=await k.getNativeRtpCapabilities();a.debug("load() | got native RTP capabilities:%o",D);const I=_.clone(D);m.validateRtpCapabilities(I),this._extendedRtpCapabilities=m.getExtendedRtpCapabilities(I,M,P),a.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=m.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=m.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=m.getRecvRtpCapabilities(this._extendedRtpCapabilities),m.validateRtpCapabilities(this._recvRtpCapabilities),a.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await k.getNativeSctpCapabilities(),a.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),m.validateSctpCapabilities(this._sctpCapabilities),a.debug("load() succeeded"),this._loaded=!0,k.close()}catch(M){throw k&&k.close(),M}}canProduce(h){if(this._loaded){if(h!=="audio"&&h!=="video")throw new TypeError(`invalid kind "${h}"`)}else throw new t.InvalidStateError("not loaded");return this._canProduceByKind[h]}createSendTransport({id:h,iceParameters:P,iceCandidates:k,dtlsParameters:M,sctpParameters:D,iceServers:I,iceTransportPolicy:E,additionalSettings:x,proprietaryConstraints:L,appData:F}){return a.debug("createSendTransport()"),this.createTransport({direction:"send",id:h,iceParameters:P,iceCandidates:k,dtlsParameters:M,sctpParameters:D,iceServers:I,iceTransportPolicy:E,additionalSettings:x,proprietaryConstraints:L,appData:F})}createRecvTransport({id:h,iceParameters:P,iceCandidates:k,dtlsParameters:M,sctpParameters:D,iceServers:I,iceTransportPolicy:E,additionalSettings:x,proprietaryConstraints:L,appData:F}){return a.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:h,iceParameters:P,iceCandidates:k,dtlsParameters:M,sctpParameters:D,iceServers:I,iceTransportPolicy:E,additionalSettings:x,proprietaryConstraints:L,appData:F})}createTransport({direction:h,id:P,iceParameters:k,iceCandidates:M,dtlsParameters:D,sctpParameters:I,iceServers:E,iceTransportPolicy:x,additionalSettings:L,proprietaryConstraints:F,appData:q}){if(this._loaded){if(typeof P!="string")throw new TypeError("missing id");if(typeof k!="object")throw new TypeError("missing iceParameters");if(Array.isArray(M)){if(typeof D!="object")throw new TypeError("missing dtlsParameters");if(I&&typeof I!="object")throw new TypeError("wrong sctpParameters");if(q&&typeof q!="object")throw new TypeError("if given, appData must be an object")}else throw new TypeError("missing iceCandidates")}else throw new t.InvalidStateError("not loaded");const V=new w.Transport({direction:h,id:P,iceParameters:k,iceCandidates:M,dtlsParameters:D,sctpParameters:I,iceServers:E,iceTransportPolicy:x,additionalSettings:L,proprietaryConstraints:F,appData:q,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",V),V}};Ae.Device=f;function g(T){if(typeof navigator=="object"&&navigator.product==="ReactNative"){if(a.debug("detectDeviceImpl() | React-Native detected"),typeof RTCPeerConnection>"u"){a.warn("detectDeviceImpl() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?");return}return typeof RTCRtpTransceiver<"u"?(a.debug("detectDeviceImpl() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(a.debug("detectDeviceImpl() | ReactNative PlanB handler chosen"),"ReactNative")}else{a.debug("detectDeviceImpl() | browser detected [userAgent:%s, parsed:%o]",T.ua,T);const h=T.browser,P=h.name?.toLowerCase(),k=parseInt(h.major??"0"),D=T.engine.name?.toLowerCase(),I=T.os,E=I.name?.toLowerCase(),x=parseFloat(I.version??"0"),F=T.device.model?.toLowerCase(),q=E==="ios"||F==="ipad",V=P&&["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(P),Y=P&&["firefox","mobile firefox","mobile focus"].includes(P),ce=P&&["safari","mobile safari"].includes(P),le=P&&["edge"].includes(P);if((V||le)&&!q&&k>=111)return"Chrome111";if(V&&!q&&k>=74||le&&!q&&k>=88)return"Chrome74";if(V&&!q&&k>=70)return"Chrome70";if(V&&!q&&k>=67)return"Chrome67";if(V&&!q&&k>=55)return"Chrome55";if(Y&&!q&&k>=120)return"Firefox120";if(Y&&!q&&k>=60)return"Firefox60";if(Y&&q&&x>=14.3)return"Safari12";if(ce&&k>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(ce&&k>=11)return"Safari11";if(le&&!q&&k>=11&&k<=18)return"Edge11";if(D==="webkit"&&q&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(D==="blink"){const ee=T.ua.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(ee){const _e=Number(ee[1]);return _e>=111?"Chrome111":_e>=74?"Chrome74":_e>=70?"Chrome70":_e>=67?"Chrome67":"Chrome55"}else return"Chrome111"}else{a.warn("detectDeviceImpl() | browser not supported [name:%s, version:%s]",P,k);return}}}return Ae}var ns={},$i;function Fo(){return $i||($i=1,Object.defineProperty(ns,"__esModule",{value:!0})),ns}var as={},zi;function Bo(){return zi||(zi=1,Object.defineProperty(as,"__esModule",{value:!0})),as}var Vi;function qo(){return Vi||(Vi=1,function(n){var e=Oe&&Oe.__createBinding||(Object.create?function(t,_,m,w){w===void 0&&(w=m);var y=Object.getOwnPropertyDescriptor(_,m);(!y||("get"in y?!_.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return _[m]}}),Object.defineProperty(t,w,y)}:function(t,_,m,w){w===void 0&&(w=m),t[w]=_[m]}),s=Oe&&Oe.__exportStar||function(t,_){for(var m in t)m!=="default"&&!Object.prototype.hasOwnProperty.call(_,m)&&e(_,t,m)};Object.defineProperty(n,"__esModule",{value:!0}),s(Zn(),n),s(Bn(),n),s(An(),n),s(Nn(),n),s(jn(),n),s(Fn(),n),s(Fo(),n),s(Bo(),n),s(oe(),n),s(te(),n)}(Oe)),Oe}var Mt={},Ot={},os={},sr={},Hi;function Uo(){return Hi||(Hi=1,Object.defineProperty(sr,"__esModule",{value:!0}),sr.default="ffffffff-ffff-ffff-ffff-ffffffffffff"),sr}var ir={},Ki;function $o(){return Ki||(Ki=1,Object.defineProperty(ir,"__esModule",{value:!0}),ir.default="00000000-0000-0000-0000-000000000000"),ir}var nr={},ar={},or={},Gi;function zo(){return Gi||(Gi=1,Object.defineProperty(or,"__esModule",{value:!0}),or.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i),or}var Qi;function xr(){if(Qi)return ar;Qi=1,Object.defineProperty(ar,"__esModule",{value:!0});const n=zo();function e(s){return typeof s=="string"&&n.default.test(s)}return ar.default=e,ar}var Wi;function Lr(){if(Wi)return nr;Wi=1,Object.defineProperty(nr,"__esModule",{value:!0});const n=xr();function e(s){if(!(0,n.default)(s))throw TypeError("Invalid UUID");let t;return Uint8Array.of((t=parseInt(s.slice(0,8),16))>>>24,t>>>16&255,t>>>8&255,t&255,(t=parseInt(s.slice(9,13),16))>>>8,t&255,(t=parseInt(s.slice(14,18),16))>>>8,t&255,(t=parseInt(s.slice(19,23),16))>>>8,t&255,(t=parseInt(s.slice(24,36),16))/1099511627776&255,t/4294967296&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255)}return nr.default=e,nr}var Ge={},Yi;function Ie(){if(Yi)return Ge;Yi=1,Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.unsafeStringify=void 0;const n=xr(),e=[];for(let _=0;_<256;++_)e.push((_+256).toString(16).slice(1));function s(_,m=0){return(e[_[m+0]]+e[_[m+1]]+e[_[m+2]]+e[_[m+3]]+"-"+e[_[m+4]]+e[_[m+5]]+"-"+e[_[m+6]]+e[_[m+7]]+"-"+e[_[m+8]]+e[_[m+9]]+"-"+e[_[m+10]]+e[_[m+11]]+e[_[m+12]]+e[_[m+13]]+e[_[m+14]]+e[_[m+15]]).toLowerCase()}Ge.unsafeStringify=s;function t(_,m=0){const w=s(_,m);if(!(0,n.default)(w))throw TypeError("Stringified UUID is invalid");return w}return Ge.default=t,Ge}var Qe={},cr={},Xi;function Rs(){if(Xi)return cr;Xi=1,Object.defineProperty(cr,"__esModule",{value:!0});let n;const e=new Uint8Array(16);function s(){if(!n){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(e)}return cr.default=s,cr}var Ji;function ea(){if(Ji)return Qe;Ji=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.updateV1State=void 0;const n=Rs(),e=Ie(),s={};function t(w,y,C){let R;const v=w?._v6??!1;if(w){const l=Object.keys(w);l.length===1&&l[0]==="_v6"&&(w=void 0)}if(w)R=m(w.random??w.rng?.()??(0,n.default)(),w.msecs,w.nsecs,w.clockseq,w.node,y,C);else{const l=Date.now(),b=(0,n.default)();_(s,l,b),R=m(b,s.msecs,s.nsecs,v?void 0:s.clockseq,v?void 0:s.node,y,C)}return y??(0,e.unsafeStringify)(R)}function _(w,y,C){return w.msecs??=-1/0,w.nsecs??=0,y===w.msecs?(w.nsecs++,w.nsecs>=1e4&&(w.node=void 0,w.nsecs=0)):y>w.msecs?w.nsecs=0:y<w.msecs&&(w.node=void 0),w.node||(w.node=C.slice(10,16),w.node[0]|=1,w.clockseq=(C[8]<<8|C[9])&16383),w.msecs=y,w}Qe.updateV1State=_;function m(w,y,C,R,v,l,b=0){if(w.length<16)throw new Error("Random bytes length must be >= 16");if(!l)l=new Uint8Array(16),b=0;else if(b<0||b+16>l.length)throw new RangeError(`UUID byte range ${b}:${b+15} is out of buffer bounds`);y??=Date.now(),C??=0,R??=(w[8]<<8|w[9])&16383,v??=w.slice(10,16),y+=122192928e5;const S=((y&268435455)*1e4+C)%4294967296;l[b++]=S>>>24&255,l[b++]=S>>>16&255,l[b++]=S>>>8&255,l[b++]=S&255;const p=y/4294967296*1e4&268435455;l[b++]=p>>>8&255,l[b++]=p&255,l[b++]=p>>>24&15|16,l[b++]=p>>>16&255,l[b++]=R>>>8|128,l[b++]=R&255;for(let o=0;o<6;++o)l[b++]=v[o];return l}return Qe.default=t,Qe}var dr={},Zi;function ta(){if(Zi)return dr;Zi=1,Object.defineProperty(dr,"__esModule",{value:!0});const n=Lr(),e=Ie();function s(_){const m=typeof _=="string"?(0,n.default)(_):_,w=t(m);return typeof _=="string"?(0,e.unsafeStringify)(w):w}dr.default=s;function t(_){return Uint8Array.of((_[6]&15)<<4|_[7]>>4&15,(_[7]&15)<<4|(_[4]&240)>>4,(_[4]&15)<<4|(_[5]&240)>>4,(_[5]&15)<<4|(_[0]&240)>>4,(_[0]&15)<<4|(_[1]&240)>>4,(_[1]&15)<<4|(_[2]&240)>>4,96|_[2]&15,_[3],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15])}return dr}var cs={},pr={},en;function Vo(){if(en)return pr;en=1,Object.defineProperty(pr,"__esModule",{value:!0});function n(b){const S=_(b),p=t(S,b.length*8);return e(p)}function e(b){const S=new Uint8Array(b.length*4);for(let p=0;p<b.length*4;p++)S[p]=b[p>>2]>>>p%4*8&255;return S}function s(b){return(b+64>>>9<<4)+14+1}function t(b,S){const p=new Uint32Array(s(S)).fill(0);p.set(b),p[S>>5]|=128<<S%32,p[p.length-1]=S,b=p;let o=1732584193,r=-271733879,i=-1732584194,c=271733878;for(let a=0;a<b.length;a+=16){const d=o,u=r,f=i,g=c;o=C(o,r,i,c,b[a],7,-680876936),c=C(c,o,r,i,b[a+1],12,-389564586),i=C(i,c,o,r,b[a+2],17,606105819),r=C(r,i,c,o,b[a+3],22,-1044525330),o=C(o,r,i,c,b[a+4],7,-176418897),c=C(c,o,r,i,b[a+5],12,1200080426),i=C(i,c,o,r,b[a+6],17,-1473231341),r=C(r,i,c,o,b[a+7],22,-45705983),o=C(o,r,i,c,b[a+8],7,1770035416),c=C(c,o,r,i,b[a+9],12,-1958414417),i=C(i,c,o,r,b[a+10],17,-42063),r=C(r,i,c,o,b[a+11],22,-1990404162),o=C(o,r,i,c,b[a+12],7,1804603682),c=C(c,o,r,i,b[a+13],12,-40341101),i=C(i,c,o,r,b[a+14],17,-1502002290),r=C(r,i,c,o,b[a+15],22,1236535329),o=R(o,r,i,c,b[a+1],5,-165796510),c=R(c,o,r,i,b[a+6],9,-1069501632),i=R(i,c,o,r,b[a+11],14,643717713),r=R(r,i,c,o,b[a],20,-373897302),o=R(o,r,i,c,b[a+5],5,-701558691),c=R(c,o,r,i,b[a+10],9,38016083),i=R(i,c,o,r,b[a+15],14,-660478335),r=R(r,i,c,o,b[a+4],20,-405537848),o=R(o,r,i,c,b[a+9],5,568446438),c=R(c,o,r,i,b[a+14],9,-1019803690),i=R(i,c,o,r,b[a+3],14,-187363961),r=R(r,i,c,o,b[a+8],20,1163531501),o=R(o,r,i,c,b[a+13],5,-1444681467),c=R(c,o,r,i,b[a+2],9,-51403784),i=R(i,c,o,r,b[a+7],14,1735328473),r=R(r,i,c,o,b[a+12],20,-1926607734),o=v(o,r,i,c,b[a+5],4,-378558),c=v(c,o,r,i,b[a+8],11,-2022574463),i=v(i,c,o,r,b[a+11],16,1839030562),r=v(r,i,c,o,b[a+14],23,-35309556),o=v(o,r,i,c,b[a+1],4,-1530992060),c=v(c,o,r,i,b[a+4],11,1272893353),i=v(i,c,o,r,b[a+7],16,-155497632),r=v(r,i,c,o,b[a+10],23,-1094730640),o=v(o,r,i,c,b[a+13],4,681279174),c=v(c,o,r,i,b[a],11,-358537222),i=v(i,c,o,r,b[a+3],16,-722521979),r=v(r,i,c,o,b[a+6],23,76029189),o=v(o,r,i,c,b[a+9],4,-640364487),c=v(c,o,r,i,b[a+12],11,-421815835),i=v(i,c,o,r,b[a+15],16,530742520),r=v(r,i,c,o,b[a+2],23,-995338651),o=l(o,r,i,c,b[a],6,-198630844),c=l(c,o,r,i,b[a+7],10,1126891415),i=l(i,c,o,r,b[a+14],15,-1416354905),r=l(r,i,c,o,b[a+5],21,-57434055),o=l(o,r,i,c,b[a+12],6,1700485571),c=l(c,o,r,i,b[a+3],10,-1894986606),i=l(i,c,o,r,b[a+10],15,-1051523),r=l(r,i,c,o,b[a+1],21,-2054922799),o=l(o,r,i,c,b[a+8],6,1873313359),c=l(c,o,r,i,b[a+15],10,-30611744),i=l(i,c,o,r,b[a+6],15,-1560198380),r=l(r,i,c,o,b[a+13],21,1309151649),o=l(o,r,i,c,b[a+4],6,-145523070),c=l(c,o,r,i,b[a+11],10,-1120210379),i=l(i,c,o,r,b[a+2],15,718787259),r=l(r,i,c,o,b[a+9],21,-343485551),o=m(o,d),r=m(r,u),i=m(i,f),c=m(c,g)}return Uint32Array.of(o,r,i,c)}function _(b){if(b.length===0)return new Uint32Array;const S=new Uint32Array(s(b.length*8)).fill(0);for(let p=0;p<b.length;p++)S[p>>2]|=(b[p]&255)<<p%4*8;return S}function m(b,S){const p=(b&65535)+(S&65535);return(b>>16)+(S>>16)+(p>>16)<<16|p&65535}function w(b,S){return b<<S|b>>>32-S}function y(b,S,p,o,r,i){return m(w(m(m(S,b),m(o,i)),r),p)}function C(b,S,p,o,r,i,c){return y(S&p|~S&o,b,S,r,i,c)}function R(b,S,p,o,r,i,c){return y(S&o|p&~o,b,S,r,i,c)}function v(b,S,p,o,r,i,c){return y(S^p^o,b,S,r,i,c)}function l(b,S,p,o,r,i,c){return y(p^(S|~o),b,S,r,i,c)}return pr.default=n,pr}var ve={},tn;function Sr(){if(tn)return ve;tn=1,Object.defineProperty(ve,"__esModule",{value:!0}),ve.URL=ve.DNS=ve.stringToBytes=void 0;const n=Lr(),e=Ie();function s(_){_=unescape(encodeURIComponent(_));const m=new Uint8Array(_.length);for(let w=0;w<_.length;++w)m[w]=_.charCodeAt(w);return m}ve.stringToBytes=s,ve.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",ve.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function t(_,m,w,y,C,R){const v=typeof w=="string"?s(w):w,l=typeof y=="string"?(0,n.default)(y):y;if(typeof y=="string"&&(y=(0,n.default)(y)),y?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let b=new Uint8Array(16+v.length);if(b.set(l),b.set(v,l.length),b=m(b),b[6]=b[6]&15|_,b[8]=b[8]&63|128,C){R=R||0;for(let S=0;S<16;++S)C[R+S]=b[S];return C}return(0,e.unsafeStringify)(b)}return ve.default=t,ve}var rn;function Ho(){return rn||(rn=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.URL=n.DNS=void 0;const e=Vo(),s=Sr();var t=Sr();Object.defineProperty(n,"DNS",{enumerable:!0,get:function(){return t.DNS}}),Object.defineProperty(n,"URL",{enumerable:!0,get:function(){return t.URL}});function _(m,w,y,C){return(0,s.default)(48,e.default,m,w,y,C)}_.DNS=s.DNS,_.URL=s.URL,n.default=_}(cs)),cs}var lr={},ur={},sn;function Ko(){if(sn)return ur;sn=1,Object.defineProperty(ur,"__esModule",{value:!0});const n=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);return ur.default={randomUUID:n},ur}var nn;function Go(){if(nn)return lr;nn=1,Object.defineProperty(lr,"__esModule",{value:!0});const n=Ko(),e=Rs(),s=Ie();function t(_,m,w){if(n.default.randomUUID&&!m&&!_)return n.default.randomUUID();_=_||{};const y=_.random??_.rng?.()??(0,e.default)();if(y.length<16)throw new Error("Random bytes length must be >= 16");if(y[6]=y[6]&15|64,y[8]=y[8]&63|128,m){if(w=w||0,w<0||w+16>m.length)throw new RangeError(`UUID byte range ${w}:${w+15} is out of buffer bounds`);for(let C=0;C<16;++C)m[w+C]=y[C];return m}return(0,s.unsafeStringify)(y)}return lr.default=t,lr}var ds={},hr={},an;function Qo(){if(an)return hr;an=1,Object.defineProperty(hr,"__esModule",{value:!0});function n(t,_,m,w){switch(t){case 0:return _&m^~_&w;case 1:return _^m^w;case 2:return _&m^_&w^m&w;case 3:return _^m^w}}function e(t,_){return t<<_|t>>>32-_}function s(t){const _=[1518500249,1859775393,2400959708,3395469782],m=[1732584193,4023233417,2562383102,271733878,3285377520],w=new Uint8Array(t.length+1);w.set(t),w[t.length]=128,t=w;const y=t.length/4+2,C=Math.ceil(y/16),R=new Array(C);for(let v=0;v<C;++v){const l=new Uint32Array(16);for(let b=0;b<16;++b)l[b]=t[v*64+b*4]<<24|t[v*64+b*4+1]<<16|t[v*64+b*4+2]<<8|t[v*64+b*4+3];R[v]=l}R[C-1][14]=(t.length-1)*8/Math.pow(2,32),R[C-1][14]=Math.floor(R[C-1][14]),R[C-1][15]=(t.length-1)*8&4294967295;for(let v=0;v<C;++v){const l=new Uint32Array(80);for(let i=0;i<16;++i)l[i]=R[v][i];for(let i=16;i<80;++i)l[i]=e(l[i-3]^l[i-8]^l[i-14]^l[i-16],1);let b=m[0],S=m[1],p=m[2],o=m[3],r=m[4];for(let i=0;i<80;++i){const c=Math.floor(i/20),a=e(b,5)+n(c,S,p,o)+r+_[c]+l[i]>>>0;r=o,o=p,p=e(S,30)>>>0,S=b,b=a}m[0]=m[0]+b>>>0,m[1]=m[1]+S>>>0,m[2]=m[2]+p>>>0,m[3]=m[3]+o>>>0,m[4]=m[4]+r>>>0}return Uint8Array.of(m[0]>>24,m[0]>>16,m[0]>>8,m[0],m[1]>>24,m[1]>>16,m[1]>>8,m[1],m[2]>>24,m[2]>>16,m[2]>>8,m[2],m[3]>>24,m[3]>>16,m[3]>>8,m[3],m[4]>>24,m[4]>>16,m[4]>>8,m[4])}return hr.default=s,hr}var on;function Wo(){return on||(on=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.URL=n.DNS=void 0;const e=Qo(),s=Sr();var t=Sr();Object.defineProperty(n,"DNS",{enumerable:!0,get:function(){return t.DNS}}),Object.defineProperty(n,"URL",{enumerable:!0,get:function(){return t.URL}});function _(m,w,y,C){return(0,s.default)(80,e.default,m,w,y,C)}_.DNS=s.DNS,_.URL=s.URL,n.default=_}(ds)),ds}var fr={},cn;function Yo(){if(cn)return fr;cn=1,Object.defineProperty(fr,"__esModule",{value:!0});const n=Ie(),e=ea(),s=ta();function t(_,m,w){_??={},w??=0;let y=(0,e.default)({..._,_v6:!0},new Uint8Array(16));if(y=(0,s.default)(y),m){for(let C=0;C<16;C++)m[w+C]=y[C];return m}return(0,n.unsafeStringify)(y)}return fr.default=t,fr}var mr={},dn;function Xo(){if(dn)return mr;dn=1,Object.defineProperty(mr,"__esModule",{value:!0});const n=Lr(),e=Ie();function s(_){const m=typeof _=="string"?(0,n.default)(_):_,w=t(m);return typeof _=="string"?(0,e.unsafeStringify)(w):w}mr.default=s;function t(_){return Uint8Array.of((_[3]&15)<<4|_[4]>>4&15,(_[4]&15)<<4|(_[5]&240)>>4,(_[5]&15)<<4|_[6]&15,_[7],(_[1]&15)<<4|(_[2]&240)>>4,(_[2]&15)<<4|(_[3]&240)>>4,16|(_[0]&240)>>4,(_[0]&15)<<4|(_[1]&240)>>4,_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15])}return mr}var We={},pn;function Jo(){if(pn)return We;pn=1,Object.defineProperty(We,"__esModule",{value:!0}),We.updateV7State=void 0;const n=Rs(),e=Ie(),s={};function t(w,y,C){let R;if(w)R=m(w.random??w.rng?.()??(0,n.default)(),w.msecs,w.seq,y,C);else{const v=Date.now(),l=(0,n.default)();_(s,v,l),R=m(l,s.msecs,s.seq,y,C)}return y??(0,e.unsafeStringify)(R)}function _(w,y,C){return w.msecs??=-1/0,w.seq??=0,y>w.msecs?(w.seq=C[6]<<23|C[7]<<16|C[8]<<8|C[9],w.msecs=y):(w.seq=w.seq+1|0,w.seq===0&&w.msecs++),w}We.updateV7State=_;function m(w,y,C,R,v=0){if(w.length<16)throw new Error("Random bytes length must be >= 16");if(!R)R=new Uint8Array(16),v=0;else if(v<0||v+16>R.length)throw new RangeError(`UUID byte range ${v}:${v+15} is out of buffer bounds`);return y??=Date.now(),C??=w[6]*127<<24|w[7]<<16|w[8]<<8|w[9],R[v++]=y/1099511627776&255,R[v++]=y/4294967296&255,R[v++]=y/16777216&255,R[v++]=y/65536&255,R[v++]=y/256&255,R[v++]=y&255,R[v++]=112|C>>>28&15,R[v++]=C>>>20&255,R[v++]=128|C>>>14&63,R[v++]=C>>>6&255,R[v++]=C<<2&255|w[10]&3,R[v++]=w[11],R[v++]=w[12],R[v++]=w[13],R[v++]=w[14],R[v++]=w[15],R}return We.default=t,We}var gr={},ln;function Zo(){if(ln)return gr;ln=1,Object.defineProperty(gr,"__esModule",{value:!0});const n=xr();function e(s){if(!(0,n.default)(s))throw TypeError("Invalid UUID");return parseInt(s.slice(14,15),16)}return gr.default=e,gr}var un;function ec(){return un||(un=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.version=n.validate=n.v7=n.v6ToV1=n.v6=n.v5=n.v4=n.v3=n.v1ToV6=n.v1=n.stringify=n.parse=n.NIL=n.MAX=void 0;var e=Uo();Object.defineProperty(n,"MAX",{enumerable:!0,get:function(){return e.default}});var s=$o();Object.defineProperty(n,"NIL",{enumerable:!0,get:function(){return s.default}});var t=Lr();Object.defineProperty(n,"parse",{enumerable:!0,get:function(){return t.default}});var _=Ie();Object.defineProperty(n,"stringify",{enumerable:!0,get:function(){return _.default}});var m=ea();Object.defineProperty(n,"v1",{enumerable:!0,get:function(){return m.default}});var w=ta();Object.defineProperty(n,"v1ToV6",{enumerable:!0,get:function(){return w.default}});var y=Ho();Object.defineProperty(n,"v3",{enumerable:!0,get:function(){return y.default}});var C=Go();Object.defineProperty(n,"v4",{enumerable:!0,get:function(){return C.default}});var R=Wo();Object.defineProperty(n,"v5",{enumerable:!0,get:function(){return R.default}});var v=Yo();Object.defineProperty(n,"v6",{enumerable:!0,get:function(){return v.default}});var l=Xo();Object.defineProperty(n,"v6ToV1",{enumerable:!0,get:function(){return l.default}});var b=Jo();Object.defineProperty(n,"v7",{enumerable:!0,get:function(){return b.default}});var S=xr();Object.defineProperty(n,"validate",{enumerable:!0,get:function(){return S.default}});var p=Zo();Object.defineProperty(n,"version",{enumerable:!0,get:function(){return p.default}})}(os)),os}var At={},hn;function tc(){if(hn)return At;hn=1,Object.defineProperty(At,"__esModule",{value:!0}),At.FakeEventTarget=void 0;let n=class{listeners={};addEventListener(s,t,_={}){t&&(this.listeners[s]??=[],this.listeners[s].push({callback:t,once:_.once===!0}))}removeEventListener(s,t){this.listeners[s]&&(this.listeners[s]=this.listeners[s].filter(_=>_.callback!==t))}dispatchEvent(s){if(!s||typeof s.type!="string")throw new Error("invalid event object");const t=this.listeners[s.type];if(!t)return!0;for(const _ of[...t]){try{_.callback.call(this,s)}catch(m){setTimeout(()=>{throw m},0)}_.once&&this.removeEventListener(s.type,_.callback)}return!s.defaultPrevented}};return At.FakeEventTarget=n,At}var _r={},fn;function rc(){if(fn)return _r;fn=1,Object.defineProperty(_r,"__esModule",{value:!0}),_r.clone=n;function n(e){if(e!==void 0)return Number.isNaN(e)?NaN:typeof structuredClone=="function"?structuredClone(e):JSON.parse(JSON.stringify(e))}return _r}var mn;function sc(){if(mn)return Ot;mn=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.FakeMediaStreamTrack=void 0;const n=ec(),e=tc(),s=rc();class t extends e.FakeEventTarget{#m;#l;#u;#e;#r;#t;#s;#h;#i;#f;#n;#a=null;#o=null;#c=null;#d=null;#p=null;constructor({kind:m,id:w,label:y,contentHint:C,enabled:R,muted:v,readyState:l,capabilities:b,constraints:S,settings:p,data:o}){super(),this.#m=w??(0,n.v4)(),this.#l=m,this.#u=y??"",this.#s=C??"",this.#r=R??!0,this.#t=v??!1,this.#e=l??"live",this.#h=b??{},this.#i=S??{},this.#f=p??{},this.#n=o??{}}get id(){return this.#m}get kind(){return this.#l}get label(){return this.#u}get contentHint(){return this.#s}set contentHint(m){this.#s=m}get enabled(){return this.#r}set enabled(m){const w=this.#r!==m;this.#r=m,w&&this.dispatchEvent(new Event("enabledchange"))}get muted(){return this.#t}get readyState(){return this.#e}get data(){return this.#n}set data(m){this.#n=m}get onmute(){return this.#a}set onmute(m){this.#a&&this.removeEventListener("mute",this.#a),this.#a=m,m&&this.addEventListener("mute",m)}get onunmute(){return this.#o}set onunmute(m){this.#o&&this.removeEventListener("unmute",this.#o),this.#o=m,m&&this.addEventListener("unmute",m)}get onended(){return this.#c}set onended(m){this.#c&&this.removeEventListener("ended",this.#c),this.#c=m,m&&this.addEventListener("ended",m)}get onenabledchange(){return this.#d}set onenabledchange(m){this.#d&&this.removeEventListener("enabledchange",this.#d),this.#d=m,m&&this.addEventListener("enabledchange",m)}get onstopped(){return this.#p}set onstopped(m){this.#p&&this.removeEventListener("stopped",this.#p),this.#p=m,m&&this.addEventListener("stopped",m)}addEventListener(m,w,y){super.addEventListener(m,w,y)}removeEventListener(m,w){super.removeEventListener(m,w)}stop(){this.#e!=="ended"&&(this.#e="ended",this.dispatchEvent(new Event("stopped")))}clone({id:m,data:w}={}){return new t({id:m??(0,n.v4)(),kind:this.#l,label:this.#u,contentHint:this.#s,enabled:this.#r,muted:this.#t,readyState:this.#e,capabilities:(0,s.clone)(this.#h),constraints:(0,s.clone)(this.#i),settings:(0,s.clone)(this.#f),data:w??(0,s.clone)(this.#n)})}getCapabilities(){return this.#h}getConstraints(){return this.#i}async applyConstraints(m={}){return this.#i=m,Promise.resolve()}getSettings(){return this.#f}remoteStop(){this.#e!=="ended"&&(this.#e="ended",this.dispatchEvent(new Event("stopped")),this.dispatchEvent(new Event("ended")))}remoteMute(){this.#t||(this.#t=!0,this.dispatchEvent(new Event("mute")))}remoteUnmute(){this.#t&&(this.#t=!1,this.dispatchEvent(new Event("unmute")))}}return Ot.FakeMediaStreamTrack=t,Ot}var gn;function ic(){if(gn)return Mt;gn=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.FakeHandler=void 0;const n=sc(),e=xe(),s=Q(),t=X(),_=re(),m=te(),w=oe(),y=new s.Logger("FakeHandler"),C="FakeHandler";class R extends e.EnhancedEventEmitter{id;ordered;maxPacketLifeTime;maxRetransmits;label;protocol;constructor({id:b,ordered:S,maxPacketLifeTime:p,maxRetransmits:o,label:r,protocol:i}){super(),this.id=b,this.ordered=S,this.maxPacketLifeTime=p,this.maxRetransmits=o,this.label=r,this.protocol=i}close(){this.safeEmit("close"),this.emit("@close")}send(b){this.safeEmit("message",b)}addEventListener(b,S){this.on(b,S)}}let v=class ra extends w.HandlerInterface{_closed=!1;fakeParameters;_rtpParametersByKind;_cname=`CNAME-${t.generateRandomNumber()}`;_transportReady=!1;_nextLocalId=1;_tracks=new Map;_nextSctpStreamId=0;static createFactory(b){return()=>new ra(b)}constructor(b){super(),this.fakeParameters=b}get name(){return C}close(){y.debug("close()"),!this._closed&&(this._closed=!0)}setIceGatheringState(b){this.emit("@icegatheringstatechange",b)}setConnectionState(b){this.emit("@connectionstatechange",b)}async getNativeRtpCapabilities(){return y.debug("getNativeRtpCapabilities()"),this.fakeParameters.generateNativeRtpCapabilities()}async getNativeSctpCapabilities(){return y.debug("getNativeSctpCapabilities()"),this.fakeParameters.generateNativeSctpCapabilities()}run({direction:b,iceParameters:S,iceCandidates:p,dtlsParameters:o,sctpParameters:r,iceServers:i,iceTransportPolicy:c,proprietaryConstraints:a,extendedRtpCapabilities:d}){this.assertNotClosed(),y.debug("run()"),this._rtpParametersByKind={audio:_.getSendingRtpParameters("audio",d),video:_.getSendingRtpParameters("video",d)}}async updateIceServers(b){this.assertNotClosed(),y.debug("updateIceServers()")}async restartIce(b){this.assertNotClosed(),y.debug("restartIce()")}async getTransportStats(){return this.assertNotClosed(),new Map}async send({track:b,encodings:S,codecOptions:p,codec:o}){this.assertNotClosed(),y.debug("send() [kind:%s, track.id:%s]",b.kind,b.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"});const r=t.clone(this._rtpParametersByKind[b.kind]),i=r.codecs.some(a=>/.+\/rtx$/i.test(a.mimeType));r.mid=`mid-${t.generateRandomNumber()}`,S||(S=[{}]);for(const a of S)a.ssrc=t.generateRandomNumber(),i&&(a.rtx={ssrc:t.generateRandomNumber()});r.encodings=S,r.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const c=this._nextLocalId++;return this._tracks.set(c,b),{localId:String(c),rtpParameters:r}}async stopSending(b){if(y.debug("stopSending() [localId:%s]",b),!this._closed){if(!this._tracks.has(Number(b)))throw new Error("local track not found");this._tracks.delete(Number(b))}}async pauseSending(b){this.assertNotClosed()}async resumeSending(b){this.assertNotClosed()}async replaceTrack(b,S){this.assertNotClosed(),S?y.debug("replaceTrack() [localId:%s, track.id:%s]",b,S.id):y.debug("replaceTrack() [localId:%s, no track]",b),this._tracks.delete(Number(b)),this._tracks.set(Number(b),S)}async setMaxSpatialLayer(b,S){this.assertNotClosed(),y.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",b,S)}async setRtpEncodingParameters(b,S){this.assertNotClosed(),y.debug("setRtpEncodingParameters() [localId:%s, params:%o]",b,S)}async getSenderStats(b){return this.assertNotClosed(),new Map}async sendDataChannel({ordered:b,maxPacketLifeTime:S,maxRetransmits:p,label:o,protocol:r}){this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),y.debug("sendDataChannel()");const i=new R({id:this._nextSctpStreamId++,ordered:b,maxPacketLifeTime:S,maxRetransmits:p,label:o,protocol:r}),c={streamId:this._nextSctpStreamId,ordered:b,maxPacketLifeTime:S,maxRetransmits:p};return{dataChannel:i,sctpStreamParameters:c}}async receive(b){this.assertNotClosed();const S=[];for(const p of b){const{trackId:o,kind:r}=p;this._transportReady||await this.setupTransport({localDtlsRole:"client"}),y.debug("receive() [trackId:%s, kind:%s]",o,r);const i=this._nextLocalId++,c=new n.FakeMediaStreamTrack({kind:r});this._tracks.set(i,c),S.push({localId:String(i),track:c})}return S}async stopReceiving(b){if(!this._closed)for(const S of b)y.debug("stopReceiving() [localId:%s]",S),this._tracks.delete(Number(S))}async pauseReceiving(b){this.assertNotClosed()}async resumeReceiving(b){this.assertNotClosed()}async getReceiverStats(b){return this.assertNotClosed(),new Map}async receiveDataChannel({sctpStreamParameters:b,label:S,protocol:p}){return this.assertNotClosed(),this._transportReady||await this.setupTransport({localDtlsRole:"client"}),y.debug("receiveDataChannel()"),{dataChannel:new R({id:b.streamId,ordered:b.ordered,maxPacketLifeTime:b.maxPacketLifeTime,maxRetransmits:b.maxRetransmits,label:S,protocol:p})}}async setupTransport({localDtlsRole:b,localSdpObject:S}){const p=t.clone(this.fakeParameters.generateLocalDtlsParameters());b&&(p.role=b),this.emit("@connectionstatechange","connecting"),await new Promise((o,r)=>this.emit("@connect",{dtlsParameters:p},o,r)),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new m.InvalidStateError("method called in a closed handler")}};return Mt.FakeHandler=v,Mt}var de={},_n;function nc(){if(_n)return de;_n=1,Object.defineProperty(de,"__esModule",{value:!0}),de.generateRouterRtpCapabilities=s,de.generateNativeRtpCapabilities=t,de.generateNativeSctpCapabilities=_,de.generateLocalDtlsParameters=m,de.generateTransportRemoteParameters=w,de.generateProducerRemoteParameters=y,de.generateConsumerRemoteParameters=C,de.generateDataProducerRemoteParameters=R,de.generateDataConsumerRemoteParameters=v;const n=X();function e(){return String(n.generateRandomNumber())}function s(){return n.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}},{mimeType:"video/H264",kind:"video",preferredPayloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:105,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"profile-id":0,"x-google-start-bitrate":1500}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:106,clockRate:9e4,rtcpFeedback:[],parameters:{apt:105}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id",preferredId:2,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id",preferredId:3,preferredEncrypt:!1,direction:"recvonly"},{kind:"audio",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:4,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"recvonly"},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"http://tools.ietf.org/html/draft-ietf-avtext-framemarking-07",preferredId:6,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:framemarking",preferredId:7,preferredEncrypt:!1,direction:"sendrecv"},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:11,preferredEncrypt:!1,direction:"sendrecv"},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:12,preferredEncrypt:!1,direction:"sendrecv"}]})}function t(){return n.deepFreeze({codecs:[{mimeType:"audio/opus",kind:"audio",preferredPayloadType:111,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{minptime:10,useinbandfec:1}},{mimeType:"audio/ISAC",kind:"audio",preferredPayloadType:103,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"audio/CN",kind:"audio",preferredPayloadType:106,clockRate:32e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}},{mimeType:"video/VP8",kind:"video",preferredPayloadType:96,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{baz:"1234abcd"}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:97,clockRate:9e4,rtcpFeedback:[],parameters:{apt:96}},{mimeType:"video/VP9",kind:"video",preferredPayloadType:98,clockRate:9e4,rtcpFeedback:[{type:"goog-remb"},{type:"transport-cc"},{type:"ccm",parameter:"fir"},{type:"nack"},{type:"nack",parameter:"pli"}],parameters:{"profile-id":0}},{mimeType:"video/rtx",kind:"video",preferredPayloadType:99,clockRate:9e4,rtcpFeedback:[],parameters:{apt:98}}],headerExtensions:[{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:sdes:mid",preferredId:1},{kind:"video",uri:"urn:ietf:params:rtp-hdrext:toffset",preferredId:2},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",preferredId:3},{kind:"video",uri:"urn:3gpp:video-orientation",preferredId:4},{kind:"video",uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",preferredId:5},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay",preferredId:6},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type",preferredId:7},{kind:"video",uri:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing",preferredId:8},{kind:"audio",uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",preferredId:10}]})}function _(){return n.deepFreeze({numStreams:{OS:2048,MIS:2048}})}function m(){return n.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"82:5A:68:3D:36:C3:0A:DE:AF:E7:32:43:D2:88:83:57:AC:2D:65:E5:80:C4:B6:FB:AF:1A:A0:21:9F:6D:0C:AD"}],role:"auto"})}function w(){return{id:e(),iceParameters:n.deepFreeze({iceLite:!0,password:"yku5ej8nvfaor28lvtrabcx0wkrpkztz",usernameFragment:"h3hk1iz6qqlnqlne"}),iceCandidates:n.deepFreeze([{foundation:"udpcandidate",address:"9.9.9.9",ip:"9.9.9.9",port:40533,priority:1078862079,protocol:"udp",type:"host",tcpType:"passive"},{foundation:"udpcandidate",address:"9.9.9.9",ip:"9:9:9:9:9:9",port:41333,priority:1078862089,protocol:"udp",type:"host",tcpType:"passive"}]),dtlsParameters:n.deepFreeze({fingerprints:[{algorithm:"sha-256",value:"A9:F4:E0:D2:74:D3:0F:D9:CA:A5:2F:9F:7F:47:FA:F0:C4:72:DD:73:49:D0:3B:14:90:20:51:30:1B:90:8E:71"},{algorithm:"sha-384",value:"03:D9:0B:87:13:98:F6:6D:BC:FC:92:2E:39:D4:E1:97:32:61:30:56:84:70:81:6E:D1:82:97:EA:D9:C1:21:0F:6B:C5:E7:7F:E1:97:0C:17:97:6E:CF:B3:EF:2E:74:B0"},{algorithm:"sha-512",value:"84:27:A4:28:A4:73:AF:43:02:2A:44:68:FF:2F:29:5C:3B:11:9A:60:F4:A8:F0:F5:AC:A0:E3:49:3E:B1:34:53:A9:85:CE:51:9B:ED:87:5E:B8:F4:8E:3D:FA:20:51:B8:96:EE:DA:56:DC:2F:5C:62:79:15:23:E0:21:82:2B:2C"}],role:"auto"}),sctpParameters:n.deepFreeze({port:5e3,OS:2048,MIS:2048,maxMessageSize:2e6})}}function y(){return n.deepFreeze({id:e()})}function C({id:l,codecMimeType:b}={}){switch(b){case"audio/opus":return{id:l??e(),producerId:e(),kind:"audio",rtpParameters:n.deepFreeze({codecs:[{mimeType:"audio/opus",payloadType:100,clockRate:48e3,channels:2,rtcpFeedback:[{type:"transport-cc"}],parameters:{useinbandfec:1,foo:"bar"}}],encodings:[{ssrc:46687003}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:ietf:params:rtp-hdrext:ssrc-audio-level",id:10}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"audio/ISAC":return{id:l??e(),producerId:e(),kind:"audio",rtpParameters:n.deepFreeze({codecs:[{mimeType:"audio/ISAC",payloadType:111,clockRate:16e3,channels:1,rtcpFeedback:[{type:"transport-cc"}],parameters:{}}],encodings:[{ssrc:46687004}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/VP8":return{id:l??e(),producerId:e(),kind:"video",rtpParameters:n.deepFreeze({codecs:[{mimeType:"video/VP8",payloadType:101,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"x-google-start-bitrate":1500}},{mimeType:"video/rtx",payloadType:102,clockRate:9e4,rtcpFeedback:[],parameters:{apt:101}}],encodings:[{ssrc:99991111,rtx:{ssrc:99991112}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};case"video/H264":return{id:l??e(),producerId:e(),kind:"video",rtpParameters:n.deepFreeze({codecs:[{mimeType:"video/H264",payloadType:103,clockRate:9e4,rtcpFeedback:[{type:"nack"},{type:"nack",parameter:"pli"},{type:"ccm",parameter:"fir"},{type:"goog-remb"},{type:"transport-cc"}],parameters:{"level-asymmetry-allowed":1,"packetization-mode":1,"profile-level-id":"42e01f"}},{mimeType:"video/rtx",payloadType:104,clockRate:9e4,rtcpFeedback:[],parameters:{apt:103}}],encodings:[{ssrc:99991113,rtx:{ssrc:99991114}}],headerExtensions:[{uri:"urn:ietf:params:rtp-hdrext:sdes:mid",id:1},{uri:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time",id:4},{uri:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01",id:5},{uri:"urn:3gpp:video-orientation",id:11},{uri:"urn:ietf:params:rtp-hdrext:toffset",id:12}],rtcp:{cname:"wB4Ql4lrsxYLjzuN",reducedSize:!0,mux:!0}})};default:throw new TypeError(`unknown codecMimeType '${b}'`)}}function R(){return n.deepFreeze({id:e()})}function v({id:l}={}){return{id:l??e(),dataProducerId:e(),sctpStreamParameters:n.deepFreeze({streamId:666,maxPacketLifeTime:5e3,maxRetransmits:void 0})}}return de}var wn;function ac(){return wn||(wn=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.debug=n.testFakeParameters=n.FakeHandler=n.ortc=n.parseScalabilityMode=n.detectDeviceAsync=n.detectDevice=n.Device=n.version=n.types=void 0;const e=Pr();n.debug=e.default,n.types=qo(),n.version="3.12.1";var s=Zn();Object.defineProperty(n,"Device",{enumerable:!0,get:function(){return s.Device}}),Object.defineProperty(n,"detectDevice",{enumerable:!0,get:function(){return s.detectDevice}}),Object.defineProperty(n,"detectDeviceAsync",{enumerable:!0,get:function(){return s.detectDeviceAsync}});var t=Le();Object.defineProperty(n,"parseScalabilityMode",{enumerable:!0,get:function(){return t.parse}}),n.ortc=re();var _=ic();Object.defineProperty(n,"FakeHandler",{enumerable:!0,get:function(){return _.FakeHandler}}),n.testFakeParameters=nc()}(Jr)),Jr}var vn=ac();let ps=null;function oc(n,e,s,t){return ps?Promise.resolve(ps):new Promise((_,m)=>{n.emit("createTransport",{roomId:s,sender:!1},({params:w})=>{if(w?.error)return m(w.error);const y=e.createRecvTransport(w);ps=y;let C=!1;y.on("connect",({dtlsParameters:R},v,l)=>{if(C){console.warn("Transport connect() already called");return}if(C=!0,y._connectionState==="connected"){console.warn("Consumer transport already connected");return}n.emit("connectConsumerTransport",{roomId:s,dtlsParameters:R},({success:b,error:S})=>{S?(console.error("Transport connect failed:",S),l(S)):v()})}),y.on("connectionstatechange",R=>{(R==="failed"||R==="closed")&&(console.warn("Consumer transport closed or failed."),y.close())}),_(y)})})}function cc(n,e,s,t,_,m){return new Promise((w,y)=>{n.emit("consumeMedia",{roomId:s,rtpCapabilities:e.rtpCapabilities,producerId:t},async({params:C})=>{if(!C||C.error){const R=C?.error||"Error during media consumption";return y(new Error(R))}try{const R=await _.consume({id:C.id,producerId:C.producerId,kind:C.kind,rtpParameters:C.rtpParameters});m(R);const v=new MediaStream([R.track]);w({consumer:R,stream:v})}catch(R){y(R)}})})}const dc=n=>{},pc=n=>{},Rr=async(n,e,s,t)=>{try{const _=await oc(n,e,s,pc),{consumer:m,stream:w}=await cc(n,e,s,t,_,dc);return w}catch(_){return console.error("Error handling producer",t,_),null}},Cr=async(n,e,s)=>{try{n.emit("resumePausedConsumers",{roomId:e,producerId:s},({success:t})=>{console.log(t?"Consumer resumed":"Failed to resume consumer")})}catch(t){return console.error("Error consumer resume",s,t),null}},lc={__name:"Members",props:{videoProducerId:String,audioProducerId:String,socket:Object,classId:String,device:Object},setup(n,{expose:e}){e();const s=n;console.log(s);const t=Z(null),_=Z(null),m=Z(new Set);async function w(R,v){try{if(!R||m.value.has(R))return;const l=await Rr(s.socket,s.device,s.classId,R);if(l){if(m.value.add(R),v==="video"&&t.value)t.value.srcObject=l,t.value.play().catch(b=>console.warn("Autoplay failed:",b));else if(v==="audio"){const b=new Audio;b.srcObject=l,b.autoplay=!0,_.value=b}await Cr(s.socket,s.classId,R)}return{producerId:R,stream:l}}catch(l){return console.error("Error handling producer",R,l),null}}const y=Z(new Set);Bt(()=>s.videoProducerId,R=>{R&&!y.value.has(R)&&w(R,"video")},{immediate:!0}),Bt(()=>s.audioProducerId,R=>{R&&!y.value.has(R)&&w(R,"audio")},{immediate:!0}),qt(()=>{t.value?.srcObject&&t.value.srcObject.getTracks().forEach(R=>R.stop()),_.value?.srcObject&&_.value.srcObject.getTracks().forEach(R=>R.stop())});const C={props:s,videoRef:t,audioRef:_,usedProducerIds:m,handleProducerStream:w,loadedProducers:y,onBeforeUnmount:qt,ref:Z,watch:Bt,get getStreamProducer(){return Rr},get resumeStream(){return Cr}};return Object.defineProperty(C,"__isScriptSetup",{enumerable:!1,value:!0}),C}},uc={class:"bg-black h-32 w-full rounded-lg shadow-md overflow-hidden relative"},hc={class:"w-full h-full object-cover",autoplay:"",playsinline:"",muted:"",ref:"videoRef"},fc={ref:"audioRef",autoplay:"",playsinline:""};function mc(n,e,s,t,_,m){return Nt(),wr("div",uc,[ie("video",hc,null,512),ie("audio",fc,null,512)])}const gc=yn(lc,[["render",mc]]),_c={__name:"LiveMeeting",setup(n,{expose:e}){e();const s=Z(!0),t=Z(null),_=Z(null),m=Z(null),w=Z(!1),y=Z(!1),C=Z(null),R=Z(0),v=zs({camera:null,audio:null}),l=Z(!1);let b=null;const S=Z(null),p=Z(null);let o=null;const r=Z([]),i=Gr("meetingId"),c=Gr("userName");nt(()=>{if(!i||!c){alert("Missing meeting ID or username. Please go back and join properly.");return}console.log("Initializing Socket.IO connection"),console.log(void 0),C.value=Ut(void 0),console.log("Socket.IO instance created:",C.value);const E=({roomId:x,userCount:L})=>{console.log("User count updated:",L),R.value=L};C.value.on("room-user-count",E),C.value.on("connection-success",x=>{console.log("Received connection-success:",x),C.value.emit("join-room",{roomId:i,userName:c,role:"student"},L=>{if(L?.error){console.error("Join room error:",L.message),alert(L.message);return}console.log("Join room response:",L),L?.rtpCapabilities?b=L.rtpCapabilities:console.error("Failed to get RTP Capabilities")}),C.value.on("user-joined",({message:L,userName:F})=>{console.log(L),console.log(`${F} joined`)})})});const a=async()=>{console.log("Emitting getRouterRtpCapabilities");const E=await new Promise(x=>{C.value.emit("getRouterRtpCapabilities",{roomId:i.value},L=>{x(L)})});return console.log("Received routerRtpCapabilities:",E),b=E.routerRtpCapabilities,E?.routerRtpCapabilities},d=async E=>{if(!E){console.log("Cannot create device: rtpCapabilities is null"),alert("Please get Router RTP Capabilities first!");return}try{console.log("Creating mediasoup Device with rtpCapabilities:",E);const x=new vn.Device;return await x.load({routerRtpCapabilities:E}),console.log("Device loaded successfully:",x),p.value=x,x}catch(x){console.error("Error creating device:",x),x.name==="UnsupportedError"&&console.error("Browser not supported"),alert("Failed to create device")}},u=async E=>{if(!E){console.warn("Device not initialized. Cannot create transport."),alert("Please create a Device first!");return}try{console.log("Requesting send transport creation..."),C.value.emit("createTransport",{roomId:i,sender:!0},({params:x,error:L})=>{if(L||!x){console.error("Transport creation failed:",L),alert("Failed to create send transport.");return}const F=E.createSendTransport(x);console.log("Send transport created:",F),s.value=!1,o=F,F.on("connect",async({dtlsParameters:q},V,Y)=>{try{C.value.emit("connectProducerTransport",{roomId:i,dtlsParameters:q}),console.log("connectProducerTransport sent"),V()}catch(ce){console.error("connectProducerTransport failed:",ce),Y(ce)}}),F.on("produce",async({kind:q,rtpParameters:V,appData:Y},ce,le)=>{try{C.value.emit("transport-produce",{roomId:i,kind:q,rtpParameters:V,label:Y?.label||""},({id:ee,error:_e})=>{if(_e){console.error("Produce error:",_e),le(_e);return}console.log("Producer created with ID:",ee),ce({id:ee})})}catch(ee){console.error("Error in transport-produce:",ee),le(ee)}})})}catch(x){console.error("createSendTransport error:",x),alert("Unexpected error while creating send transport.")}},f=async(E,x)=>{if(!o){alert("Please create a Send Transport first!");return}try{if(E==="camera"&&x&&!v.camera){const L=await o.produce({track:x,encodings:[{rid:"r0",maxBitrate:1e5,scalabilityMode:"S1T3"},{rid:"r1",maxBitrate:3e5,scalabilityMode:"S1T3"},{rid:"r2",maxBitrate:9e5,scalabilityMode:"S1T3"}],codecOptions:{videoGoogleStartBitrate:1e3},appData:{label:"camera"}});v.camera=L,console.log("Created camera video producer:",L),L.on("trackended",()=>{console.log("Camera video track ended"),stopCamera()}),L.on("transportclose",()=>console.log("Camera video transport closed"))}if(E==="audio"&&x&&!v.audio){const L=await o.produce({track:x,appData:{label:"audio"}});v.audio=L,console.log("Created audio producer:",L),L.on("trackended",()=>{console.log("Audio track ended"),stopAudio()}),L.on("transportclose",()=>console.log("Audio transport closed"))}}catch(L){console.error("Error producing media:",L),alert("Failed to produce media: "+L.message)}},g=async({video:E=!1,audio:x=!1}={})=>{try{if(t.value=await navigator.mediaDevices.getUserMedia({video:E,audio:x}),_.value&&E&&(_.value.srcObject=t.value,await _.value.play()),E){const L=t.value.getVideoTracks()[0];L&&(w.value=!0,await f("camera",L))}if(x){const L=t.value.getAudioTracks()[0];L&&(y.value=!0,await f("audio",L))}}catch(L){console.error("Error producing media:",L),alert("Could not access camera/microphone.")}},T=async()=>{if(!t.value){await g({video:!0,audio:!1});return}const E=t.value.getVideoTracks()[0];E.enabled=!E.enabled,w.value=E.enabled},h=async()=>{if(!t.value){await g({video:!1,audio:!0});return}const E=t.value.getAudioTracks()[0];E.enabled=!E.enabled,y.value=E.enabled},P=()=>{console.log("end call"),t.value&&(t.value.getTracks().forEach(E=>E.stop()),t.value=null,w.value=!1,y.value=!1),C.value.emit("leave-room",{roomId:i,userName:"student"}),setTimeout(()=>{window.location.href("/live-classes?page=classes")})},k=async()=>{try{S.value=await a(),console.log(S.value);const E=await d(b);await u(E)}catch(E){console.error("Initialization error:",E)}};nt(()=>{C.value&&!l.value&&(l.value=!0,k())}),Bt(b,E=>{E&&!l.value&&(l.value=!0,k())});const M=async E=>{if(console.log("New producer available",E),r.value.some(L=>L.producerId===E.producerId),E?.label==="screen"){const L=await Rr(C.value,p.value,i,E.producerId);m.value&&L&&(m.value.srcObject=L,m.value.play().catch(F=>console.warn("Autoplay failed:",F))),await Cr(C.value,i,E.producerId);return}const x=r.value.findIndex(L=>L.peerId===E?.peerId);if(x!==-1){const L=r.value[x];E?.label==="audio"?L.audioProducerId=E?.producerId:E?.label==="camera"&&(L.videoProducerId=E?.producerId),r.value[x]={...L}}else r.value.push({peerId:E.peerId,roomId:E.roomId,videoProducerId:E?.label==="camera"?E.producerId:void 0,audioProducerId:E?.label==="audio"?E.producerId:void 0,socket:C.value,device:p.value});console.log("Updated remote producers:",r.value)};nt(()=>{C.value&&C.value.on("new-producer",M)}),qt(()=>{C.value&&C.value.off("new-producer",M)}),nt(()=>{C.value.on("user-left",D)}),qt(()=>{C.value.off("user-left",D)});const D=({producerIds:E,userName:x})=>{console.log(`${x} left the room. Removing producers...`,E),r.value=r.value.filter(L=>!E.includes(L.producerId))},I={fallLoading:s,stream:t,myVideo:_,screenRef:m,cameraEnabled:w,micEnabled:y,socket:C,viewerCount:R,producers:v,initialized:l,get rtpCapabilities(){return b},set rtpCapabilities(E){b=E},rtpCapabilities1:S,newDevice:p,get producerTransport(){return o},set producerTransport(E){o=E},remoteProducers:r,classId:i,userName:c,getRouterRtpCapabilities:a,createDevice:d,createSendTransport:u,connectSendTransport:f,startMedia:g,toggleCamera:T,toggleMic:h,endCall:P,startLiveClass:k,handleNewProducer:M,handleUserLeft:D,ref:Z,onMounted:nt,watch:Bt,onBeforeUnmount:qt,get io(){return Ut},get getItem(){return Gr},reactive:zs,get Device(){return vn.Device},Members:gc,computed:ga,get getStreamProducer(){return Rr},get resumeStream(){return Cr}};return Object.defineProperty(I,"__isScriptSetup",{enumerable:!1,value:!0}),I}},wc={key:0,class:"absolute inset-0 flex justify-center items-center bg-black bg-opacity-50 z-10 gap-3"},vc={key:1,class:"flex justify-between items-center p-5"},yc={class:"p-4 w-full flex flex-col items-center gap-6"},bc={class:"relative w-full max-w-5xl aspect-video bg-gray-900 rounded-lg overflow-hidden shadow-lg"},Sc={class:"w-full h-full object-cover",autoplay:"",muted:"",playsinline:"",ref:"screenRef"},Rc={ref:"myVideo",class:"absolute bottom-4 right-4 w-40 h-28 rounded-lg object-cover border-2 border-white shadow-md",autoplay:"",muted:"",playsinline:""},Cc={class:"absolute top-4 left-4 text-white bg-black p-2 rounded-lg shadow-md"},Tc={class:"flex gap-4"},Dc={class:"w-1/3"},Pc={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"};function kc(n,e,s,t,_,m){return t.fallLoading?(Nt(),wr("div",wc,e[0]||(e[0]=[ie("i",{class:"pi pi-spin pi-cog",style:{"font-size":"4rem",color:"white"}},null,-1),ie("span",{class:"text-white text-lg"},"Letting You In....",-1)]))):(Nt(),wr("div",vc,[ie("div",yc,[ie("div",bc,[ie("video",Sc,null,512),ie("video",Rc,null,512),ie("div",Cc," Count: "+Qr(t.viewerCount),1)]),ie("div",Tc,[ie("button",{onClick:t.toggleCamera,class:$s([t.cameraEnabled?"bg-green-600":"bg-gray-700","text-white px-4 py-2 rounded hover:bg-green-700 transition"])},Qr(t.cameraEnabled?"Camera On":"Camera Off"),3),ie("button",{onClick:t.toggleMic,class:$s([t.micEnabled?"bg-green-600":"bg-gray-700","text-white px-4 py-2 rounded hover:bg-green-700 transition"])},Qr(t.micEnabled?"Mic On":"Mic Off"),3),ie("button",{onClick:t.endCall,class:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition"}," End Call ")])]),ie("div",Dc,[ie("div",Pc,[(Nt(!0),wr(fa,null,ma(t.remoteProducers,(w,y)=>(Nt(),_a(t.Members,{key:w.videoProducerId||y,videoProducerId:w.videoProducerId,audioProducerId:w.audioProducerId,socket:t.socket,device:t.newDevice,classId:w.roomId},null,8,["videoProducerId","audioProducerId","socket","device","classId"]))),128))])])]))}const Kc=yn(_c,[["render",kc],["__scopeId","data-v-60b9bc46"]]);export{Kc as default};
