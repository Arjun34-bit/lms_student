import{v as U}from"./runtime-dom.esm-bundler.BFvuzEM6.js";import{g as h,f as C,i as _}from"./courseQueries.C_Y3HYiG.js";import{g as I}from"./localStorageUtils.BuRq4_r3.js";import{_ as z}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{c as b,a as e,t as n,e as s,f as V,d as D,r as l,Q as S,h as j,o as v}from"./runtime-core.esm-bundler.C9CRTELZ.js";import"./client.D6J25A0q.js";const F=void 0,k=`${F}/common/verify-payment`,A=void 0,M="https://developers.elementor.com/docs/assets/img/elementor-placeholder-image.png",R={__name:"Order",props:{courseId:{type:String,required:!0}},setup(x,{expose:o}){o();const u=x,t=l({}),a=l(""),m=l(""),i=l(""),p=l(!1),f=l(""),d=l(0),g=l(!1),O=S(()=>Math.max(0,(t.value.price||0)-d.value)),T=()=>{window.location.href=`/courses/${u?.courseId}`},N=r=>r?new Date(r).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}):"N/A";j(async()=>{try{a.value=I("user");const r=await h(u.courseId);t.value=r?.data?.data?.course,t.value.thumbnailId&&(m.value=await C(t.value.thumbnailId))}catch(r){console.error("Course loading failed:",r),alert("Failed to load course details.")}});const w={props:u,course:t,userDetails:a,thumbnailSrc:m,defaultThumbnail:M,coupon:i,couponApplied:p,couponCode:f,discount:d,loading:g,total:O,backNavigation:T,formatDate:N,applyCoupon:()=>{i.value.toLowerCase()==="discount"?(d.value=19,f.value="DISCOUNT",p.value=!0):(d.value=0,f.value="",p.value=!1,alert("Invalid coupon code."))},confirmOrder:async r=>{g.value=!0;try{const y=await _(r),{order:c,courseBuy:B}=y?.data;if(!c?.id||!B?.id)throw new Error("Invalid server response.");new window.Razorpay({key:A,amount:c.amount,currency:c.currency,name:"PCC",description:"Course Enrollment",order_id:c.id,prefill:{name:a.value.name,email:a.value.email},theme:{color:"#3B82F6"},handler:async({razorpay_payment_id:P,razorpay_order_id:E})=>{try{await fetch(k,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_payment_id:P,razorpay_order_id:E})}),alert("✅ Payment successful!"),setTimeout(()=>{window.location.href="/courses/my-courses"},1e3)}catch(L){console.error("Verification failed:",L),alert("❌ Payment done but verification failed.")}}}).open()}catch(y){console.error("Payment init failed:",y),alert("Failed to initiate payment. Try again.")}finally{g.value=!1}},ref:l,onMounted:j,computed:S,get fetchImageApi(){return C},get buyCourseApi(){return _},get getCourseByIdApi(){return h},get razorpayKey(){return A},get verifyURL(){return k},get getItem(){return I}};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}},K={class:"min-h-screen bg-white p-6"},q={class:"max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6"},G={class:"md:col-span-2"},J={class:"bg-blue-50 rounded-xl p-4"},Q={class:"flex justify-between items-start border-b border-gray-200 py-4"},Y=["src"],H={class:"text-lg font-semibold text-gray-900"},W={class:"flex-1"},X={class:"list-disc ml-5 text-sm text-gray-700 mt-1 space-y-1"},Z={class:"text-right font-semibold whitespace-nowrap text-gray-800"},$={class:"mt-6 flex items-center gap-4"},ee={key:0,class:"text-green-600"},oe={class:"bg-blue-100 p-6 rounded-t-xl h-fit"},te={class:"space-y-2 text-sm text-gray-700"},ne={class:"flex justify-between"},le={class:"flex justify-between"},re={key:0,class:"flex justify-between text-green-700"},se={class:"flex justify-between font-semibold text-lg"},ae=["disabled"];function ie(x,o,u,t,a,m){return v(),b("div",K,[o[17]||(o[17]=e("div",{class:"flex justify-around items-center text-lg font-bold"},null,-1)),e("div",q,[e("div",G,[e("span",{class:"flex gap-2 text-lg font-bold"},[e("button",{onClick:t.backNavigation,class:"cursor-pointer"},o[2]||(o[2]=[e("i",{class:"pi pi-arrow-left text-lg"},null,-1)])),o[3]||(o[3]=e("p",null,"Your Orders",-1))]),e("div",J,[e("div",Q,[e("div",null,[e("img",{src:t.course?.thumbnailUrl||t.defaultThumbnail,class:"w-28 h-20 object-cover rounded mr-4",alt:"Course thumbnail"},null,8,Y),e("h3",H,n(t.course.title),1)]),e("div",W,[e("ul",X,[e("li",null,[o[4]||(o[4]=e("strong",null,"Level:",-1)),s(" "+n(t.course.level),1)]),e("li",null,[o[5]||(o[5]=e("strong",null,"Language:",-1)),s(" "+n(t.course.language?.name),1)]),e("li",null,[o[6]||(o[6]=e("strong",null,"Category:",-1)),s(" "+n(t.course.category?.name),1)]),e("li",null,[o[7]||(o[7]=e("strong",null,"Department:",-1)),s(" "+n(t.course.department?.name),1)]),e("li",null,[o[8]||(o[8]=e("strong",null,"Subject:",-1)),s(" "+n(t.course.subject?.name),1)]),e("li",null,[o[9]||(o[9]=e("strong",null,"Start:",-1)),s(" "+n(t.formatDate(t.course.startDate)),1)]),e("li",null,[o[10]||(o[10]=e("strong",null,"End:",-1)),s(" "+n(t.formatDate(t.course.endDate)),1)])])]),e("p",Z," ₹"+n(t.course.price),1)])]),e("div",$,[V(e("input",{"onUpdate:modelValue":o[0]||(o[0]=i=>t.coupon=i),placeholder:"Got a coupon? Enter here",class:"flex-1 border border-gray-300 rounded-md px-4 py-2"},null,512),[[U,t.coupon]]),e("button",{class:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700",onClick:t.applyCoupon}," Apply "),t.couponApplied?(v(),b("span",ee,"Coupon applied!")):D("",!0)])]),e("div",null,[o[16]||(o[16]=e("span",{class:"flex gap-2 text-lg font-bold"},[e("p",null,"Summary")],-1)),e("div",oe,[e("div",te,[e("div",ne,[e("span",null,n(t.course.title),1),e("span",null,"₹"+n(t.course.price),1)]),o[14]||(o[14]=e("hr",null,null,-1)),e("div",le,[o[11]||(o[11]=e("span",null,"Subtotal",-1)),e("span",null,"₹"+n(t.course.price),1)]),t.discount>0?(v(),b("div",re,[e("span",null,[o[12]||(o[12]=s("Coupon ")),e("strong",null,n(t.couponCode),1)]),e("span",null,"- ₹"+n(t.discount),1)])):D("",!0),o[15]||(o[15]=e("hr",null,null,-1)),e("div",se,[o[13]||(o[13]=e("span",null,"Total",-1)),e("span",null,"₹"+n(t.total),1)])])]),e("button",{class:"w-full bg-blue-600 text-white py-3 rounded-b-xl text-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",onClick:o[1]||(o[1]=i=>t.confirmOrder(t.course?.id)),disabled:t.loading},n(t.loading?"Processing...":"Confirm & Enroll"),9,ae)])])])}const ve=z(R,[["render",ie]]);export{ve as default};
