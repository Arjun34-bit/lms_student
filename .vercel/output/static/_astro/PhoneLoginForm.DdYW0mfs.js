import{v as y}from"./runtime-dom.esm-bundler.5Gt7AxqO.js";import{E as P,F as O,a as k}from"./index.esm.B1fCZ8yi.js";import{p as S}from"./auth.CEkH0Eyl.js";import{a as m,s as f,R as h}from"./config.CyDGhkV7.js";import{a as b}from"./authQueries.BcGoVAi4.js";import{_ as V}from"./_plugin-vue_export-helper.DlAUqK2U.js";import{c as g,a as t,b as n,d as F,w,e as T,r as l,o as x}from"./runtime-core.esm-bundler.Vqe_tuZK.js";import"./_commonjsHelpers.D6-XlEtG.js";import"./localStorageUtils.BuRq4_r3.js";import"./client.D6J25A0q.js";const E={__name:"PhoneLoginForm",setup(v,{expose:e}){e();const s=l(!1),o=l(""),a=l(null),u={showOtpModal:s,otp:o,verificationId:a,onSubmit:async i=>{const c=`+91${i.phone}`;try{window.recaptchaVerifier||(window.recaptchaVerifier=new h(m,"recaptcha-container",{size:"invisible"}),await window.recaptchaVerifier.render());const r=window.recaptchaVerifier,p=await f(m,c,r);a.value=p,window.confirmationResult=p,s.value=!0}catch(r){console.error("OTP Send Failed:",r),alert("Failed to send OTP")}},verifyOtp:async()=>{try{const c=(await a.value.confirm(o.value)).user.getIdToken(),r=await b(c);r?.data?.access_token&&r?.data?.user&&(setItem("token",r?.data?.access_token),setItem("user",r?.data?.user),setTimeout(()=>window.location.href="/",2e3)),console.log("Phone Auth Successful:",user),alert("OTP Verified! Login successful."),s.value=!1}catch(i){alert("Invalid OTP"),console.error("OTP Verification Error:",i)}},ref:l,get Form(){return k},get Field(){return O},get ErrorMessage(){return P},get phoneLoginSchema(){return S},get RecaptchaVerifier(){return h},get signInWithPhoneNumber(){return f},get auth(){return m},get authLoginWithPhoneApi(){return b}};return Object.defineProperty(u,"__isScriptSetup",{enumerable:!1,value:!0}),u}},I={class:"max-w-md mx-auto bg-white p-6 rounded shadow mt-10"},L={class:"flex gap-2 mb-4"},N={class:"w-1/3"},M={class:"w-2/3"},C={key:0,class:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50"},R={class:"bg-white rounded-lg p-6 w-full max-w-sm shadow-xl"},U={class:"flex justify-between"};function W(v,e,s,o,a,_){return x(),g("div",I,[e[7]||(e[7]=t("div",{id:"recaptcha-container"},null,-1)),e[8]||(e[8]=t("h2",{class:"text-xl font-semibold text-center mb-4"}," Login or Register with Phone Number ",-1)),n(o.Form,{onSubmit:o.onSubmit,"validation-schema":o.phoneLoginSchema},{default:w(()=>[t("div",L,[t("div",N,[e[3]||(e[3]=t("label",{class:"block text-sm font-medium mb-1"},"Country",-1)),n(o.Field,{as:"select",name:"country",class:"w-full p-2 border rounded"},{default:w(()=>e[2]||(e[2]=[t("option",{disabled:"",value:""},"--",-1),t("option",{value:"IN"},"IN ðŸ‡®ðŸ‡³",-1),t("option",{value:"US"},"US ðŸ‡ºðŸ‡¸",-1),t("option",{value:"UK"},"UK ðŸ‡¬ðŸ‡§",-1)])),_:1,__:[2]}),n(o.ErrorMessage,{name:"country",class:"text-red-500 text-sm mt-1"})]),t("div",M,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium mb-1"},"Phone Number",-1)),n(o.Field,{name:"phone",placeholder:"9876543210",class:"w-full p-2 border rounded"}),n(o.ErrorMessage,{name:"phone",class:"text-red-500 text-sm mt-1"})])]),e[5]||(e[5]=t("div",{class:"text-center"},[t("button",{type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition"}," Send OTP ")],-1))]),_:1,__:[5]},8,["validation-schema"]),o.showOtpModal?(x(),g("div",C,[t("div",R,[e[6]||(e[6]=t("h3",{class:"text-lg font-bold mb-4 text-center"},"Enter OTP",-1)),T(t("input",{"onUpdate:modelValue":e[0]||(e[0]=d=>o.otp=d),type:"text",maxlength:"6",class:"w-full p-2 border rounded mb-4 text-center",placeholder:"Enter 6-digit code"},null,512),[[y,o.otp]]),t("div",U,[t("button",{onClick:o.verifyOtp,class:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"}," Verify OTP "),t("button",{onClick:e[1]||(e[1]=d=>o.showOtpModal=!1),class:"bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500"}," Cancel ")])])])):F("",!0)])}const Q=V(E,[["render",W]]);export{Q as default};
